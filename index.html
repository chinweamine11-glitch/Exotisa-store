<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotisa Store - متجر التطبيقات المحسن</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS Reset وتحسينات عامة */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #17a2b8;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-color: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 10px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --primary-gradient: linear-gradient(135deg, #4a6fa5 0%, #166088 100%);
            --secondary-gradient: linear-gradient(135deg, #17a2b8 0%, #28a745 100%);
            --card-gradient: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            --glass-effect: rgba(255, 255, 255, 0.1);
            --blur-background: blur(10px);
        }

        [data-theme="dark"] {
            --primary-color: #5a8fd6;
            --secondary-color: #2c7bb6;
            --light-color: #212529;
            --dark-color: #f8f9fa;
            --light-gray: #343a40;
            --gray-color: #adb5bd;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            --card-gradient: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            --glass-effect: rgba(0, 0, 0, 0.2);
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            transition: var(--transition);
            line-height: 1.6;
            direction: rtl;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* الشريط العلوي */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .search-bar {
            flex-grow: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input-container {
            position: relative;
            display: flex;
            background: var(--glass-effect);
            backdrop-filter: var(--blur-background);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .search-input-container i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .search-input-container input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: none;
            outline: none;
            font-size: 1rem;
            background-color: transparent;
            color: white;
        }

        .search-input-container input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .search-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0 20px;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-btn:hover {
            background-color: #0d4f73;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .icon-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* التنقل بين الفئات */
        .categories {
            background-color: var(--light-gray);
            padding: 15px 0;
            overflow-x: auto;
            position: sticky;
            top: 70px;
            z-index: 999;
        }

        .category-list {
            display: flex;
            gap: 10px;
            padding-bottom: 5px;
        }

        .category-btn {
            background-color: white;
            color: var(--dark-color);
            border: 1px solid #ddd;
            padding: 8px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-size: 0.9rem;
        }

        .category-btn:hover, .category-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* المحتوى الرئيسي */
        .main-content {
            padding: 30px 0;
        }

        .featured-section, .apps-section {
            margin-bottom: 40px;
        }

        .featured-section h2, .apps-section h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .sort-controls select {
            padding: 8px 15px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            background-color: white;
            color: var(--dark-color);
            font-size: 0.9rem;
            cursor: pointer;
        }

        .featured-apps {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        /* بطاقة التطبيق */
        .app-card {
            background: var(--card-gradient);
            backdrop-filter: var(--blur-background);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), 
                        box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            animation-fill-mode: both;
        }

        .app-card:nth-child(2) { animation-delay: 0.1s; }
        .app-card:nth-child(3) { animation-delay: 0.2s; }
        .app-card:nth-child(4) { animation-delay: 0.3s; }

        .app-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .app-card.featured {
            border: 2px solid var(--accent-color);
        }

        .app-card.disabled {
            opacity: 0.6;
            position: relative;
        }

        .app-card.disabled::after {
            content: "معطل";
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--danger-color);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .app-header {
            display: flex;
            padding: 20px;
            border-bottom: 1px solid #eee;
            gap: 15px;
        }

        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .app-icon::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: translateX(-100%);
        }

        .app-icon:hover::after {
            animation: shine 1s forwards;
        }

        .app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }

        .app-icon i {
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .app-info {
            flex-grow: 1;
        }

        .app-info h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .app-info p {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .app-meta {
            display: flex;
            gap: 15px;
            margin-top: 8px;
            font-size: 0.85rem;
        }

        .app-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray-color);
        }

        .app-meta i {
            color: var(--primary-color);
        }

        .app-body {
            padding: 15px 20px;
            flex-grow: 1;
        }

        .app-description {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .app-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .stars i {
            color: var(--warning-color);
            font-size: 0.9rem;
            position: relative;
            text-shadow: 0 2px 5px rgba(255, 193, 7, 0.3);
        }

        .stars i:hover {
            transform: scale(1.2);
            transition: transform 0.2s ease;
        }

        .rating-value {
            font-weight: bold;
            color: var(--dark-color);
        }

        .rating-count {
            color: var(--gray-color);
            font-size: 0.85rem;
        }

        .app-footer {
            padding: 15px 20px;
            background-color: var(--light-gray);
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .download-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-weight: 600;
        }

        .download-btn:hover {
            background-color: #218838;
        }

        .download-btn.disabled {
            background-color: var(--gray-color);
            cursor: not-allowed;
        }

        .download-count {
            color: var(--gray-color);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .download-count i {
            color: var(--primary-color);
        }

        /* تذييل الصفحة */
        .footer {
            background-color: var(--dark-color);
            color: white;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-section h4 {
            margin-bottom: 15px;
            color: white;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section ul li a {
            color: #ccc;
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-section ul li a:hover {
            color: white;
            padding-right: 5px;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #aaa;
            font-size: 0.9rem;
        }

        /* لوحة الإدارة */
        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .admin-panel.active {
            display: flex;
        }

        .admin-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        [data-theme="dark"] .admin-content {
            background-color: var(--light-color);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background-color: var(--primary-color);
            color: white;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .admin-tabs {
            display: flex;
            background-color: var(--light-gray);
            padding: 0 20px;
        }

        .admin-tab {
            padding: 15px 20px;
            background-color: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            color: var(--dark-color);
        }

        .admin-tab:hover, .admin-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: white;
        }

        [data-theme="dark"] .admin-tab:hover,
        [data-theme="dark"] .admin-tab.active {
            background-color: var(--light-gray);
        }

        .admin-tab-content {
            padding: 30px;
            display: none;
        }

        .admin-tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background-color: white;
            color: var(--dark-color);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.2);
        }

        .file-upload {
            margin-top: 10px;
        }

        .file-upload-label {
            display: inline-block;
            background-color: var(--light-gray);
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px dashed var(--gray-color);
            text-align: center;
            width: 100%;
        }

        .file-upload-label:hover {
            background-color: #ddd;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        #apkFileName, #iconFileName {
            display: block;
            margin-top: 10px;
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border-radius: var(--border-radius);
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
        }

        .btn-secondary {
            background-color: var(--light-gray);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #ddd;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* إدارة التطبيقات */
        .admin-apps-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .admin-app-item {
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--primary-color);
        }

        .admin-app-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .admin-app-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .admin-app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .admin-app-details h4 {
            margin-bottom: 5px;
        }

        .admin-app-details p {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .admin-app-actions {
            display: flex;
            gap: 10px;
        }

        /* الإحصائيات */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-info h4 {
            font-size: 0.9rem;
            color: var(--gray-color);
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .chart-container {
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
        }

        .chart-container h4 {
            margin-bottom: 15px;
        }

        .chart {
            height: 200px;
            display: flex;
            align-items: flex-end;
            gap: 10px;
            padding: 20px 0;
        }

        .chart-bar {
            flex-grow: 1;
            background-color: var(--primary-color);
            border-radius: 5px 5px 0 0;
            position: relative;
            min-height: 10px;
            transition: var(--transition);
        }

        .chart-bar:hover {
            opacity: 0.8;
        }

        .chart-bar-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 0.8rem;
            color: var(--dark-color);
        }

        /* شريط التحميل الهيكلي */
        .skeleton-loader {
            display: none;
            padding: 30px 0;
        }

        .skeleton-loader.active {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .skeleton-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            height: 350px;
            position: relative;
            overflow: hidden;
        }

        .skeleton-card::before {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: loading 1.5s infinite;
        }

        /* Toast الإشعارات */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toast {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            max-width: 400px;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s forwards;
            border-right: 4px solid var(--primary-color);
        }

        .toast.success {
            border-right-color: var(--success-color);
        }

        .toast.error {
            border-right-color: var(--danger-color);
        }

        .toast.warning {
            border-right-color: var(--warning-color);
        }

        .toast.info {
            border-right-color: var(--accent-color);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast.success .toast-icon {
            color: var(--success-color);
        }

        .toast.error .toast-icon {
            color: var(--danger-color);
        }

        .toast.warning .toast-icon {
            color: var(--warning-color);
        }

        .toast.info .toast-icon {
            color: var(--accent-color);
        }

        .toast-message {
            flex-grow: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .toast-text {
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        /* نافذة تقييم التطبيق */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            display: none;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        [data-theme="dark"] .modal-content {
            background-color: var(--light-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
            background-color: var(--primary-color);
            color: white;
        }

        .modal-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-modal:hover {
            opacity: 0.8;
        }

        .modal-body {
            padding: 20px;
        }

        .app-rating-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .app-rating-info img {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            object-fit: cover;
        }

        .rating-stars {
            text-align: center;
            margin-bottom: 25px;
        }

        .stars {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .stars i {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: var(--transition);
        }

        .stars i.active {
            color: var(--warning-color);
        }

        .stars i:hover {
            transform: scale(1.1);
        }

        #selectedRatingText {
            color: var(--gray-color);
            font-size: 0.9rem;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* نافذة معاينة التطبيق */
        .app-preview {
            padding: 20px;
        }

        .preview-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-gray);
        }

        .preview-icon {
            width: 100px;
            height: 100px;
            border-radius: 20px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .preview-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .preview-info h3 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .preview-info .developer {
            color: var(--gray-color);
            margin-bottom: 15px;
        }

        .preview-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .preview-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
            background: var(--light-gray);
            padding: 5px 10px;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .preview-body h4 {
            margin: 25px 0 15px 0;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preview-details {
            background: var(--light-gray);
            padding: 20px;
            border-radius: var(--border-radius);
            margin: 20px 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .detail-value {
            color: var(--gray-color);
        }

        .detail-value.active {
            color: var(--success-color);
            font-weight: 600;
        }

        .detail-value.inactive {
            color: var(--danger-color);
            font-weight: 600;
        }

        .preview-actions {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .preview-reviews {
            margin-top: 30px;
        }

        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .review-item {
            background: var(--light-gray);
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .review-user {
            font-weight: 600;
            color: var(--primary-color);
        }

        .review-comment {
            color: var(--gray-color);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* تصميم متجاوب */
        @media (max-width: 992px) {
            .header .container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-bar {
                max-width: 100%;
            }
            
            .header-controls {
                align-self: flex-end;
                margin-top: -55px;
            }
            
            .featured-apps {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .apps-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .featured-apps {
                grid-template-columns: 1fr;
            }
            
            .apps-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .admin-app-item {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .admin-app-actions {
                align-self: flex-end;
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .preview-header {
                flex-direction: column;
                text-align: center;
            }
            
            .preview-actions {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
            
            .category-list {
                gap: 5px;
            }
            
            .category-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                flex-wrap: wrap;
            }
            
            .admin-tab {
                flex-grow: 1;
                text-align: center;
                padding: 12px 10px;
                font-size: 0.9rem;
            }
            
            .toast {
                min-width: 250px;
                max-width: 300px;
            }
        }

        /* رسالة عدم وجود تطبيقات */
        .no-apps, .no-featured {
            text-align: center;
            padding: 40px 20px;
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
            grid-column: 1 / -1;
        }

        .no-apps i, .no-featured i {
            font-size: 3rem;
            color: var(--gray-color);
            margin-bottom: 15px;
        }

        .no-apps h3, .no-featured h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .no-apps p, .no-featured p {
            color: var(--gray-color);
        }

        /* أزرار إضافية */
        .rate-btn {
            background-color: var(--light-gray);
            color: var(--dark-color);
            border: none;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .rate-btn:hover {
            background-color: #ddd;
        }

        .preview-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.85rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .preview-btn:hover {
            background-color: #138496;
        }

        .admin-controls {
            display: flex;
            gap: 5px;
        }

        /* معاينة الصورة */
        .image-preview {
            margin-top: 10px;
            text-align: center;
        }

        .image-preview img {
            max-width: 100px;
            max-height: 100px;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        /* تقدم التحميل */
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: var(--light-gray);
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* أنماط البحث الذكي */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            max-height: 400px;
            overflow-y: auto;
            z-index: 2000;
            margin-top: 5px;
            display: none;
        }

        [data-theme="dark"] .search-suggestions {
            background: var(--light-color);
        }

        .search-suggestion-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid #eee;
        }

        .search-suggestion-item:hover {
            background-color: var(--light-gray);
        }

        .suggestion-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            overflow: hidden;
            margin-left: 10px;
            flex-shrink: 0;
        }

        .suggestion-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .suggestion-icon i {
            font-size: 1.2rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .suggestion-info {
            flex-grow: 1;
        }

        .suggestion-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .suggestion-subtitle {
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .suggestion-action i {
            color: var(--gray-color);
        }

        .search-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .results-count {
            background: var(--primary-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .search-no-results {
            text-align: center;
            padding: 50px 20px;
            background: var(--light-gray);
            border-radius: var(--border-radius);
            grid-column: 1 / -1;
        }

        .search-no-results i {
            color: var(--gray-color);
            margin-bottom: 20px;
        }

        .search-no-results h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .search-no-results p {
            color: var(--gray-color);
            margin-bottom: 20px;
        }

        /* أنماط وضع المطور */
        .developer-dashboard {
            padding: 20px;
        }

        .developer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-gray);
        }

        .developer-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .developer-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .developer-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .developer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .developer-apps-section {
            margin-bottom: 30px;
        }

        .developer-apps-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .developer-app-item {
            background: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 20px;
            transition: var(--transition);
        }

        .developer-app-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .developer-app-main {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .developer-app-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .developer-app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .developer-app-icon i {
            font-size: 1.5rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .developer-app-info h4 {
            margin-bottom: 10px;
        }

        .app-version {
            background: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-right: 10px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .status-badge.active {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .status-badge.inactive {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .developer-app-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .developer-tools {
            margin-top: 30px;
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .tool-card {
            background: white;
            border: 2px solid var(--light-gray);
            border-radius: var(--border-radius);
            padding: 20px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .tool-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--box-shadow);
        }

        .tool-card i {
            font-size: 2rem;
            color: var(--primary-color);
        }

        .tool-card span {
            font-weight: 600;
            color: var(--dark-color);
        }

        /* أنماط الإشعارات */
        .notification-panel {
            position: fixed;
            top: 70px;
            left: 20px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        [data-theme="dark"] .notification-panel {
            background: var(--light-color);
        }

        .notification-panel.active {
            display: flex;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h4 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #markAllRead {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .notification-list {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 400px;
        }

        .notification-item {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            transition: var(--transition);
            gap: 15px;
            position: relative;
        }

        .notification-item:hover {
            background: var(--light-gray);
        }

        .notification-item.unread {
            background: rgba(74, 111, 165, 0.05);
        }

        .notification-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-item.info .notification-icon {
            background: rgba(23, 162, 184, 0.1);
            color: var(--accent-color);
        }

        .notification-item.success .notification-icon {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
        }

        .notification-item.warning .notification-icon {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
        }

        .notification-item.important .notification-icon {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
        }

        .notification-item.update .notification-icon {
            background: rgba(111, 66, 193, 0.1);
            color: #6f42c1;
        }

        .notification-content {
            flex-grow: 1;
        }

        .notification-content h5 {
            margin: 0 0 5px 0;
            font-size: 0.95rem;
        }

        .notification-content p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--gray-color);
        }

        .notification-time {
            display: block;
            font-size: 0.75rem;
            color: var(--gray-color);
            margin-top: 5px;
        }

        .mark-read {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            align-self: flex-start;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification-item:hover .mark-read {
            opacity: 1;
        }

        .notification-item.unread .mark-read {
            color: var(--primary-color);
        }

        .remove-notification {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: var(--transition);
            opacity: 0;
            margin-right: 5px;
        }

        .notification-item:hover .remove-notification {
            opacity: 1;
        }

        .remove-notification:hover {
            background: rgba(0,0,0,0.1);
            color: var(--danger-color);
        }

        .notification-footer {
            padding: 15px;
            border-top: 1px solid var(--light-gray);
            text-align: center;
        }

        #clearNotifications {
            background: none;
            border: none;
            color: var(--danger-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .no-notifications {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-color);
        }

        .no-notifications i {
            margin-bottom: 15px;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }

        /* تحليلات التقييمات */
        .rating-analysis {
            background: var(--light-gray);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 20px;
        }

        .rating-analysis h5 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .analysis-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }

        .analysis-stat {
            background: white;
            padding: 10px;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--gray-color);
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark-color);
        }

        .distribution-chart {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .distribution-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stars-count {
            width: 60px;
            font-size: 0.9rem;
        }

        .distribution-bar {
            flex-grow: 1;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--warning-color), #ff9800);
            border-radius: 4px;
        }

        .distribution-count {
            width: 40px;
            text-align: left;
            font-weight: 600;
        }

        /* أحصائيات حية */
        .live-stats {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
        }

        .live-stats h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .live-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .live-stat {
            text-align: center;
        }

        .live-stat-label {
            display: block;
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .live-stat-value {
            display: block;
            font-size: 1.8rem;
            font-weight: bold;
        }

        /* زر تحميل المزيد */
        .load-more-btn {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            font-size: 1.1rem;
        }

        /* تأثيرات الحركة */
        @keyframes shine {
            100% { transform: translateX(100%); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes loading {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }
            to {
                opacity: 0;
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .icon-btn:hover {
            animation: shake 0.5s ease-in-out;
        }
    </style>
</head>
<body>
    <!-- شريط التنبيهات -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- لوحة الإشعارات -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h4><i class="fas fa-bell"></i> الإشعارات</h4>
            <div>
                <button id="markAllRead">تحديد الكل كمقروء</button>
                <button id="closeNotificationsPanel" class="icon-btn" style="background: transparent; color: inherit; margin-right: 5px;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="notification-list" id="notificationList"></div>
        <div class="notification-footer">
            <button id="clearNotifications">مسح الكل</button>
        </div>
    </div>

    <!-- شريط التحميل -->
    <div class="skeleton-loader" id="skeletonLoader">
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
    </div>

    <!-- الشريط العلوي -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <i class="fas fa-store"></i>
                <h1>Exotisa Store</h1>
            </div>
            
            <div class="search-bar">
                <div class="search-input-container">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="ابحث عن تطبيق، فئة، أو مطور...">
                    <button id="searchButton" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>
            
            <div class="header-controls">
                <button id="notificationBtn" class="icon-btn" title="الإشعارات">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationBadge">0</span>
                </button>
                <button id="themeToggle" class="icon-btn" title="تبديل الوضع الليلي">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="refreshBtn" class="icon-btn" title="تحديث">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- التنقل بين الفئات -->
    <nav class="categories">
        <div class="container">
            <div class="category-list">
                <button class="category-btn active" data-category="all">الكل</button>
                <button class="category-btn" data-category="games">ألعاب</button>
                <button class="category-btn" data-category="tools">أدوات</button>
                <button class="category-btn" data-category="productivity">إنتاجية</button>
                <button class="category-btn" data-category="education">تعليم</button>
                <button class="category-btn" data-category="business">أعمال</button>
                <button class="category-btn" data-category="system">أنظمة</button>
                <button class="category-btn" data-category="exotisa">Exotisa Apps</button>
            </div>
        </div>
    </nav>

    <!-- القسم الرئيسي -->
    <main class="main-content">
        <div class="container">
            <!-- قسم التطبيقات المقترحة -->
            <section class="featured-section">
                <h2><i class="fas fa-star"></i> التطبيقات المقترحة</h2>
                <div class="featured-apps" id="featuredApps"></div>
            </section>

            <!-- قسم جميع التطبيقات -->
            <section class="apps-section">
                <div class="section-header">
                    <h2><i class="fas fa-th-large"></i> جميع التطبيقات</h2>
                    <div class="sort-controls">
                        <select id="sortSelect">
                            <option value="rating">الأعلى تقييمًا</option>
                            <option value="downloads">الأكثر تحميلًا</option>
                            <option value="date">الأحدث</option>
                            <option value="name">الاسم (أ-ي)</option>
                        </select>
                    </div>
                </div>
                <div class="apps-grid" id="appsGrid"></div>
                <button class="btn btn-primary load-more-btn" id="loadMoreBtn" style="display: none;">
                    <i class="fas fa-sync-alt"></i> تحميل المزيد
                </button>
            </section>
        </div>
    </main>

    <!-- لوحة الإدارة المخفية -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h3><i class="fas fa-cogs"></i> لوحة التحكم الإدارية</h3>
            <button id="closeAdminPanel" class="icon-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="admin-content">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="add-app">إضافة تطبيق</button>
                <button class="admin-tab" data-tab="manage-apps">إدارة التطبيقات</button>
                <button class="admin-tab" data-tab="stats">الإحصائيات</button>
                <!-- سيتم إضافة تبويب المطور هنا عند التفعيل -->
            </div>
            
            <!-- إضافة تطبيق جديد -->
            <div class="admin-tab-content active" id="add-app-tab">
                <form id="addAppForm">
                    <div class="form-group">
                        <label for="appName">اسم التطبيق *</label>
                        <input type="text" id="appName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="appDescription">الوصف *</label>
                        <textarea id="appDescription" rows="3" required></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appVersion">الإصدار *</label>
                            <input type="text" id="appVersion" placeholder="مثال: 1.0.0" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="appSize">الحجم (MB) *</label>
                            <input type="number" id="appSize" step="0.1" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="appCategory">الفئة *</label>
                            <select id="appCategory" required>
                                <option value="games">ألعاب</option>
                                <option value="tools">أدوات</option>
                                <option value="productivity">إنتاجية</option>
                                <option value="education">تعليم</option>
                                <option value="business">أعمال</option>
                                <option value="system">أنظمة</option>
                                <option value="exotisa">Exotisa Apps</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="appDeveloper">المطور *</label>
                            <input type="text" id="appDeveloper" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="appIconFile">أيقونة التطبيق *</label>
                        <div class="file-upload">
                            <input type="file" id="appIconFile" accept="image/*" required>
                            <label for="appIconFile" class="file-upload-label">
                                <i class="fas fa-image"></i> اختر صورة الأيقونة
                            </label>
                            <span id="iconFileName">لم يتم اختيار ملف</span>
                            <div class="image-preview">
                                <img id="iconPreview" src="" alt="معاينة الأيقونة" style="display: none;">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="appApk">رفع ملف APK *</label>
                        <div class="file-upload">
                            <input type="file" id="appApk" accept=".apk" required>
                            <label for="appApk" class="file-upload-label">
                                <i class="fas fa-cloud-upload-alt"></i> اختر ملف APK
                            </label>
                            <span id="apkFileName">لم يتم اختيار ملف</span>
                            <div class="progress-bar">
                                <div class="progress" id="uploadProgress"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i> إضافة التطبيق
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> إعادة تعيين
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- إدارة التطبيقات -->
            <div class="admin-tab-content" id="manage-apps-tab">
                <div class="admin-apps-list" id="adminAppsList"></div>
            </div>
            
            <!-- الإحصائيات -->
            <div class="admin-tab-content" id="stats-tab">
                <div class="stats-cards">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h4>إجمالي التطبيقات</h4>
                            <p id="totalApps">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="stat-info">
                            <h4>إجمالي التحميلات</h4>
                            <p id="totalDownloads">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-info">
                            <h4>متوسط التقييم</h4>
                            <p id="avgRating">0.0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="stat-info">
                            <h4>التطبيقات النشطة</h4>
                            <p id="activeApps">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <h4>التطبيقات حسب الفئة</h4>
                    <div class="chart" id="categoryChart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة تقييم التطبيق -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-star"></i> تقييم التطبيق</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="app-rating-info">
                    <img id="ratingAppIcon" src="" alt="App Icon">
                    <div>
                        <h4 id="ratingAppName"></h4>
                        <p id="ratingAppVersion"></p>
                    </div>
                </div>
                
                <div class="rating-analysis" id="ratingAnalysis"></div>
                
                <div class="rating-stars">
                    <div class="stars" id="ratingStars">
                        <i class="far fa-star" data-rating="1"></i>
                        <i class="far fa-star" data-rating="2"></i>
                        <i class="far fa-star" data-rating="3"></i>
                        <i class="far fa-star" data-rating="4"></i>
                        <i class="far fa-star" data-rating="5"></i>
                    </div>
                    <p id="selectedRatingText">قم باختيار تقييم من 1 إلى 5 نجوم</p>
                </div>
                
                <div class="form-group">
                    <label for="ratingComment">تعليق (اختياري)</label>
                    <textarea id="ratingComment" rows="3" placeholder="شاركنا بتجربتك مع هذا التطبيق..."></textarea>
                </div>
                
                <div class="modal-actions">
                    <button id="submitRating" class="btn btn-primary">إرسال التقييم</button>
                    <button class="btn btn-secondary close-modal">إلغاء</button>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة معاينة التطبيق -->
    <div class="modal" id="previewModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> معاينة التطبيق</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="previewContent">
                <!-- سيتم ملؤه ديناميكيًا -->
            </div>
        </div>
    </div>

    <!-- تذييل الصفحة -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Exotisa Store</h4>
                    <p>متجر تطبيقات APK متكامل، آمن وسريع. تجد هنا أفضل التطبيقات لأجهزتك.</p>
                </div>
                <div class="footer-section">
                    <h4>روابط سريعة</h4>
                    <ul>
                        <li><a href="#" data-category="games">ألعاب</a></li>
                        <li><a href="#" data-category="tools">أدوات</a></li>
                        <li><a href="#" data-category="exotisa">Exotisa Apps</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>الدعم</h4>
                    <p>لأي استفسار أو دعم فني، يمكنك التواصل معنا عبر البريد الإلكتروني.</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2023 Exotisa Store. جميع الحقوق محفوظة.</p>
                <p>تم التطوير باستخدام HTML، CSS و JavaScript فقط</p>
            </div>
        </div>
    </footer>

    <script>
        // Exotisa Store - تطبيق متجر التطبيقات المحسن
        // بُني باستخدام HTML + CSS + JavaScript فقط
        
        // كلمات المرور المشفرة (Base64)
        const ENCODED_ADMIN_KEY = btoa('2381741exotisastore');
        const ENCODED_DEVELOPER_KEY = btoa('exotisa_dev_2381741');
        
        // البيانات الأساسية للتطبيقات
        let apps = [];
        let currentCategory = 'all';
        let currentSort = 'rating';
        let adminMode = false;
        let developerMode = false;
        let currentUser = 'user_' + Math.random().toString(36).substr(2, 9);
        let currentDeveloper = null;
        
        // نظام إدارة الملفات
        class FileManager {
            constructor() {
                this.filesDB = null;
                this.initDB();
            }

            // تهيئة قاعدة بيانات IndexedDB لتخزين الملفات
            initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('ExotisaFilesDB', 1);
                    
                    request.onerror = (event) => {
                        console.error('فشل فتح قاعدة بيانات الملفات:', event.target.error);
                        reject(event.target.error);
                    };
                    
                    request.onsuccess = (event) => {
                        this.filesDB = event.target.result;
                        console.log('تم فتح قاعدة بيانات الملفات بنجاح');
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // إنشاء مخزن للملفات
                        if (!db.objectStoreNames.contains('files')) {
                            const store = db.createObjectStore('files', { keyPath: 'id' });
                            store.createIndex('appId', 'appId', { unique: false });
                        }
                        
                        // إنشاء مخزن للصور
                        if (!db.objectStoreNames.contains('images')) {
                            const store = db.createObjectStore('images', { keyPath: 'id' });
                            store.createIndex('appId', 'appId', { unique: true });
                        }
                    };
                });
            }

            // رفع ملف APK
            async uploadAPK(appId, file, progressCallback) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        try {
                            const arrayBuffer = event.target.result;
                            
                            const transaction = this.filesDB.transaction(['files'], 'readwrite');
                            const store = transaction.objectStore('files');
                            
                            const fileData = {
                                id: `apk_${appId}_${Date.now()}`,
                                appId: appId,
                                name: file.name,
                                type: file.type,
                                size: file.size,
                                data: arrayBuffer,
                                uploadDate: new Date().toISOString()
                            };
                            
                            const request = store.put(fileData);
                            
                            request.onsuccess = () => {
                                resolve({
                                    success: true,
                                    fileId: fileData.id,
                                    fileName: file.name,
                                    fileSize: file.size
                                });
                            };
                            
                            request.onerror = (error) => {
                                reject(new Error('فشل حفظ ملف APK: ' + error.target.error));
                            };
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = (error) => {
                        reject(new Error('فشل قراءة ملف APK: ' + error.target.error));
                    };
                    
                    // محاكاة تقدم التحميل
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 10;
                        if (progressCallback) progressCallback(progress);
                        if (progress >= 90) clearInterval(interval);
                    }, 50);
                    
                    reader.readAsArrayBuffer(file);
                });
            }

            // رفع صورة الأيقونة
            async uploadIcon(appId, file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = async (event) => {
                        try {
                            const arrayBuffer = event.target.result;
                            
                            const transaction = this.filesDB.transaction(['images'], 'readwrite');
                            const store = transaction.objectStore('images');
                            
                            const imageData = {
                                id: `icon_${appId}`,
                                appId: appId,
                                name: file.name,
                                type: file.type,
                                size: file.size,
                                data: arrayBuffer,
                                uploadDate: new Date().toISOString()
                            };
                            
                            const request = store.put(imageData);
                            
                            request.onsuccess = () => {
                                resolve({
                                    success: true,
                                    imageId: imageData.id,
                                    imageName: file.name
                                });
                            };
                            
                            request.onerror = (error) => {
                                reject(new Error('فشل حفظ الصورة: ' + error.target.error));
                            };
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = (error) => {
                        reject(new Error('فشل قراءة الصورة: ' + error.target.error));
                    };
                    
                    reader.readAsArrayBuffer(file);
                });
            }

            // تنزيل ملف APK
            async downloadAPK(appId, fileName) {
                return new Promise((resolve, reject) => {
                    const transaction = this.filesDB.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const index = store.index('appId');
                    
                    const request = index.getAll(appId);
                    
                    request.onsuccess = async (event) => {
                        const files = event.target.result;
                        if (files.length === 0) {
                            reject(new Error('لم يتم العثور على ملف APK'));
                            return;
                        }
                        
                        // الحصول على أحدث ملف
                        const latestFile = files.sort((a, b) => 
                            new Date(b.uploadDate) - new Date(a.uploadDate)
                        )[0];
                        
                        try {
                            const blob = new Blob([latestFile.data], { type: latestFile.type });
                            const url = URL.createObjectURL(blob);
                            
                            resolve({
                                url: url,
                                fileName: fileName || latestFile.name,
                                blob: blob
                            });
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    request.onerror = (error) => {
                        reject(new Error('فشل جلب ملف APK: ' + error.target.error));
                    };
                });
            }

            // الحصول على صورة الأيقونة
            async getIcon(appId) {
                return new Promise((resolve, reject) => {
                    const transaction = this.filesDB.transaction(['images'], 'readonly');
                    const store = transaction.objectStore('images');
                    const index = store.index('appId');
                    
                    const request = index.get(appId);
                    
                    request.onsuccess = (event) => {
                        const imageData = event.target.result;
                        if (!imageData) {
                            resolve(null);
                            return;
                        }
                        
                        try {
                            const blob = new Blob([imageData.data], { type: imageData.type });
                            const url = URL.createObjectURL(blob);
                            
                            resolve(url);
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    request.onerror = (error) => {
                        reject(new Error('فشل جلب الصورة: ' + error.target.error));
                    };
                });
            }

            // حذف ملفات التطبيق
            async deleteAppFiles(appId) {
                return new Promise(async (resolve, reject) => {
                    try {
                        // حذف ملفات APK
                        const apkTransaction = this.filesDB.transaction(['files'], 'readwrite');
                        const apkStore = apkTransaction.objectStore('files');
                        const apkIndex = apkStore.index('appId');
                        
                        const apkRequest = apkIndex.getAll(appId);
                        
                        apkRequest.onsuccess = (event) => {
                            const files = event.target.result;
                            files.forEach(file => {
                                apkStore.delete(file.id);
                            });
                        };
                        
                        // حذف الصورة
                        const imageTransaction = this.filesDB.transaction(['images'], 'readwrite');
                        const imageStore = imageTransaction.objectStore('images');
                        const imageIndex = imageStore.index('appId');
                        
                        const imageRequest = imageIndex.get(appId);
                        
                        imageRequest.onsuccess = (event) => {
                            const imageData = event.target.result;
                            if (imageData) {
                                imageStore.delete(imageData.id);
                            }
                        };
                        
                        resolve(true);
                    } catch (error) {
                        reject(error);
                    }
                });
            }

            // فحص الملفات
            validateAPKFile(file) {
                const maxSize = 100 * 1024 * 1024;
                if (file.size > maxSize) {
                    return {
                        valid: false,
                        message: 'حجم الملف كبير جدًا. الحد الأقصى 100MB'
                    };
                }
                
                if (!file.name.toLowerCase().endsWith('.apk')) {
                    return {
                        valid: false,
                        message: 'الملف يجب أن يكون بصيغة APK'
                    };
                }
                
                return { valid: true };
            }

            validateImageFile(file) {
                const maxSize = 5 * 1024 * 1024;
                if (file.size > maxSize) {
                    return {
                        valid: false,
                        message: 'حجم الصورة كبير جدًا. الحد الأقصى 5MB'
                    };
                }
                
                const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
                if (!validTypes.includes(file.type)) {
                    return {
                        valid: false,
                        message: 'نوع الصورة غير مدعوم. يرجى استخدام JPG, PNG, GIF أو WebP'
                    };
                }
                
                return { valid: true };
            }
        }

        // إنشاء مدير الملفات
        const fileManager = new FileManager();

        // نظام الإشعارات المحسن
        class NotificationSystem {
            constructor() {
                this.notifications = [];
                this.unreadCount = 0;
                this.init();
            }
            
            init() {
                this.loadNotifications();
            }
            
            addNotification(title, message, type = 'info', action = null, duration = 5000) {
                // عدم إظهار الإشعارات غير المهمة تلقائياً
                if (type !== 'important' && this.notifications.length > 10) {
                    // حذف أقدم الإشعارات غير المهمة
                    this.notifications = this.notifications.slice(0, 10);
                }
                
                const notification = {
                    id: Date.now(),
                    title,
                    message,
                    type,
                    action,
                    read: false,
                    timestamp: new Date().toLocaleString('ar-EG')
                };
                
                this.notifications.unshift(notification);
                
                // تحديث العداد للإشعارات المهمة فقط
                if (type === 'important' || type === 'warning') {
                    this.unreadCount++;
                }
                
                this.saveNotifications();
                this.renderNotifications();
                this.updateBadge(this.unreadCount);
                
                // إظهار toast للإشعارات المهمة فقط
                if (type === 'important') {
                    showToast(title, 'info', message, duration);
                }
            }
            
            renderNotifications() {
                const list = document.getElementById('notificationList');
                if (!list) return;
                
                list.innerHTML = '';
                
                if (this.notifications.length === 0) {
                    list.innerHTML = `
                        <div class="no-notifications">
                            <i class="fas fa-bell-slash fa-2x"></i>
                            <p>لا توجد إشعارات</p>
                        </div>
                    `;
                    return;
                }
                
                this.notifications.forEach(notif => {
                    const item = document.createElement('div');
                    item.className = `notification-item ${notif.type} ${notif.read ? 'read' : 'unread'}`;
                    item.innerHTML = `
                        <div class="notification-icon">
                            <i class="fas fa-${this.getNotificationIcon(notif.type)}"></i>
                        </div>
                        <div class="notification-content">
                            <h5>${notif.title}</h5>
                            <p>${notif.message}</p>
                            <span class="notification-time">${notif.timestamp}</span>
                        </div>
                        <div>
                            <button class="mark-read" data-id="${notif.id}">
                                <i class="fas fa-circle${notif.read ? '-check' : ''}"></i>
                            </button>
                            <button class="remove-notification" data-id="${notif.id}">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    
                    item.addEventListener('click', (e) => {
                        // عدم تنفيذ الحدث إذا تم النقر على زر الحذف
                        if (e.target.closest('.remove-notification')) return;
                        
                        if (notif.action) notif.action();
                        this.markAsRead(notif.id);
                    });
                    
                    // حدث زر حذف الإشعار
                    item.querySelector('.remove-notification').addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.removeNotification(notif.id);
                    });
                    
                    list.appendChild(item);
                });
            }
            
            getNotificationIcon(type) {
                const icons = {
                    'info': 'info-circle',
                    'success': 'check-circle',
                    'warning': 'exclamation-triangle',
                    'important': 'exclamation-circle',
                    'update': 'sync-alt'
                };
                return icons[type] || 'bell';
            }
            
            markAsRead(id) {
                const notification = this.notifications.find(n => n.id === id);
                if (notification && !notification.read) {
                    notification.read = true;
                    this.unreadCount--;
                    this.saveNotifications();
                    this.renderNotifications();
                    this.updateBadge(this.unreadCount);
                }
            }
            
            markAllAsRead() {
                this.notifications.forEach(notif => notif.read = true);
                this.unreadCount = 0;
                this.saveNotifications();
                this.renderNotifications();
                this.updateBadge(0);
            }
            
            removeNotification(id) {
                const notificationIndex = this.notifications.findIndex(n => n.id === id);
                if (notificationIndex !== -1) {
                    if (!this.notifications[notificationIndex].read) {
                        this.unreadCount--;
                    }
                    this.notifications.splice(notificationIndex, 1);
                    this.saveNotifications();
                    this.renderNotifications();
                    this.updateBadge(this.unreadCount);
                }
            }
            
            clearAll() {
                if (confirm('هل أنت متأكد من مسح جميع الإشعارات؟')) {
                    this.notifications = [];
                    this.unreadCount = 0;
                    this.saveNotifications();
                    this.renderNotifications();
                    this.updateBadge(0);
                }
            }
            
            updateBadge(count) {
                const badge = document.getElementById('notificationBadge');
                if (badge) {
                    badge.textContent = count;
                    badge.style.display = count > 0 ? 'flex' : 'none';
                }
            }
            
            saveNotifications() {
                localStorage.setItem('exotisa-notifications', JSON.stringify(this.notifications));
            }
            
            loadNotifications() {
                const saved = localStorage.getItem('exotisa-notifications');
                if (saved) {
                    this.notifications = JSON.parse(saved);
                    this.unreadCount = this.notifications.filter(n => !n.read).length;
                    this.renderNotifications();
                    this.updateBadge(this.unreadCount);
                }
            }
        }

        // إنشاء نظام الإشعارات
        let notificationSystem;

        // تهيئة التطبيق عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                await fileManager.initDB();
                initApp();
            } catch (error) {
                console.error('فشل تهيئة التطبيق:', error);
                showToast('خطأ', 'error', 'فشل تحميل التطبيق. يرجى تحديث الصفحة.');
            }
        });

        // تهيئة التطبيق
        async function initApp() {
            // تحميل البيانات من localStorage
            await loadAppsFromStorage();
            
            // تهيئة نظام الإشعارات
            notificationSystem = new NotificationSystem();
            
            // تهيئة الأحداث
            setupEventListeners();
            
            // إضافة البحث الذكي
            initSmartSearch();
            
            // عرض التطبيقات
            await displayApps();
            
            // عرض التطبيقات المقترحة
            await displayFeaturedApps();
            
            // تعيين الوضع الليلي/النهاري
            const savedTheme = localStorage.getItem('exotisa-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // إظهار رسالة ترحيب
            setTimeout(() => {
                showToast('مرحبًا بك في Exotisa Store!', 'info', 'ابحث وتصفح أفضل التطبيقات لجهازك.');
            }, 1000);
            
            // التحقق من التحديثات التلقائية
            checkForAutoUpdates();
        }

        // تحميل التطبيقات من localStorage
        async function loadAppsFromStorage() {
            const savedApps = localStorage.getItem('exotisa-apps');
            
            if (savedApps) {
                try {
                    apps = JSON.parse(savedApps);
                    
                    // تحديث أيقونات التطبيقات من قاعدة البيانات
                    for (const app of apps) {
                        try {
                            const iconUrl = await fileManager.getIcon(app.id);
                            if (iconUrl) {
                                app.icon = iconUrl;
                            }
                        } catch (error) {
                            console.error(`فشل تحميل أيقونة التطبيق ${app.name}:`, error);
                        }
                    }
                } catch (error) {
                    console.error('فشل تحميل التطبيقات:', error);
                    apps = [];
                }
            } else {
                // بيانات افتراضية للتطبيقات
                apps = [
                    {
                        id: 1,
                        name: 'Exotisa Browser',
                        description: 'متصفح سريع وآمن مع وضع التصفح الخفي وحجب الإعلانات.',
                        version: '2.5.1',
                        size: 12.5,
                        category: 'exotisa',
                        developer: 'Exotisa Team',
                        icon: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png',
                        rating: 4.7,
                        ratings: [
                            {user: 'user1', rating: 5, comment: 'متصفح رائع وسريع!'},
                            {user: 'user2', rating: 4, comment: 'جيد ولكن يحتوي على بعض الأخطاء البسيطة'}
                        ],
                        downloads: 12500,
                        featured: true,
                        active: true,
                        dateAdded: '2023-10-15'
                    },
                    {
                        id: 2,
                        name: 'Photo Editor Pro',
                        description: 'محرر صور احترافي مع فلاتر وأدوات تعديل متقدمة.',
                        version: '3.2.0',
                        size: 24.8,
                        category: 'tools',
                        developer: 'Creative Apps',
                        icon: 'https://cdn-icons-png.flaticon.com/512/3245/3245415.png',
                        rating: 4.5,
                        ratings: [
                            {user: 'user3', rating: 5, comment: 'أفضل تطبيق لتحرير الصور!'}
                        ],
                        downloads: 8900,
                        featured: true,
                        active: true,
                        dateAdded: '2023-11-05'
                    },
                    {
                        id: 3,
                        name: 'Math Tutor',
                        description: 'تطبيق تعليمي يساعد في تعلم الرياضيات بطرق تفاعلية.',
                        version: '1.8.3',
                        size: 18.2,
                        category: 'education',
                        developer: 'EduTech',
                        icon: 'https://cdn-icons-png.flaticon.com/512/2936/2936886.png',
                        rating: 4.3,
                        ratings: [],
                        downloads: 5400,
                        featured: false,
                        active: true,
                        dateAdded: '2023-09-20'
                    },
                    {
                        id: 4,
                        name: 'Task Manager',
                        description: 'أداة لإدارة المهام اليومية وتنظيم الوقت بشكل فعال.',
                        version: '2.1.4',
                        size: 8.7,
                        category: 'productivity',
                        developer: 'Productive Labs',
                        icon: 'https://cdn-icons-png.flaticon.com/512/2896/2896871.png',
                        rating: 4.6,
                        ratings: [
                            {user: 'user4', rating: 5, comment: 'ساعدني في تنظيم عملي بشكل كبير'}
                        ],
                        downloads: 11200,
                        featured: false,
                        active: true,
                        dateAdded: '2023-10-30'
                    },
                    {
                        id: 5,
                        name: 'Space Shooter',
                        description: 'لعبة إطلاق نار في الفضاء مع جرافيك ثلاثي الأبعاد مذهل.',
                        version: '1.5.2',
                        size: 156.3,
                        category: 'games',
                        developer: 'Game Studio X',
                        icon: 'https://cdn-icons-png.flaticon.com/512/686/686589.png',
                        rating: 4.8,
                        ratings: [
                            {user: 'user5', rating: 5, comment: 'إدماني! الجرافيك رائع'},
                            {user: 'user6', rating: 4, comment: 'جيدة ولكن تحتوي على إعلانات كثيرة'}
                        ],
                        downloads: 21500,
                        featured: true,
                        active: true,
                        dateAdded: '2023-11-10'
                    },
                    {
                        id: 6,
                        name: 'Business Calculator',
                        description: 'آلة حاسبة متقدمة مع أدوات مالية ومعدلات تحويل.',
                        version: '1.0.9',
                        size: 5.2,
                        category: 'business',
                        developer: 'Finance Tools',
                        icon: 'https://cdn-icons-png.flaticon.com/512/3448/3448593.png',
                        rating: 4.0,
                        ratings: [],
                        downloads: 3200,
                        featured: false,
                        active: true,
                        dateAdded: '2023-08-15'
                    },
                    {
                        id: 7,
                        name: 'System Cleaner',
                        description: 'أداة لتنظيف وتحسين أداء الجهاز وحذف الملفات غير الضرورية.',
                        version: '2.7.3',
                        size: 14.6,
                        category: 'system',
                        developer: 'System Tools Pro',
                        icon: 'https://cdn-icons-png.flaticon.com/512/3038/3038795.png',
                        rating: 4.4,
                        ratings: [
                            {user: 'user7', rating: 4, comment: 'جيد ولكنه يحتاج إلى مزيد من الميزات'}
                        ],
                        downloads: 9800,
                        featured: false,
                        active: true,
                        dateAdded: '2023-10-05'
                    },
                    {
                        id: 8,
                        name: 'Exotisa Security',
                        description: 'تطبيق حماية متكامل مع مضاد فيروسات وجدار حماية.',
                        version: '1.3.0',
                        size: 32.7,
                        category: 'exotisa',
                        developer: 'Exotisa Team',
                        icon: 'https://cdn-icons-png.flaticon.com/512/2917/2917995.png',
                        rating: 4.9,
                        ratings: [
                            {user: 'user8', rating: 5, comment: 'أشعر بأمان تام عند استخدامه'}
                        ],
                        downloads: 8700,
                        featured: true,
                        active: true,
                        dateAdded: '2023-11-12'
                    }
                ];
                
                saveAppsToStorage();
            }
            
            // تحديث إحصائيات لوحة الإدارة
            updateAdminStats();
        }

        // حفظ التطبيقات في localStorage
        function saveAppsToStorage() {
            localStorage.setItem('exotisa-apps', JSON.stringify(apps));
            updateAdminStats();
        }

        // تهيئة البحث الذكي
        function initSmartSearch() {
            const searchInput = document.getElementById('searchInput');
            const suggestionsContainer = document.getElementById('searchSuggestions');

            let searchTimeout;
            let lastSearchTerm = '';

            searchInput.addEventListener('input', async function(e) {
                const term = e.target.value.trim().toLowerCase();
                
                // التحقق من كلمات المرور المشفرة
                if (btoa(term) === ENCODED_ADMIN_KEY) {
                    activateAdminMode();
                    e.target.value = '';
                    return;
                }
                
                if (btoa(term) === ENCODED_DEVELOPER_KEY) {
                    activateDeveloperMode();
                    e.target.value = '';
                    return;
                }
                
                if (term === lastSearchTerm) return;
                lastSearchTerm = term;
                
                clearTimeout(searchTimeout);
                
                if (term.length < 2) {
                    suggestionsContainer.style.display = 'none';
                    return;
                }
                
                searchTimeout = setTimeout(async () => {
                    await showSearchSuggestions(term);
                }, 300);
            });

            // إغلاق الاقتراحات عند النقر خارجها
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-input-container')) {
                    suggestionsContainer.style.display = 'none';
                }
            });

            // البحث عند الضغط على Enter
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSmartSearch(this.value);
                    suggestionsContainer.style.display = 'none';
                }
            });
        }

        // إظهار اقتراحات البحث
        async function showSearchSuggestions(term) {
            const container = document.getElementById('searchSuggestions');
            container.innerHTML = '';
            
            if (!term) {
                container.style.display = 'none';
                return;
            }

            // البحث في عدة معايير
            const results = apps.filter(app => {
                const searchableText = `
                    ${app.name} 
                    ${app.description} 
                    ${app.developer} 
                    ${app.category}
                    ${app.version}
                `.toLowerCase();

                return searchableText.includes(term);
            });

            if (results.length === 0) {
                container.innerHTML = `
                    <div class="search-suggestion-item">
                        <i class="fas fa-search"></i>
                        لا توجد نتائج لـ "${term}"
                    </div>
                `;
            } else {
                results.slice(0, 5).forEach(app => {
                    const item = document.createElement('div');
                    item.className = 'search-suggestion-item';
                    item.innerHTML = `
                        <div class="suggestion-icon">
                            ${app.icon ? `<img src="${app.icon}" alt="${app.name}">` : '<i class="fas fa-mobile-alt"></i>'}
                        </div>
                        <div class="suggestion-info">
                            <div class="suggestion-title">${app.name}</div>
                            <div class="suggestion-subtitle">${app.developer} • ${app.category}</div>
                        </div>
                        <div class="suggestion-action">
                            <i class="fas fa-chevron-left"></i>
                        </div>
                    `;
                    
                    item.addEventListener('click', () => {
                        document.getElementById('searchInput').value = app.name;
                        container.style.display = 'none';
                        filterAppsBySearch(app.name);
                        scrollToApp(app.id);
                    });
                    
                    container.appendChild(item);
                });
            }
            
            container.style.display = 'block';
        }

        // تنفيذ البحث الذكي
        function performSmartSearch(term) {
            if (!term.trim()) {
                displayApps();
                return;
            }

            const filteredApps = apps.filter(app => {
                const searchTerms = term.toLowerCase().split(' ');
                const appText = `
                    ${app.name} ${app.description} ${app.developer} ${app.category}
                `.toLowerCase();

                return searchTerms.every(searchTerm => appText.includes(searchTerm));
            });

            displaySearchResults(filteredApps, term);
        }

        // عرض نتائج البحث
        async function displaySearchResults(filteredApps, searchTerm) {
            const appsGrid = document.getElementById('appsGrid');
            
            if (filteredApps.length === 0) {
                appsGrid.innerHTML = `
                    <div class="search-no-results">
                        <i class="fas fa-search fa-3x"></i>
                        <h3>لا توجد نتائج</h3>
                        <p>لم نتمكن من العثور على تطبيقات تطابق بحثك: "${searchTerm}"</p>
                        <button class="btn btn-primary" id="clearSearch">
                            <i class="fas fa-times"></i> مسح البحث
                        </button>
                    </div>
                `;
                
                document.getElementById('clearSearch').addEventListener('click', () => {
                    document.getElementById('searchInput').value = '';
                    displayApps();
                });
                return;
            }

            appsGrid.innerHTML = '';
            
            // إظهار عدد النتائج
            const resultsHeader = document.createElement('div');
            resultsHeader.className = 'search-results-header';
            resultsHeader.innerHTML = `
                <h3><i class="fas fa-search"></i> نتائج البحث: "${searchTerm}"</h3>
                <span class="results-count">${filteredApps.length} تطبيق</span>
            `;
            appsGrid.parentNode.insertBefore(resultsHeader, appsGrid);

            for (const app of filteredApps) {
                const appCard = await createAppCard(app);
                appsGrid.appendChild(appCard);
            }
        }

        function filterAppsBySearch(term) {
            currentCategory = 'all';
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.category === 'all') btn.classList.add('active');
            });
            
            performSmartSearch(term);
        }

        function scrollToApp(appId) {
            const appElement = document.querySelector(`.app-card[data-id="${appId}"]`);
            if (appElement) {
                appElement.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'center'
                });
                
                // إضافة تأثير تمييز
                appElement.style.boxShadow = '0 0 0 3px var(--accent-color)';
                setTimeout(() => {
                    appElement.style.boxShadow = '';
                }, 2000);
            }
        }

        // تهيئة مستمعي الأحداث
        function setupEventListeners() {
            // البحث
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            document.getElementById('searchButton').addEventListener('click', handleSearch);
            
            // الضغط على Enter في شريط البحث
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            
            // فئات التطبيقات
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentCategory = this.dataset.category;
                    displayApps();
                });
            });
            
            // روابط التصنيفات في التذييل
            document.querySelectorAll('.footer-section a[data-category]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.dataset.category;
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    document.querySelector(`.category-btn[data-category="${category}"]`).classList.add('active');
                    currentCategory = category;
                    displayApps();
                    
                    // التمرير إلى قسم التطبيقات
                    document.querySelector('.apps-section').scrollIntoView({ behavior: 'smooth' });
                });
            });
            
            // فرز التطبيقات
            document.getElementById('sortSelect').addEventListener('change', function() {
                currentSort = this.value;
                displayApps();
            });
            
            // تبديل الوضع الليلي/النهاري
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // تحديث التطبيقات
            document.getElementById('refreshBtn').addEventListener('click', async function() {
                showSkeletonLoader(true);
                setTimeout(async () => {
                    await displayApps();
                    await displayFeaturedApps();
                    showSkeletonLoader(false);
                    showToast('تم التحديث', 'success', 'تم تحديث قائمة التطبيقات بنجاح.');
                }, 800);
            });
            
            // الإشعارات
            document.getElementById('notificationBtn').addEventListener('click', toggleNotificationPanel);
            document.getElementById('closeNotificationsPanel').addEventListener('click', () => {
                document.getElementById('notificationPanel').classList.remove('active');
            });
            document.getElementById('markAllRead')?.addEventListener('click', () => {
                if (notificationSystem) notificationSystem.markAllAsRead();
            });
            document.getElementById('clearNotifications')?.addEventListener('click', () => {
                if (notificationSystem) notificationSystem.clearAll();
            });
            
            // إغلاق لوحة الإدارة
            document.getElementById('closeAdminPanel').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.remove('active');
                adminMode = false;
            });
            
            // تبديل علامات التبويب في لوحة الإدارة
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // إزالة النشاط من جميع علامات التبويب والمحتويات
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
                    
                    // إضافة النشاط للعلامة والمحتوى المحدد
                    this.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // رفع ملف APK
            document.getElementById('appApk').addEventListener('change', function() {
                const fileName = this.files.length > 0 ? this.files[0].name : 'لم يتم اختيار ملف';
                document.getElementById('apkFileName').textContent = fileName;
            });
            
            // رفع صورة الأيقونة
            document.getElementById('appIconFile').addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    document.getElementById('iconFileName').textContent = file.name;
                    
                    // معاينة الصورة
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('iconPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    document.getElementById('iconFileName').textContent = 'لم يتم اختيار ملف';
                    document.getElementById('iconPreview').style.display = 'none';
                }
            });
            
            // إضافة تطبيق جديد
            document.getElementById('addAppForm').addEventListener('submit', addNewApp);
            
            // إغلاق النوافذ المنبثقة
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                });
            });
            
            // إغلاق النوافذ عند النقر خارجها
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            // إرسال التقييم
            document.getElementById('submitRating').addEventListener('click', submitRating);
            
            // اختيار النجوم في نافذة التقييم
            document.querySelectorAll('#ratingStars i').forEach(star => {
                star.addEventListener('click', function() {
                    const rating = parseInt(this.dataset.rating);
                    highlightStars(rating);
                    document.getElementById('selectedRatingText').textContent = `تقييمك: ${rating} من 5`;
                });
            });
            
            // زر تحميل المزيد
            document.getElementById('loadMoreBtn').addEventListener('click', loadMoreApps);
        }

        // عرض التطبيقات
        let currentPage = 0;
        const appsPerPage = 8;
        let isLoading = false;

        async function displayApps() {
            const appsGrid = document.getElementById('appsGrid');
            
            // تصفية التطبيقات حسب الفئة
            let filteredApps = apps.filter(app => {
                if (currentCategory === 'all') return true;
                return app.category === currentCategory;
            });
            
            // فرز التطبيقات
            filteredApps.sort((a, b) => {
                switch(currentSort) {
                    case 'rating':
                        return b.rating - a.rating;
                    case 'downloads':
                        return b.downloads - a.downloads;
                    case 'date':
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                    case 'name':
                        return a.name.localeCompare(b.name, 'ar');
                    default:
                        return 0;
                }
            });
            
            // عرض التطبيقات النشطة فقط للمستخدمين العاديين
            if (!adminMode && !developerMode) {
                filteredApps = filteredApps.filter(app => app.active);
            }
            
            // إنشاء بطاقات التطبيقات
            appsGrid.innerHTML = '';
            
            if (filteredApps.length === 0) {
                appsGrid.innerHTML = `
                    <div class="no-apps">
                        <i class="fas fa-box-open"></i>
                        <h3>لا توجد تطبيقات متاحة</h3>
                        <p>لم يتم العثور على تطبيقات في هذه الفئة. حاول البحث في فئة أخرى.</p>
                    </div>
                `;
                document.getElementById('loadMoreBtn').style.display = 'none';
                return;
            }
            
            // إعادة تعيين الصفحة
            currentPage = 0;
            
            // تحميل الدفعة الأولى
            await loadMoreApps();
        }

        async function loadMoreApps() {
            if (isLoading) return;
            
            isLoading = true;
            showSkeletonLoader(true);
            
            // محاكاة تأخير الشبكة
            await new Promise(resolve => setTimeout(resolve, 300));
            
            // تصفية التطبيقات حسب الفئة
            let filteredApps = apps.filter(app => {
                if (currentCategory === 'all') return true;
                return app.category === currentCategory;
            });
            
            // فرز التطبيقات
            filteredApps.sort((a, b) => {
                switch(currentSort) {
                    case 'rating':
                        return b.rating - a.rating;
                    case 'downloads':
                        return b.downloads - a.downloads;
                    case 'date':
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                    case 'name':
                        return a.name.localeCompare(b.name, 'ar');
                    default:
                        return 0;
                }
            });
            
            // عرض التطبيقات النشطة فقط للمستخدمين العاديين
            if (!adminMode && !developerMode) {
                filteredApps = filteredApps.filter(app => app.active);
            }
            
            const start = currentPage * appsPerPage;
            const end = start + appsPerPage;
            const appsToShow = filteredApps.slice(start, end);
            
            if (appsToShow.length > 0) {
                const appsGrid = document.getElementById('appsGrid');
                
                // إزالة رسالة "لا توجد تطبيقات" إذا كانت موجودة
                const noAppsMsg = appsGrid.querySelector('.no-apps');
                if (noAppsMsg) noAppsMsg.remove();
                
                for (const app of appsToShow) {
                    const appCard = await createAppCard(app);
                    appsGrid.appendChild(appCard);
                }
                
                currentPage++;
                
                // إظهار زر "تحميل المزيد" إذا كان هناك المزيد من التطبيقات
                if (end < filteredApps.length) {
                    document.getElementById('loadMoreBtn').style.display = 'block';
                } else {
                    document.getElementById('loadMoreBtn').style.display = 'none';
                }
            } else if (currentPage === 0) {
                // لا توجد تطبيقات للعرض
                document.getElementById('loadMoreBtn').style.display = 'none';
            }
            
            showSkeletonLoader(false);
            isLoading = false;
        }

        // عرض التطبيقات المقترحة
        async function displayFeaturedApps() {
            const featuredAppsContainer = document.getElementById('featuredApps');
            
            // الحصول على التطبيقات المميزة والنشطة
            const featuredApps = apps.filter(app => app.featured && app.active);
            
            // إذا لم يكن هناك تطبيقات مميزة، عرض رسالة
            if (featuredApps.length === 0) {
                featuredAppsContainer.innerHTML = `
                    <div class="no-featured">
                        <p>لا توجد تطبيقات مميزة حالياً.</p>
                    </div>
                `;
                return;
            }
            
            // عرض التطبيقات المميزة
            featuredAppsContainer.innerHTML = '';
            
            // عرض أول 3 تطبيقات مميزة فقط
            for (const app of featuredApps.slice(0, 3)) {
                const appCard = await createAppCard(app, true);
                featuredAppsContainer.appendChild(appCard);
            }
        }

        // إنشاء بطاقة تطبيق
        async function createAppCard(app, isFeatured = false) {
            const card = document.createElement('div');
            card.className = `app-card ${isFeatured ? 'featured' : ''} ${!app.active ? 'disabled' : ''}`;
            card.dataset.id = app.id;
            
            // إنشاء أيقونة التطبيق
            let iconHTML = `<i class="fas fa-mobile-alt"></i>`;
            if (app.icon) {
                iconHTML = `<img src="${app.icon}" alt="${app.name}" onerror="this.onerror=null; this.parentElement.innerHTML='<i class=\\'fas fa-mobile-alt\\'></i>';">`;
            }
            
            // إنشاء النجوم
            const starsHTML = createStarsHTML(app.rating);
            
            // إنشاء تاريخ الإضافة
            const dateAdded = app.dateAdded ? new Date(app.dateAdded).toLocaleDateString('ar-EG') : 'غير محدد';
            
            card.innerHTML = `
                <div class="app-header">
                    <div class="app-icon">
                        ${iconHTML}
                    </div>
                    <div class="app-info">
                        <h3>${app.name}</h3>
                        <p>${app.developer}</p>
                        <div class="app-meta">
                            <span><i class="fas fa-code-branch"></i> ${app.version}</span>
                            <span><i class="fas fa-weight-hanging"></i> ${app.size} MB</span>
                            <span><i class="fas fa-calendar-alt"></i> ${dateAdded}</span>
                        </div>
                    </div>
                </div>
                <div class="app-body">
                    <p class="app-description">${app.description}</p>
                    <div class="app-rating">
                        <div class="stars">${starsHTML}</div>
                        <span class="rating-value">${app.rating.toFixed(1)}</span>
                        <span class="rating-count">(${app.ratings.length})</span>
                        <button class="rate-btn btn-sm" data-id="${app.id}">
                            <i class="fas fa-star"></i> قيم
                        </button>
                    </div>
                </div>
                <div class="app-footer">
                    <button class="download-btn ${!app.active ? 'disabled' : ''}" data-id="${app.id}" ${!app.active ? 'disabled' : ''}>
                        <i class="fas fa-download"></i> تحميل APK
                    </button>
                    <div class="download-count">
                        <i class="fas fa-download"></i> ${formatNumber(app.downloads)}
                    </div>
                </div>
            `;
            
            // إضافة أحداث للزرين الأساسيين
            const downloadBtn = card.querySelector('.download-btn');
            const rateBtn = card.querySelector('.rate-btn');
            
            if (app.active) {
                downloadBtn.addEventListener('click', () => downloadApp(app.id, app.name));
                rateBtn.addEventListener('click', () => openRatingModal(app.id));
            }
            
            // إضافة زر المعاينة
            const previewBtn = document.createElement('button');
            previewBtn.className = 'btn btn-sm btn-secondary preview-app';
            previewBtn.dataset.id = app.id;
            previewBtn.innerHTML = '<i class="fas fa-eye"></i> معاينة';
            previewBtn.addEventListener('click', () => openPreviewModal(app.id));
            
            // إضافة زر المعاينة قبل زر التحميل
            card.querySelector('.app-footer').insertBefore(previewBtn, downloadBtn);
            
            // إذا كان وضع الإدارة أو المطور نشطًا، أضف أزرار التحكم
            if (adminMode || developerMode) {
                const adminControls = document.createElement('div');
                adminControls.className = 'admin-controls';
                adminControls.innerHTML = `
                    <button class="btn btn-sm edit-app" data-id="${app.id}">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger delete-app" data-id="${app.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-sm toggle-app" data-id="${app.id}" data-active="${app.active}">
                        <i class="fas fa-power-off"></i>
                    </button>
                `;
                
                card.querySelector('.app-footer').appendChild(adminControls);
                
                // إضافة أحداث التحكم
                card.querySelector('.edit-app').addEventListener('click', () => editApp(app.id));
                card.querySelector('.delete-app').addEventListener('click', () => deleteApp(app.id));
                card.querySelector('.toggle-app').addEventListener('click', () => toggleAppStatus(app.id));
            }
            
            return card;
        }

        // إنشاء نجوم التقييم
        function createStarsHTML(rating) {
            let starsHTML = '';
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    starsHTML += '<i class="fas fa-star"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    starsHTML += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    starsHTML += '<i class="far fa-star"></i>';
                }
            }
            
            return starsHTML;
        }

        // البحث عن التطبيقات
        function handleSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput.value.trim().toLowerCase();
            
            if (!searchTerm) {
                displayApps();
                return;
            }
            
            performSmartSearch(searchTerm);
        }

        // تنشيط وضع الإدارة
        function activateAdminMode() {
            adminMode = true;
            
            // إظهار لوحة الإدارة
            document.getElementById('adminPanel').classList.add('active');
            
            // تحديث قائمة التطبيقات في لوحة الإدارة
            updateAdminAppsList();
            
            // إعادة عرض التطبيقات لإظهار أزرار التحكم
            displayApps();
            
            // إظهار إشعار
            showToast('تم تفعيل وضع الإدارة', 'success', 'يمكنك الآن إدارة التطبيقات بشكل كامل.');
            
            // إضافة إشعار
            if (notificationSystem) {
                notificationSystem.addNotification(
                    'وضع الإدارة مفعل',
                    'يمكنك الآن إدارة جميع التطبيقات في المتجر',
                    'info'
                );
            }
        }

        // تنشيط وضع المطور
        function activateDeveloperMode() {
            const password = prompt('🔐 أدخل كلمة سر وضع المطور:');
            
            if (btoa(password) === ENCODED_DEVELOPER_KEY) {
                developerMode = true;
                currentDeveloper = prompt('👤 أدخل اسم المطور:') || 'مطور مجهول';
                
                // إضافة زر المطور في الهيدر
                addDeveloperControls();
                
                // إضافة قسم المطور في لوحة الإدارة
                addDeveloperTab();
                
                showToast('تم تفعيل وضع المطور', 'success', `مرحبًا ${currentDeveloper}! يمكنك الآن إدارة تطبيقاتك.`);
                
                // حفظ وضع المطور
                localStorage.setItem('exotisa-developer-mode', 'true');
                localStorage.setItem('exotisa-developer-name', currentDeveloper);
                
                // إضافة إشعار
                if (notificationSystem) {
                    notificationSystem.addNotification(
                        'وضع المطور مفعل',
                        `مرحبًا ${currentDeveloper}! يمكنك الآن إدارة تطبيقاتك`,
                        'success',
                        () => showDeveloperDashboard()
                    );
                }
                
                return true;
            } else {
                showToast('خطأ', 'error', 'كلمة السر غير صحيحة');
                return false;
            }
        }

        function addDeveloperControls() {
            const headerControls = document.querySelector('.header-controls');
            
            // إزالة زر المطور إذا كان موجودًا
            const existingDevBtn = document.getElementById('developerBtn');
            if (existingDevBtn) existingDevBtn.remove();
            
            const developerBtn = document.createElement('button');
            developerBtn.id = 'developerBtn';
            developerBtn.className = 'icon-btn';
            developerBtn.title = 'وضع المطور';
            developerBtn.innerHTML = '<i class="fas fa-code"></i>';
            
            developerBtn.addEventListener('click', () => {
                showDeveloperDashboard();
            });
            
            headerControls.insertBefore(developerBtn, headerControls.firstChild);
        }

        function addDeveloperTab() {
            const adminTabs = document.querySelector('.admin-tabs');
            
            const developerTab = document.createElement('button');
            developerTab.className = 'admin-tab';
            developerTab.dataset.tab = 'developer';
            developerTab.innerHTML = '<i class="fas fa-code"></i> لوحة المطور';
            
            developerTab.addEventListener('click', () => {
                showDeveloperDashboard();
            });
            
            adminTabs.appendChild(developerTab);
            
            // إضافة محتوى لوحة المطور
            const adminContent = document.querySelector('.admin-content');
            
            const developerTabContent = document.createElement('div');
            developerTabContent.className = 'admin-tab-content';
            developerTabContent.id = 'developer-tab';
            developerTabContent.innerHTML = `
                <div class="developer-dashboard">
                    <div class="developer-header">
                        <h3><i class="fas fa-user-tie"></i> لوحة تحكم المطور</h3>
                        <div class="developer-info">
                            <span class="developer-name">${currentDeveloper}</span>
                            <span class="developer-badge">مطور</span>
                        </div>
                    </div>
                    
                    <div class="live-stats" id="liveStats"></div>
                    
                    <div class="developer-stats">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h4>تطبيقاتي</h4>
                                <p id="myAppsCount">0</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-download"></i>
                            </div>
                            <div class="stat-info">
                                <h4>إجمالي تحميلاتي</h4>
                                <p id="myAppsDownloads">0</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat-info">
                                <h4>متوسط تقييماتي</h4>
                                <p id="myAppsRating">0.0</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h4>معدل النمو</h4>
                                <p id="myGrowthRate">0%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="developer-apps-section">
                        <h4><i class="fas fa-th-large"></i> تطبيقاتي</h4>
                        <div class="developer-apps-list" id="developerAppsList"></div>
                    </div>
                    
                    <div class="developer-tools">
                        <h4><i class="fas fa-tools"></i> أدوات المطور</h4>
                        <div class="tools-grid">
                            <button class="tool-card" id="quickUpdate">
                                <i class="fas fa-sync-alt"></i>
                                <span>تحديث سريع</span>
                            </button>
                            <button class="tool-card" id="analyticsBtn">
                                <i class="fas fa-chart-pie"></i>
                                <span>تحليلات مفصلة</span>
                            </button>
                            <button class="tool-card" id="backupBtn">
                                <i class="fas fa-save"></i>
                                <span>نسخ احتياطي</span>
                            </button>
                            <button class="tool-card" id="exportBtn">
                                <i class="fas fa-file-export"></i>
                                <span>تصدير البيانات</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            adminContent.appendChild(developerTabContent);
            
            // تحديث إحصائيات المطور
            updateDeveloperStats();
            updateLiveStats();
            
            // إضافة أحداث لأدوات المطور
            document.getElementById('quickUpdate').addEventListener('click', quickUpdateApps);
            document.getElementById('analyticsBtn').addEventListener('click', showAnalytics);
            document.getElementById('backupBtn').addEventListener('click', backupDeveloperData);
            document.getElementById('exportBtn').addEventListener('click', exportDeveloperData);
            
            // تحديث الإحصائيات الحية كل 30 ثانية
            setInterval(updateLiveStats, 30000);
        }

        function showDeveloperDashboard() {
            if (!developerMode) {
                if (!activateDeveloperMode()) return;
            }
            
            document.getElementById('adminPanel').classList.add('active');
            
            // التبديل إلى تبويب المطور
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(content => content.classList.remove('active'));
            
            const developerTab = document.querySelector('.admin-tab[data-tab="developer"]');
            if (developerTab) {
                developerTab.classList.add('active');
                document.getElementById('developer-tab').classList.add('active');
            }
            
            // تحديث الإحصائيات
            updateDeveloperStats();
            updateLiveStats();
        }

        function updateDeveloperStats() {
            if (!currentDeveloper) return;
            
            const myApps = apps.filter(app => app.developer === currentDeveloper);
            const myAppsCount = myApps.length;
            const myAppsDownloads = myApps.reduce((sum, app) => sum + app.downloads, 0);
            const myAppsRating = myApps.length > 0 ? 
                myApps.reduce((sum, app) => sum + app.rating, 0) / myApps.length : 0;
            
            const growthRate = myApps.length > 0 ? 
                Math.min(100, Math.floor((myAppsDownloads / (myApps.length * 1000)) * 100)) : 0;
            
            if (document.getElementById('myAppsCount')) {
                document.getElementById('myAppsCount').textContent = myAppsCount;
                document.getElementById('myAppsDownloads').textContent = formatNumber(myAppsDownloads);
                document.getElementById('myAppsRating').textContent = myAppsRating.toFixed(1);
                document.getElementById('myGrowthRate').textContent = `${growthRate}%`;
            }
            
            updateDeveloperAppsList(myApps);
        }

        function updateLiveStats() {
            if (!developerMode || !currentDeveloper) return;
            
            const stats = {
                activeUsers: Math.floor(Math.random() * 10000) + 5000,
                downloadsToday: Math.floor(Math.random() * 1000) + 100,
                conversionRate: (Math.random() * 10 + 5).toFixed(1)
            };
            
            const liveStatsElement = document.getElementById('liveStats');
            if (!liveStatsElement) return;
            
            liveStatsElement.innerHTML = `
                <h4><i class="fas fa-chart-line"></i> إحصائيات حية</h4>
                <div class="live-stats-grid">
                    <div class="live-stat">
                        <span class="live-stat-label">المستخدمون النشطون</span>
                        <span class="live-stat-value">${formatNumber(stats.activeUsers)}</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-stat-label">التحميلات اليوم</span>
                        <span class="live-stat-value">+${stats.downloadsToday}</span>
                    </div>
                    <div class="live-stat">
                        <span class="live-stat-label">معدل التحويل</span>
                        <span class="live-stat-value">${stats.conversionRate}%</span>
                    </div>
                </div>
            `;
        }

        function updateDeveloperAppsList(myApps) {
            const developerAppsList = document.getElementById('developerAppsList');
            if (!developerAppsList) return;
            
            developerAppsList.innerHTML = '';
            
            if (myApps.length === 0) {
                developerAppsList.innerHTML = `
                    <div class="no-apps">
                        <i class="fas fa-box-open fa-2x"></i>
                        <h4>لا توجد تطبيقات</h4>
                        <p>لم تقم بإضافة أي تطبيقات بعد.</p>
                        <button class="btn btn-primary" onclick="document.querySelector('.admin-tab[data-tab=\\'add-app\\']').click()">
                            <i class="fas fa-plus"></i> إضافة أول تطبيق
                        </button>
                    </div>
                `;
                return;
            }
            
            myApps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'developer-app-item';
                appItem.innerHTML = `
                    <div class="developer-app-main">
                        <div class="developer-app-icon">
                            ${app.icon ? `<img src="${app.icon}" alt="${app.name}">` : '<i class="fas fa-mobile-alt"></i>'}
                        </div>
                        <div class="developer-app-info">
                            <h4>${app.name} <span class="app-version">v${app.version}</span></h4>
                            <div class="app-meta">
                                <span><i class="fas fa-download"></i> ${formatNumber(app.downloads)}</span>
                                <span><i class="fas fa-star"></i> ${app.rating.toFixed(1)}</span>
                                <span><i class="fas fa-calendar"></i> ${app.dateAdded}</span>
                                <span class="status-badge ${app.active ? 'active' : 'inactive'}">
                                    <i class="fas fa-circle"></i> ${app.active ? 'نشط' : 'معطل'}
                                </span>
                            </div>
                            <p class="app-description">${app.description}</p>
                        </div>
                    </div>
                    <div class="developer-app-actions">
                        <button class="btn btn-sm edit-app" data-id="${app.id}">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-sm btn-primary update-app" data-id="${app.id}">
                            <i class="fas fa-upload"></i> تحديث
                        </button>
                        <button class="btn btn-sm btn-info stats-app" data-id="${app.id}">
                            <i class="fas fa-chart-bar"></i> إحصائيات
                        </button>
                        <button class="btn btn-sm btn-danger delete-app" data-id="${app.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                
                developerAppsList.appendChild(appItem);
                
                // إضافة الأحداث
                appItem.querySelector('.edit-app').addEventListener('click', () => editApp(app.id));
                appItem.querySelector('.update-app').addEventListener('click', () => updateAppVersion(app.id));
                appItem.querySelector('.stats-app').addEventListener('click', () => showAppStats(app.id));
                appItem.querySelector('.delete-app').addEventListener('click', () => deleteApp(app.id));
            });
        }

        // فتح نافذة معاينة التطبيق
        function openPreviewModal(appId) {
            const app = apps.find(app => app.id === appId);
            
            if (!app) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = `
                <div class="app-preview">
                    <div class="preview-header">
                        <div class="preview-icon">
                            ${app.icon ? `<img src="${app.icon}" alt="${app.name}">` : '<i class="fas fa-mobile-alt fa-3x"></i>'}
                        </div>
                        <div class="preview-info">
                            <h3>${app.name}</h3>
                            <p class="developer">بواسطة ${app.developer}</p>
                            <div class="preview-meta">
                                <span><i class="fas fa-code-branch"></i> الإصدار ${app.version}</span>
                                <span><i class="fas fa-weight-hanging"></i> ${app.size} MB</span>
                                <span><i class="fas fa-star"></i> ${app.rating.toFixed(1)} (${app.ratings.length} تقييم)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-body">
                        <h4><i class="fas fa-info-circle"></i> الوصف</h4>
                        <p>${app.description}</p>
                        
                        <div class="preview-details">
                            <div class="detail-row">
                                <span class="detail-label">الفئة:</span>
                                <span class="detail-value">${getCategoryName(app.category)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">تاريخ الإضافة:</span>
                                <span class="detail-value">${app.dateAdded}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">إجمالي التحميلات:</span>
                                <span class="detail-value">${formatNumber(app.downloads)}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">الحالة:</span>
                                <span class="detail-value ${app.active ? 'active' : 'inactive'}">${app.active ? 'نشط' : 'معطل'}</span>
                            </div>
                        </div>
                        
                        <div class="preview-actions">
                            <button class="btn btn-primary download-from-preview" data-id="${app.id}" ${!app.active ? 'disabled' : ''}>
                                <i class="fas fa-download"></i> تحميل APK (${app.size} MB)
                            </button>
                            <button class="btn btn-secondary rate-from-preview" data-id="${app.id}">
                                <i class="fas fa-star"></i> قيم التطبيق
                            </button>
                        </div>
                        
                        ${app.ratings.length > 0 ? `
                        <div class="preview-reviews">
                            <h4><i class="fas fa-comments"></i> آخر التقييمات</h4>
                            <div class="reviews-list">
                                ${app.ratings.slice(0, 3).map(rating => `
                                    <div class="review-item">
                                        <div class="review-header">
                                            <span class="review-user">${rating.user}</span>
                                            <span class="review-stars">${createStarsHTML(rating.rating)}</span>
                                        </div>
                                        ${rating.comment ? `<p class="review-comment">${rating.comment}</p>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
            
            // إضافة الأحداث للأزرار
            previewContent.querySelector('.download-from-preview').addEventListener('click', () => {
                downloadApp(app.id, app.name);
                document.getElementById('previewModal').classList.remove('active');
            });
            
            previewContent.querySelector('.rate-from-preview').addEventListener('click', () => {
                document.getElementById('previewModal').classList.remove('active');
                openRatingModal(app.id);
            });
            
            document.getElementById('previewModal').classList.add('active');
        }

        // دالة للحصول على اسم الفئة
        function getCategoryName(category) {
            const categories = {
                'games': 'ألعاب',
                'tools': 'أدوات',
                'productivity': 'إنتاجية',
                'education': 'تعليم',
                'business': 'أعمال',
                'system': 'أنظمة',
                'exotisa': 'Exotisa Apps'
            };
            return categories[category] || category;
        }

        // تحديث قائمة التطبيقات في لوحة الإدارة
        function updateAdminAppsList() {
            const adminAppsList = document.getElementById('adminAppsList');
            adminAppsList.innerHTML = '';
            
            if (apps.length === 0) {
                adminAppsList.innerHTML = '<p class="no-apps">لا توجد تطبيقات مضافة بعد.</p>';
                return;
            }
            
            apps.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = 'admin-app-item';
                appItem.innerHTML = `
                    <div class="admin-app-info">
                        <div class="admin-app-icon">
                            ${app.icon ? `<img src="${app.icon}" alt="${app.name}">` : '<i class="fas fa-mobile-alt"></i>'}
                        </div>
                        <div class="admin-app-details">
                            <h4>${app.name} ${!app.active ? '(معطل)' : ''}</h4>
                            <p>${app.developer} | ${app.category} | ${app.downloads} تحميل</p>
                            <p>الإصدار: ${app.version} | الحجم: ${app.size} MB</p>
                        </div>
                    </div>
                    <div class="admin-app-actions">
                        <button class="btn btn-sm edit-app" data-id="${app.id}">
                            <i class="fas fa-edit"></i> تعديل
                        </button>
                        <button class="btn btn-sm btn-danger delete-app" data-id="${app.id}">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                        <button class="btn btn-sm toggle-app" data-id="${app.id}" data-active="${app.active}">
                            <i class="fas fa-power-off"></i> ${app.active ? 'تعطيل' : 'تفعيل'}
                        </button>
                    </div>
                `;
                
                adminAppsList.appendChild(appItem);
                
                // إضافة أحداث التحكم
                appItem.querySelector('.edit-app').addEventListener('click', () => editApp(app.id));
                appItem.querySelector('.delete-app').addEventListener('click', () => deleteApp(app.id));
                appItem.querySelector('.toggle-app').addEventListener('click', () => toggleAppStatus(app.id));
            });
        }

        // تحديث إحصائيات لوحة الإدارة
        function updateAdminStats() {
            if (apps.length === 0) {
                document.getElementById('totalApps').textContent = '0';
                document.getElementById('totalDownloads').textContent = '0';
                document.getElementById('avgRating').textContent = '0.0';
                document.getElementById('activeApps').textContent = '0';
                updateCategoryChart();
                return;
            }
            
            const totalApps = apps.length;
            const totalDownloads = apps.reduce((sum, app) => sum + app.downloads, 0);
            const avgRating = apps.reduce((sum, app) => sum + app.rating, 0) / apps.length;
            const activeApps = apps.filter(app => app.active).length;
            
            document.getElementById('totalApps').textContent = totalApps;
            document.getElementById('totalDownloads').textContent = formatNumber(totalDownloads);
            document.getElementById('avgRating').textContent = avgRating.toFixed(1);
            document.getElementById('activeApps').textContent = activeApps;
            
            updateCategoryChart();
        }

        // تحديث مخطط الفئات
        function updateCategoryChart() {
            const categoryChart = document.getElementById('categoryChart');
            
            const categoryCounts = {};
            apps.forEach(app => {
                if (!categoryCounts[app.category]) {
                    categoryCounts[app.category] = 0;
                }
                categoryCounts[app.category]++;
            });
            
            const categoryNames = {
                'games': 'ألعاب',
                'tools': 'أدوات',
                'productivity': 'إنتاجية',
                'education': 'تعليم',
                'business': 'أعمال',
                'system': 'أنظمة',
                'exotisa': 'Exotisa Apps'
            };
            
            const maxCount = Math.max(...Object.values(categoryCounts));
            
            categoryChart.innerHTML = '';
            
            for (const [category, count] of Object.entries(categoryCounts)) {
                const heightPercentage = (count / maxCount) * 100;
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = `${heightPercentage}%`;
                bar.title = `${categoryNames[category]}: ${count} تطبيقات`;
                
                const label = document.createElement('div');
                label.className = 'chart-bar-label';
                label.textContent = categoryNames[category];
                
                bar.appendChild(label);
                categoryChart.appendChild(bar);
            }
        }

        // إضافة تطبيق جديد
        async function addNewApp(e) {
            e.preventDefault();
            
            const name = document.getElementById('appName').value.trim();
            const description = document.getElementById('appDescription').value.trim();
            const version = document.getElementById('appVersion').value.trim();
            const size = parseFloat(document.getElementById('appSize').value);
            const category = document.getElementById('appCategory').value;
            const developer = document.getElementById('appDeveloper').value.trim();
            const iconFile = document.getElementById('appIconFile').files[0];
            const apkFile = document.getElementById('appApk').files[0];
            
            if (!name || !description || !version || !size || !category || !developer || !iconFile || !apkFile) {
                showToast('خطأ في الإدخال', 'error', 'يرجى ملء جميع الحقول المطلوبة.');
                return;
            }
            
            if (size <= 0) {
                showToast('خطأ في الحجم', 'error', 'يرجى إدخال حجم صالح للتطبيق.');
                return;
            }
            
            const iconValidation = fileManager.validateImageFile(iconFile);
            if (!iconValidation.valid) {
                showToast('خطأ في الصورة', 'error', iconValidation.message);
                return;
            }
            
            const apkValidation = fileManager.validateAPKFile(apkFile);
            if (!apkValidation.valid) {
                showToast('خطأ في ملف APK', 'error', apkValidation.message);
                return;
            }
            
            const appId = generateAppId();
            const progressBar = document.getElementById('uploadProgress');
            progressBar.style.width = '0%';
            
            try {
                showToast('جاري الرفع', 'info', 'جاري رفع صورة الأيقونة...');
                const iconResult = await fileManager.uploadIcon(appId, iconFile);
                
                if (!iconResult.success) {
                    throw new Error('فشل رفع صورة الأيقونة');
                }
                
                const iconUrl = await fileManager.getIcon(appId);
                
                showToast('جاري الرفع', 'info', 'جاري رفع ملف APK...');
                const apkResult = await fileManager.uploadAPK(appId, apkFile, (progress) => {
                    progressBar.style.width = `${progress}%`;
                });
                
                progressBar.style.width = '100%';
                
                if (!apkResult.success) {
                    throw new Error('فشل رفع ملف APK');
                }
                
                const newApp = {
                    id: appId,
                    name,
                    description,
                    version,
                    size,
                    category,
                    developer,
                    icon: iconUrl,
                    rating: 0,
                    ratings: [],
                    downloads: 0,
                    featured: false,
                    active: true,
                    dateAdded: new Date().toISOString().split('T')[0],
                    apkFileId: apkResult.fileId
                };
                
                apps.push(newApp);
                saveAppsToStorage();
                
                document.getElementById('addAppForm').reset();
                document.getElementById('apkFileName').textContent = 'لم يتم اختيار ملف';
                document.getElementById('iconFileName').textContent = 'لم يتم اختيار ملف';
                document.getElementById('iconPreview').style.display = 'none';
                progressBar.style.width = '0%';
                
                updateAdminAppsList();
                await displayApps();
                await displayFeaturedApps();
                
                showToast('تمت الإضافة', 'success', `تم إضافة تطبيق "${name}" بنجاح.`);
                
                if (notificationSystem) {
                    notificationSystem.addNotification(
                        'تطبيق جديد',
                        `تم إضافة "${name}" بنجاح`,
                        'success'
                    );
                }
                
            } catch (error) {
                console.error('فشل إضافة التطبيق:', error);
                showToast('خطأ', 'error', `فشل إضافة التطبيق: ${error.message}`);
                progressBar.style.width = '0%';
            }
        }

        // تعديل تطبيق
        function editApp(appId) {
            const appIndex = apps.findIndex(app => app.id === appId);
            
            if (appIndex === -1) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            const app = apps[appIndex];
            
            document.getElementById('appName').value = app.name;
            document.getElementById('appDescription').value = app.description;
            document.getElementById('appVersion').value = app.version;
            document.getElementById('appSize').value = app.size;
            document.getElementById('appCategory').value = app.category;
            document.getElementById('appDeveloper').value = app.developer;
            
            if (app.icon) {
                const preview = document.getElementById('iconPreview');
                preview.src = app.icon;
                preview.style.display = 'block';
                document.getElementById('iconFileName').textContent = 'صورة حالية';
            }
            
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector('.admin-tab[data-tab="add-app"]').classList.add('active');
            document.getElementById('add-app-tab').classList.add('active');
            
            const submitBtn = document.querySelector('#addAppForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-save"></i> تحديث التطبيق';
            submitBtn.dataset.editId = appId;
            
            const form = document.getElementById('addAppForm');
            const originalSubmit = form.onsubmit;
            
            form.onsubmit = async function(e) {
                e.preventDefault();
                
                apps[appIndex].name = document.getElementById('appName').value.trim();
                apps[appIndex].description = document.getElementById('appDescription').value.trim();
                apps[appIndex].version = document.getElementById('appVersion').value.trim();
                apps[appIndex].size = parseFloat(document.getElementById('appSize').value);
                apps[appIndex].category = document.getElementById('appCategory').value;
                apps[appIndex].developer = document.getElementById('appDeveloper').value.trim();
                
                const iconFile = document.getElementById('appIconFile').files[0];
                if (iconFile) {
                    try {
                        const iconValidation = fileManager.validateImageFile(iconFile);
                        if (!iconValidation.valid) {
                            showToast('خطأ في الصورة', 'error', iconValidation.message);
                            return;
                        }
                        
                        const iconResult = await fileManager.uploadIcon(appId, iconFile);
                        if (iconResult.success) {
                            const iconUrl = await fileManager.getIcon(appId);
                            apps[appIndex].icon = iconUrl;
                        }
                    } catch (error) {
                        console.error('فشل تحديث الصورة:', error);
                    }
                }
                
                saveAppsToStorage();
                updateAdminAppsList();
                await displayApps();
                await displayFeaturedApps();
                
                form.reset();
                document.getElementById('apkFileName').textContent = 'لم يتم اختيار ملف';
                document.getElementById('iconFileName').textContent = 'لم يتم اختيار ملف';
                document.getElementById('iconPreview').style.display = 'none';
                
                submitBtn.innerHTML = originalText;
                delete submitBtn.dataset.editId;
                form.onsubmit = originalSubmit;
                
                showToast('تم التحديث', 'success', `تم تحديث تطبيق "${apps[appIndex].name}" بنجاح.`);
            };
        }

        // حذف تطبيق
        async function deleteApp(appId) {
            if (!confirm('هل أنت متأكد من حذف هذا التطبيق؟ لا يمكن التراجع عن هذا الإجراء.')) {
                return;
            }
            
            const appIndex = apps.findIndex(app => app.id === appId);
            
            if (appIndex === -1) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            const appName = apps[appIndex].name;
            
            try {
                await fileManager.deleteAppFiles(appId);
                apps.splice(appIndex, 1);
                saveAppsToStorage();
                updateAdminAppsList();
                await displayApps();
                await displayFeaturedApps();
                
                showToast('تم الحذف', 'success', `تم حذف تطبيق "${appName}" بنجاح.`);
            } catch (error) {
                console.error('فشل حذف التطبيق:', error);
                showToast('خطأ', 'error', `فشل حذف التطبيق: ${error.message}`);
            }
        }

        // تبديل حالة التطبيق
        function toggleAppStatus(appId) {
            const appIndex = apps.findIndex(app => app.id === appId);
            
            if (appIndex === -1) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            apps[appIndex].active = !apps[appIndex].active;
            saveAppsToStorage();
            updateAdminAppsList();
            displayApps();
            displayFeaturedApps();
            
            const statusText = apps[appIndex].active ? 'مفعل' : 'معطل';
            showToast('تم التحديث', 'success', `تم ${apps[appIndex].active ? 'تفعيل' : 'تعطيل'} تطبيق "${apps[appIndex].name}" بنجاح.`);
        }

        // تحميل التطبيق
        async function downloadApp(appId, appName) {
            const app = apps.find(app => app.id === appId);
            
            if (!app) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            try {
                showToast('جاري التحميل', 'info', `جاري تحضير ${app.name} للتنزيل...`);
                
                const downloadResult = await fileManager.downloadAPK(appId, `${app.name}_v${app.version}.apk`);
                
                if (!downloadResult || !downloadResult.url) {
                    throw new Error('فشل تحميل ملف APK');
                }
                
                app.downloads++;
                saveAppsToStorage();
                displayApps();
                displayFeaturedApps();
                
                const a = document.createElement('a');
                a.href = downloadResult.url;
                a.download = downloadResult.fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                setTimeout(() => {
                    URL.revokeObjectURL(downloadResult.url);
                }, 1000);
                
                showToast('تم التحميل', 'success', `تم تحميل ${app.name} بنجاح.`);
                
            } catch (error) {
                console.error('فشل تحميل التطبيق:', error);
                showToast('خطأ', 'error', `فشل تحميل التطبيق: ${error.message}`);
            }
        }

        // فتح نافذة التقييم
        function openRatingModal(appId) {
            const app = apps.find(app => app.id === appId);
            
            if (!app) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            document.getElementById('ratingAppName').textContent = app.name;
            document.getElementById('ratingAppVersion').textContent = `الإصدار ${app.version}`;
            document.getElementById('ratingAppIcon').src = app.icon;
            document.getElementById('ratingAppIcon').alt = app.name;
            
            // التحقق إذا كان المستخدم قد قيم من قبل
            const hasRatedBefore = app.ratings.some(r => r.user === currentUser);
            if (hasRatedBefore) {
                const userRating = app.ratings.find(r => r.user === currentUser);
                highlightStars(userRating.rating);
                document.getElementById('selectedRatingText').textContent = `لقد قمت بتقييم هذا التطبيق من قبل: ${userRating.rating} نجمة`;
                document.getElementById('ratingComment').value = userRating.comment || '';
                document.getElementById('submitRating').disabled = true;
                document.getElementById('submitRating').innerHTML = '<i class="fas fa-check"></i> قمت بالتقييم مسبقاً';
            } else {
                highlightStars(0);
                document.getElementById('selectedRatingText').textContent = 'قم باختيار تقييم من 1 إلى 5 نجوم';
                document.getElementById('ratingComment').value = '';
                document.getElementById('submitRating').disabled = false;
                document.getElementById('submitRating').innerHTML = 'إرسال التقييم';
            }
            
            document.getElementById('ratingModal').dataset.appId = appId;
            
            const analysis = analyzeRatings(appId);
            const analysisHTML = `
                <h5><i class="fas fa-chart-bar"></i> تحليل التقييمات</h5>
                <div class="analysis-stats">
                    <div class="analysis-stat">
                        <span class="stat-label">إجمالي التقييمات</span>
                        <span class="stat-value">${analysis.total}</span>
                    </div>
                    <div class="analysis-stat">
                        <span class="stat-label">المتوسط الحالي</span>
                        <span class="stat-value">${analysis.average.toFixed(1)}</span>
                    </div>
                </div>
                <div class="distribution-chart">
                    ${Object.entries(analysis.distribution).map(([stars, count]) => `
                        <div class="distribution-row">
                            <span class="stars-count">${stars} نجمة</span>
                            <div class="distribution-bar">
                                <div class="bar-fill" style="width: ${(count / analysis.total) * 100 || 0}%"></div>
                            </div>
                            <span class="distribution-count">${count}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('ratingAnalysis').innerHTML = analysisHTML;
            
            document.getElementById('ratingModal').classList.add('active');
        }

        function analyzeRatings(appId) {
            const app = apps.find(a => a.id === appId);
            if (!app) return {total: 0, average: 0, distribution: {5: 0, 4: 0, 3: 0, 2: 0, 1: 0}};
            
            const ratings = app.ratings;
            const total = ratings.length;
            
            if (total === 0) {
                return {total: 0, average: 0, distribution: {5: 0, 4: 0, 3: 0, 2: 0, 1: 0}};
            }
            
            const distribution = {5: 0, 4: 0, 3: 0, 2: 0, 1: 0};
            ratings.forEach(r => distribution[r.rating]++);
            
            return {
                total,
                average: app.rating,
                distribution
            };
        }

        // إرسال التقييم (للمرة الواحدة فقط)
        function submitRating() {
            const appId = parseInt(document.getElementById('ratingModal').dataset.appId);
            const appIndex = apps.findIndex(app => app.id === appId);
            
            if (appIndex === -1) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            const selectedStars = document.querySelectorAll('#ratingStars i.active').length;
            
            if (selectedStars === 0) {
                showToast('خطأ', 'error', 'يرجى اختيار تقييم قبل الإرسال.');
                return;
            }
            
            // التحقق إذا كان المستخدم قد قيم من قبل
            const hasRatedBefore = apps[appIndex].ratings.some(r => r.user === currentUser);
            if (hasRatedBefore) {
                showToast('لقد قمت بالتقييم مسبقاً', 'warning', 'يمكنك تقييم كل تطبيق مرة واحدة فقط.');
                document.getElementById('ratingModal').classList.remove('active');
                return;
            }
            
            const comment = document.getElementById('ratingComment').value.trim();
            
            apps[appIndex].ratings.push({
                user: currentUser,
                rating: selectedStars,
                comment: comment
            });
            
            showToast('شكراً لك', 'success', 'تم إرسال تقييمك بنجاح.');
            
            const totalRating = apps[appIndex].ratings.reduce((sum, r) => sum + r.rating, 0);
            apps[appIndex].rating = totalRating / apps[appIndex].ratings.length;
            
            saveAppsToStorage();
            displayApps();
            displayFeaturedApps();
            document.getElementById('ratingModal').classList.remove('active');
        }

        // تلوين النجوم
        function highlightStars(rating) {
            const stars = document.querySelectorAll('#ratingStars i');
            
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('far');
                    star.classList.add('fas', 'active');
                } else {
                    star.classList.remove('fas', 'active');
                    star.classList.add('far');
                }
            });
        }

        // تبديل الوضع الليلي/النهاري
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('exotisa-theme', newTheme);
            updateThemeIcon(newTheme);
            
            showToast('تم التبديل', 'info', `تم تفعيل الوضع ${newTheme === 'dark' ? 'الليلي' : 'النهاري'}.`);
        }

        // تحديث أيقونة الوضع
        function updateThemeIcon(theme) {
            const icon = document.querySelector('#themeToggle i');
            
            if (theme === 'dark') {
                icon.className = 'fas fa-sun';
                icon.title = 'الوضع النهاري';
            } else {
                icon.className = 'fas fa-moon';
                icon.title = 'الوضع الليلي';
            }
        }

        // إظهار/إخفاء لوحة الإشعارات
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                notificationSystem.updateBadge(0);
            }
        }

        // إظهار شريط التحميل الهيكلي
        function showSkeletonLoader(show) {
            const skeletonLoader = document.getElementById('skeletonLoader');
            
            if (show) {
                skeletonLoader.classList.add('active');
            } else {
                skeletonLoader.classList.remove('active');
            }
        }

        // إظهار إشعار
        function showToast(title, type, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const iconClass = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            }[type];
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="${iconClass}"></i>
                </div>
                <div class="toast-message">
                    <div class="toast-title">${title}</div>
                    <div class="toast-text">${message}</div>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // تنسيق الأرقام
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // إنشاء معرف فريد
        function generateAppId() {
            return apps.length > 0 ? Math.max(...apps.map(app => app.id)) + 1 : 1;
        }

        // أدوات المطور
        async function quickUpdateApps() {
            if (!currentDeveloper) return;
            
            const myApps = apps.filter(app => app.developer === currentDeveloper);
            let updatedCount = 0;
            
            for (const app of myApps) {
                const hasUpdate = Math.random() > 0.7;
                
                if (hasUpdate) {
                    app.version = incrementVersion(app.version);
                    app.dateAdded = new Date().toISOString().split('T')[0];
                    updatedCount++;
                }
            }
            
            saveAppsToStorage();
            updateDeveloperStats();
            
            showToast('تم التحديث', 'success', `تم تحديث ${updatedCount} تطبيق من تطبيقاتك`);
        }

        function incrementVersion(version) {
            const parts = version.split('.');
            if (parts.length === 3) {
                const minor = parseInt(parts[2]) + 1;
                return `${parts[0]}.${parts[1]}.${minor}`;
            }
            return version;
        }

        function showAnalytics() {
            if (!currentDeveloper) return;
            
            const myApps = apps.filter(app => app.developer === currentDeveloper);
            const analyticsWindow = document.createElement('div');
            analyticsWindow.className = 'modal active';
            analyticsWindow.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-chart-pie"></i> تحليلات المطور</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="analytics-content">
                            <div class="analytics-stats">
                                <div class="analytics-stat">
                                    <h4>إجمالي المشاهدات</h4>
                                    <p>${formatNumber(myApps.reduce((sum, app) => sum + app.downloads * 10, 0))}</p>
                                </div>
                                <div class="analytics-stat">
                                    <h4>معدل التحويل</h4>
                                    <p>${myApps.length > 0 ? (myApps.reduce((sum, app) => sum + app.rating, 0) / myApps.length * 20).toFixed(1) : 0}%</p>
                                </div>
                                <div class="analytics-stat">
                                    <h4>التطبيقات الأعلى تقييمًا</h4>
                                    <p>${myApps.length > 0 ? myApps.sort((a, b) => b.rating - a.rating)[0].name : 'لا يوجد'}</p>
                                </div>
                                <div class="analytics-stat">
                                    <h4>الأكثر تحميلًا</h4>
                                    <p>${myApps.length > 0 ? myApps.sort((a, b) => b.downloads - a.downloads)[0].name : 'لا يوجد'}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(analyticsWindow);
            
            analyticsWindow.querySelector('.close-modal').addEventListener('click', () => {
                analyticsWindow.remove();
            });
        }

        async function backupDeveloperData() {
            if (!currentDeveloper) return;
            
            const myApps = apps.filter(app => app.developer === currentDeveloper);
            const backupData = {
                developer: currentDeveloper,
                apps: myApps,
                backupDate: new Date().toISOString(),
                totalApps: myApps.length,
                totalDownloads: myApps.reduce((sum, app) => sum + app.downloads, 0)
            };
            
            const dataStr = JSON.stringify(backupData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `exotisa_backup_${currentDeveloper}_${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            setTimeout(() => URL.revokeObjectURL(url), 1000);
            
            showToast('تم النسخ الاحتياطي', 'success', 'تم حفظ نسخة احتياطية من بياناتك');
        }

        function exportDeveloperData() {
            if (!currentDeveloper) return;
            
            const myApps = apps.filter(app => app.developer === currentDeveloper);
            
            let csv = 'اسم التطبيق,الإصدار,الفئة,التحميلات,التقييم,الحالة,التاريخ\n';
            myApps.forEach(app => {
                csv += `"${app.name}","${app.version}","${app.category}",${app.downloads},${app.rating},"${app.active ? 'نشط' : 'معطل'}","${app.dateAdded}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `exotisa_export_${currentDeveloper}_${Date.now()}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            setTimeout(() => URL.revokeObjectURL(url), 1000);
            
            showToast('تم التصدير', 'success', 'تم تصدير بيانات تطبيقاتك');
        }

        function updateAppVersion(appId) {
            const appIndex = apps.findIndex(app => app.id === appId);
            
            if (appIndex === -1) {
                showToast('خطأ', 'error', 'لم يتم العثور على التطبيق.');
                return;
            }
            
            const newVersion = prompt('أدخل الإصدار الجديد:', apps[appIndex].version);
            if (newVersion && newVersion.trim()) {
                apps[appIndex].version = newVersion.trim();
                apps[appIndex].dateAdded = new Date().toISOString().split('T')[0];
                saveAppsToStorage();
                updateDeveloperStats();
                displayApps();
                displayFeaturedApps();
                showToast('تم التحديث', 'success', `تم تحديث إصدار التطبيق إلى ${newVersion}`);
            }
        }

        function showAppStats(appId) {
            const app = apps.find(a => a.id === appId);
            if (!app) return;
            
            const statsWindow = document.createElement('div');
            statsWindow.className = 'modal active';
            statsWindow.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3><i class="fas fa-chart-bar"></i> إحصائيات ${app.name}</h3>
                        <button class="close-modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="app-stats">
                            <div class="stat-row">
                                <div class="stat-item">
                                    <h4>إجمالي التحميلات</h4>
                                    <p class="stat-value">${formatNumber(app.downloads)}</p>
                                </div>
                                <div class="stat-item">
                                    <h4>متوسط التقييم</h4>
                                    <p class="stat-value">${app.rating.toFixed(1)}</p>
                                </div>
                                <div class="stat-item">
                                    <h4>عدد التقييمات</h4>
                                    <p class="stat-value">${app.ratings.length}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(statsWindow);
            
            statsWindow.querySelector('.close-modal').addEventListener('click', () => {
                statsWindow.remove();
            });
        }

        // التحقق من التحديثات التلقائية
        function checkForAutoUpdates() {
            const lastAutoUpdateCheck = localStorage.getItem('lastAutoUpdateCheck');
            const now = Date.now();
            
            if (!lastAutoUpdateCheck || (now - parseInt(lastAutoUpdateCheck)) > 3600000) {
                localStorage.setItem('lastAutoUpdateCheck', now.toString());
                
                if (currentDeveloper) {
                    const myApps = apps.filter(app => 
                        app.developer === currentDeveloper && 
                        Math.random() < 0.3
                    );
                    
                    if (myApps.length > 0 && notificationSystem) {
                        notificationSystem.addNotification(
                            'تحديثات متاحة',
                            `يوجد ${myApps.length} تطبيق من تطبيقاتك يحتاج إلى تحديث`,
                            'update',
                            () => showDeveloperDashboard()
                        );
                    }
                }
            }
        }
    </script>
</body>
</html>
