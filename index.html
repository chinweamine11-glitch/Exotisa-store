<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotisa App Store - Premium Android Apps</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš€</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {margin: 0;padding: 0;box-sizing: border-box;}
        :root {
            --bg: #0a0e27;--card: #1a1f3a;--text: #ffffff;--text-sec: #b8c1ec;--accent: #6366f1;
            --gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            --success: #10b981;--error: #ef4444;--warning: #f59e0b;
        }
        body {font-family: 'Cairo', sans-serif;background: var(--bg);color: var(--text);overflow-x: hidden;}
        .hidden {display: none !important;}
        .container {max-width: 1280px;margin: 0 auto;padding: 0 1.5rem;}
        
        /* Auth Page */
        #authPage {
            min-height: 100vh;display: flex;align-items: center;justify-content: center;
            background: linear-gradient(135deg, #0a0e27 0%, #141937 50%, #1e2444 100%);
        }
        .auth-box {
            background: var(--card);border-radius: 1.5rem;padding: 3rem;width: 90%;max-width: 450px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);position: relative;overflow: hidden;
        }
        .auth-box::before {
            content: '';position: absolute;top: 0;left: 0;right: 0;height: 4px;
            background: var(--gradient);
        }
        .logo-big {
            text-align: center;font-size: 4rem;margin-bottom: 1rem;
            background: var(--gradient);-webkit-background-clip: text;-webkit-text-fill-color: transparent;
            font-weight: 900;
        }
        .auth-title {font-size: 2rem;text-align: center;margin-bottom: 2rem;font-weight: 700;}
        .form-group {margin-bottom: 1.5rem;}
        .form-label {display: block;margin-bottom: 0.5rem;font-weight: 600;color: var(--text-sec);}
        .form-input, .form-select {
            width: 100%;padding: 1rem;background: #141937;border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 0.75rem;color: var(--text);font-family: 'Cairo';font-size: 1rem;
            transition: all 0.3s;
        }
        .form-input:focus, .form-select:focus {
            outline: none;border-color: var(--accent);box-shadow: 0 0 20px rgba(99, 102, 241, 0.3);
        }
        .btn {
            padding: 1rem 2rem;border: none;border-radius: 0.75rem;font-family: 'Cairo';
            font-weight: 600;cursor: pointer;transition: all 0.3s;display: inline-flex;
            align-items: center;gap: 0.5rem;justify-content: center;text-decoration: none;
        }
        .btn-primary {
            background: var(--gradient);color: white;width: 100%;font-size: 1.1rem;
        }
        .btn-primary:hover {transform: translateY(-2px);box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);}
        .btn-secondary {
            background: var(--card);color: var(--text);border: 2px solid rgba(99, 102, 241, 0.2);
            width: 100%;
        }
        .btn-secondary:hover {border-color: var(--accent);background: #252b4a;}
        .btn-outline {background: transparent;color: var(--accent);border: 2px solid var(--accent);}
        .btn-outline:hover {background: var(--accent);color: white;}
        .auth-switch {
            text-align: center;margin-top: 1.5rem;color: var(--text-sec);
        }
        .auth-switch a {color: var(--accent);text-decoration: none;font-weight: 600;}
        .auth-switch a:hover {text-decoration: underline;}
        .divider {
            margin: 1.5rem 0;text-align: center;color: var(--text-sec);position: relative;
        }
        .divider::before, .divider::after {
            content: '';position: absolute;top: 50%;width: 40%;height: 1px;
            background: rgba(99, 102, 241, 0.2);
        }
        .divider::before {left: 0;}
        .divider::after {right: 0;}
        
        /* Main App */
        #mainApp {min-height: 100vh;}
        header {
            position: sticky;top: 0;z-index: 1000;background: rgba(10, 14, 39, 0.8);
            backdrop-filter: blur(20px);border-bottom: 1px solid rgba(99, 102, 241, 0.1);
            padding: 1rem 0;
        }
        .nav {display: flex;align-items: center;justify-content: space-between;}
        .logo {
            display: flex;align-items: center;gap: 0.5rem;font-size: 1.5rem;font-weight: 900;
            background: var(--gradient);-webkit-background-clip: text;-webkit-text-fill-color: transparent;
            cursor: pointer;
        }
        .nav-actions {display: flex;gap: 1rem;align-items: center;}
        .user-info {
            display: flex;align-items: center;gap: 1rem;padding: 0.5rem 1rem;
            background: var(--card);border-radius: 2rem;
        }
        .user-name {font-weight: 600;}
        .user-role {
            padding: 0.25rem 0.75rem;background: rgba(99, 102, 241, 0.2);
            border-radius: 1rem;font-size: 0.75rem;color: var(--accent);
        }
        
        /* Content */
        .hero {padding: 3rem 0;text-align: center;}
        .hero-title {
            font-size: clamp(2rem, 5vw, 4rem);font-weight: 900;
            background: var(--gradient);-webkit-background-clip: text;-webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }
        .hero-subtitle {font-size: 1.25rem;color: var(--text-sec);margin-bottom: 2rem;}
        .hero-actions {display: flex;gap: 1rem;justify-content: center;flex-wrap: wrap;}
        
        .stats-grid {
            display: grid;grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;margin: 3rem 0;
        }
        .stat-card {
            text-align: center;padding: 2rem;background: var(--card);border-radius: 1rem;
            position: relative;overflow: hidden;
        }
        .stat-card::before {
            content: '';position: absolute;top: 0;left: 0;right: 0;height: 3px;
            background: var(--gradient);transform: scaleX(0);transition: transform 0.3s;
        }
        .stat-card:hover::before {transform: scaleX(1);}
        .stat-value {
            font-size: 2rem;font-weight: 900;background: var(--gradient);
            -webkit-background-clip: text;-webkit-text-fill-color: transparent;
        }
        .stat-label {color: var(--text-sec);margin-top: 0.5rem;}
        
        .category-chips {display: flex;gap: 1rem;flex-wrap: wrap;justify-content: center;margin: 2rem 0;}
        .category-chip {
            padding: 0.5rem 1.5rem;background: var(--card);border: 2px solid rgba(99, 102, 241, 0.2);
            border-radius: 2rem;cursor: pointer;transition: all 0.3s;display: flex;
            align-items: center;gap: 0.5rem;
        }
        .category-chip:hover, .category-chip.active {
            background: var(--gradient);border-color: transparent;color: white;
            transform: translateY(-2px);
        }
        
        .app-grid {
            display: grid;grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;margin-top: 2rem;
        }
        .app-card {
            background: var(--card);border-radius: 1rem;overflow: hidden;
            cursor: pointer;transition: all 0.3s;
        }
        .app-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 0 30px rgba(99, 102, 241, 0.2);
        }
        .app-icon {width: 100%;aspect-ratio: 1;object-fit: cover;border-bottom: 1px solid rgba(99, 102, 241, 0.1);}
        .app-info {padding: 1rem;}
        .app-title {font-size: 1.125rem;font-weight: 700;margin-bottom: 0.25rem;}
        .app-developer {font-size: 0.875rem;color: var(--text-sec);margin-bottom: 0.5rem;}
        .app-stats {
            display: flex;justify-content: space-between;align-items: center;
            margin-top: 1rem;padding-top: 1rem;border-top: 1px solid rgba(99, 102, 241, 0.1);
        }
        .rating {display: flex;align-items: center;gap: 0.25rem;color: var(--warning);}
        .downloads {display: flex;align-items: center;gap: 0.25rem;color: var(--text-sec);font-size: 0.875rem;}
        
        .section-title {font-size: 1.5rem;font-weight: 700;margin: 3rem 0 1rem;}
        
        .toast-container {
            position: fixed;top: 1rem;left: 1rem;z-index: 3000;
            display: flex;flex-direction: column;gap: 0.5rem;
        }
        .toast {
            padding: 1rem 1.5rem;background: var(--card);border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.4);display: flex;
            align-items: center;gap: 1rem;min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        .toast.success {border-right: 4px solid var(--success);}
        .toast.error {border-right: 4px solid var(--error);}
        @keyframes slideIn {
            from {transform: translateX(-100%);opacity: 0;}
            to {transform: translateX(0);opacity: 1;}
        }
        
        .loading {
            display: flex;align-items: center;justify-content: center;
            padding: 3rem;
        }
        .spinner {
            width: 40px;height: 40px;border: 4px solid rgba(99, 102, 241, 0.2);
            border-top-color: var(--accent);border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {transform: rotate(360deg);}
        }
        
        #threeBackground {
            position: fixed;top: 0;left: 0;width: 100%;height: 100%;
            z-index: -1;opacity: 0.3;
        }
        
        @media (max-width: 768px) {
            .app-grid {grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));gap: 1rem;}
            .auth-box {padding: 2rem;}
            .hero-title {font-size: 2rem;}
        }
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    <div id="threeBackground"></div>
    
    <!-- Auth Page -->
    <div id="authPage">
        <div class="auth-box">
            <div class="logo-big">ğŸš€ Exotisa</div>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2 class="auth-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" name="email" required placeholder="your@email.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" class="form-input" name="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">login</span>
                        Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
                
                <div class="divider">Ø£Ùˆ</div>
                
                <button class="btn btn-secondary" onclick="loginWithGoogle()">
                    <span class="material-icons">login</span>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google
                </button>
                
                <div class="auth-switch">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showRegister()">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
                </div>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" class="auth-form hidden">
                <h2 class="auth-title">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" class="form-input" name="fullName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" class="form-input" name="password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <select class="form-select" name="role">
                            <option value="user">Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="developer">Ù…Ø·ÙˆØ±</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">person_add</span>
                        Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                    </button>
                </form>
                
                <div class="auth-switch">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <a href="#" onclick="showLogin()">Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" class="hidden">
        <header>
            <nav class="container nav">
                <div class="logo" onclick="loadHome()">
                    <span>ğŸš€</span>
                    <span>Exotisa</span>
                </div>
                <div class="nav-actions">
                    <div class="user-info">
                        <span class="user-name" id="userName"></span>
                        <span class="user-role" id="userRole"></span>
                    </div>
                    <button class="btn btn-outline" onclick="logout()">
                        <span class="material-icons">logout</span>
                        Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </nav>
        </header>
        
        <main class="container" id="mainContent">
            <div class="loading">
                <div class="spinner"></div>
            </div>
        </main>
    </div>
    
    <script>
        // Supabase Config
        const SUPABASE_URL = 'https://qjfpkwyglveukzfazmzo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqZnBrd3lnbHZldWt6ZmF6bXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjY2MjMsImV4cCI6MjA4MzA0MjYyM30.L-bh48EGgn348UzJzBajJc1PR7-z1weW1ayzZz-tbvc';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        let currentUser = null;
        let currentUserData = null;
        
        // Toast Notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : 'error'}</span>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // Format Numbers
        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }
        
        // Auth Functions
        function showLogin() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('hidden');
        }
        
        function showRegister() {
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
        }
        
        async function handleLogin(event) {
            event.preventDefault();
            const form = event.target;
            const email = form.email.value;
            const password = form.password.value;
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({email, password});
                if (error) throw error;
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } catch (error) {
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        async function handleRegister(event) {
            event.preventDefault();
            const form = event.target;
            const email = form.email.value;
            const password = form.password.value;
            const fullName = form.fullName.value;
            const role = form.role.value;
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email, password,
                    options: {data: {full_name: fullName, role: role}}
                });
                if (error) throw error;
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.', 'success');
                showLogin();
            } catch (error) {
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        async function loginWithGoogle() {
            try {
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {redirectTo: window.location.origin}
                });
                if (error) throw error;
            } catch (error) {
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        async function logout() {
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        // Auth State Listener
        supabase.auth.onAuthStateChange(async (event, session) => {
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                const { data: userData } = await supabase
                    .from('users')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (userData) {
                    currentUserData = userData;
                    document.getElementById('authPage').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    document.getElementById('userName').textContent = userData.full_name || userData.email;
                    document.getElementById('userRole').textContent = userData.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : userData.role === 'developer' ? 'Ù…Ø·ÙˆØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…';
                    await loadHome();
                }
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                currentUserData = null;
                document.getElementById('authPage').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                showLogin();
            }
        });
        
        // Load Home Page
        async function loadHome() {
            const content = document.getElementById('mainContent');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const [statsResult, appsResult, categoriesResult] = await Promise.all([
                    supabase.from('apps').select('id', {count: 'exact', head: true}),
                    supabase.from('apps_with_stats').select('*').eq('status', 'approved').order('downloads_count', {ascending: false}).limit(12),
                    supabase.from('categories').select('*').order('name')
                ]);
                
                const stats = {apps: statsResult.count || 0};
                const apps = appsResult.data || [];
                const categories = categoriesResult.data || [];
                
                content.innerHTML = `
                    <section class="hero">
                        <h1 class="hero-title">Exotisa App Store</h1>
                        <p class="hero-subtitle">Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
                        <div class="hero-actions">
                            <button class="btn btn-primary" onclick="loadApps()">
                                <span class="material-icons">apps</span>
                                ØªØµÙØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
                            </button>
                        </div>
                    </section>
                    
                    <section class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${formatNumber(stats.apps)}</div>
                            <div class="stat-label">ØªØ·Ø¨ÙŠÙ‚ Ù…ØªØ§Ø­</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${formatNumber(categories.length)}</div>
                            <div class="stat-label">ØªØµÙ†ÙŠÙ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">100%</div>
                            <div class="stat-label">Ø¢Ù…Ù† ÙˆÙ…Ø¬Ø§Ù†ÙŠ</div>
                        </div>
                    </section>
                    
                    <h2 class="section-title">Ø§Ù„Ø£ÙƒØ«Ø± ØªØ­Ù…ÙŠÙ„Ø§Ù‹</h2>
                    <div class="app-grid" id="appsGrid">
                        ${apps.map(app => `
                            <div class="app-card" onclick="showAppDetails('${app.id}')">
                                <img src="${app.icon_url}" alt="${app.name}" class="app-icon">
                                <div class="app-info">
                                    <div class="app-title">${app.name}</div>
                                    <div class="app-developer">${app.developer_name}</div>
                                    <div class="app-stats">
                                        <div class="rating">
                                            <span class="material-icons">star</span>
                                            <span>${app.rating || 0}</span>
                                        </div>
                                        <div class="downloads">
                                            <span class="material-icons">download</span>
                                            <span>${formatNumber(app.downloads_count)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="loading"><p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p></div>`;
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        // Load Apps Page
        async function loadApps() {
            const content = document.getElementById('mainContent');
            content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            
            try {
                const [appsResult, categoriesResult] = await Promise.all([
                    supabase.from('apps_with_stats').select('*').eq('status', 'approved').order('downloads_count', {ascending: false}),
                    supabase.from('categories').select('*').order('name')
                ]);
                
                const apps = appsResult.data || [];
                const categories = categoriesResult.data || [];
                
                content.innerHTML = `
                    <h1 class="section-title">Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</h1>
                    
                    <div class="category-chips">
                        <div class="category-chip active" onclick="filterApps('all')">
                            <span>Ø§Ù„ÙƒÙ„</span>
                        </div>
                        ${categories.map(cat => `
                            <div class="category-chip" onclick="filterApps('${cat.id}')">
                                <span>${cat.icon}</span>
                                <span>${cat.name}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="app-grid" id="appsGrid">
                        ${apps.map(app => `
                            <div class="app-card" data-category="${app.category_id}">
                                <img src="${app.icon_url}" alt="${app.name}" class="app-icon">
                                <div class="app-info">
                                    <div class="app-title">${app.name}</div>
                                    <div class="app-developer">${app.developer_name}</div>
                                    <div class="app-stats">
                                        <div class="rating">
                                            <span class="material-icons">star</span>
                                            <span>${app.rating || 0}</span>
                                        </div>
                                        <div class="downloads">
                                            <span class="material-icons">download</span>
                                            <span>${formatNumber(app.downloads_count)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="loading"><p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</p></div>`;
                showToast('Ø®Ø·Ø£: ' + error.message, 'error');
            }
        }
        
        // Filter Apps by Category
        function filterApps(categoryId) {
            const allCards = document.querySelectorAll('.app-card');
            const chips = document.querySelectorAll('.category-chip');
            
            chips.forEach(chip => chip.classList.remove('active'));
            event.target.closest('.category-chip').classList.add('active');
            
            allCards.forEach(card => {
                if (categoryId === 'all' || card.dataset.category === categoryId) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Show App Details (placeholder)
        function showAppDetails(appId) {
            showToast('ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù‚Ø±ÙŠØ¨Ø§Ù‹...', 'info');
        }
        
        // Three.js Background
        function initThreeBackground() {
            const container = document.getElementById('threeBackground');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({alpha: true});
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            const geometry = new THREE.IcosahedronGeometry(1, 1);
            const material = new THREE.MeshBasicMaterial({color: 0x6366f1, wireframe: true});
            
            const particles = [];
            for (let i = 0; i < 50; i++) {
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(
                    Math.random() * 40 - 20,
                    Math.random() * 40 - 20,
                    Math.random() * 40 - 20
                );
                mesh.scale.setScalar(Math.random() * 0.5 + 0.1);
                scene.add(mesh);
                particles.push(mesh);
            }
            
            camera.position.z = 15;
            
            function animate() {
                requestAnimationFrame(animate);
                particles.forEach((particle, i) => {
                    particle.rotation.x += 0.001;
                    particle.rotation.y += 0.002;
                    particle.position.y += Math.sin(Date.now() * 0.001 + i) * 0.001;
                });
                renderer.render(scene, camera);
            }
            
            animate();
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initThreeBackground();
            supabase.auth.getSession().then(({data: {session}}) => {
                if (!session) {
                    document.getElementById('authPage').classList.remove('hidden');
                    document.getElementById('mainApp').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
