<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotisa | Ù…Ù†ØµØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* ===== Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† ===== */
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --primary-light: #60a5fa;
            --secondary: #64748b;
            --accent: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            
            --bg-white: #ffffff;
            --bg-light: #f8fafc;
            --bg-dark: #0f172a;
            --bg-card: #ffffff;
            
            --text-dark: #1e293b;
            --text-light: #f8fafc;
            --text-muted: #64748b;
            --text-gray: #94a3b8;
            
            --border: #e2e8f0;
            --border-dark: #334155;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 40px rgba(0, 0, 0, 0.1);
            
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --animation-speed: 0.3s;
        }
        
        /* ===== Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ø§Ù… ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.6;
            min-height: 100vh;
            transition: var(--transition);
        }
        
        body.dark-mode {
            background: var(--bg-dark);
            color: var(--text-light);
        }
        
        .hidden {
            display: none !important;
        }
        
        /* ===== Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ===== */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-white);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: var(--transition);
        }
        
        body.dark-mode .auth-overlay {
            background: var(--bg-dark);
        }
        
        .auth-modal {
            background: var(--bg-white);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            width: 90%;
            max-width: 450px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.5s ease;
        }
        
        body.dark-mode .auth-modal {
            background: var(--bg-dark);
            border-color: var(--border-dark);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            color: var(--text-muted);
            font-size: 1rem;
        }
        
        .auth-tabs {
            display: flex;
            background: var(--bg-light);
            border-radius: var(--radius-md);
            padding: 4px;
            margin-bottom: 2rem;
        }
        
        body.dark-mode .auth-tabs {
            background: #1e293b;
        }
        
        .auth-tab {
            flex: 1;
            padding: 0.8rem;
            border: none;
            background: transparent;
            color: var(--text-muted);
            font-size: 1rem;
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            font-family: 'Tajawal', sans-serif;
        }
        
        .auth-tab.active {
            background: var(--bg-white);
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }
        
        body.dark-mode .auth-tab.active {
            background: #334155;
        }
        
        .auth-form {
            margin-bottom: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.2rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        body.dark-mode .form-label {
            color: var(--text-light);
        }
        
        .form-input {
            width: 100%;
            padding: 0.8rem 1rem;
            background: var(--bg-white);
            border: 2px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--text-dark);
            font-size: 1rem;
            font-family: 'Tajawal', sans-serif;
            transition: var(--transition);
        }
        
        body.dark-mode .form-input {
            background: #1e293b;
            border-color: var(--border-dark);
            color: var(--text-light);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .password-input {
            position: relative;
        }
        
        .toggle-password {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
        }
        
        /* ===== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ===== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Tajawal', sans-serif;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 2px solid var(--border);
        }
        
        body.dark-mode .btn-secondary {
            background: #1e293b;
            color: var(--text-light);
            border-color: var(--border-dark);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-block {
            width: 100%;
        }
        
        .btn-icon {
            padding: 0.5rem;
            width: 40px;
            height: 40px;
        }
        
        /* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ ===== */
        .navbar {
            background: var(--bg-white);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            transition: var(--transition);
        }
        
        body.dark-mode .navbar {
            background: var(--bg-dark);
            border-color: var(--border-dark);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .nav-logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-decoration: none;
        }
        
        .nav-search {
            flex: 1;
            max-width: 600px;
            margin: 0 2rem;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 0.8rem 3rem 0.8rem 1rem;
            background: var(--bg-light);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--text-dark);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        body.dark-mode .search-input {
            background: #1e293b;
            border-color: var(--border-dark);
            color: var(--text-light);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* ===== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ===== */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-dark);
        }
        
        body.dark-mode .section-title {
            color: var(--text-light);
        }
        
        /* ===== Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª ===== */
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .app-card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
        }
        
        body.dark-mode .app-card {
            background: #1e293b;
            border-color: var(--border-dark);
        }
        
        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }
        
        .app-badge {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--warning);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1;
        }
        
        .app-image {
            height: 160px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        
        .app-content {
            padding: 1.5rem;
        }
        
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .app-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }
        
        body.dark-mode .app-title {
            color: var(--text-light);
        }
        
        .app-category {
            color: var(--text-muted);
            font-size: 0.9rem;
            background: var(--bg-light);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-sm);
        }
        
        body.dark-mode .app-category {
            background: #334155;
        }
        
        .app-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--warning);
        }
        
        .app-description {
            color: var(--text-gray);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .app-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }
        
        body.dark-mode .app-meta {
            border-color: var(--border-dark);
        }
        
        .app-size {
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        .app-downloads {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: var(--text-muted);
            font-size: 0.9rem;
        }
        
        /* ===== Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .dashboard-card {
            background: var(--bg-white);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        
        body.dark-mode .dashboard-card {
            background: #1e293b;
            border-color: var(--border-dark);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .stat-card {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            text-align: center;
            transition: var(--transition);
        }
        
        body.dark-mode .stat-card {
            background: #334155;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
        }
        
        /* ===== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ===== */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }
        
        body.dark-mode .pagination {
            border-color: var(--border-dark);
        }
        
        .page-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            background: var(--bg-white);
            color: var(--text-dark);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
        }
        
        body.dark-mode .page-btn {
            background: #1e293b;
            border-color: var(--border-dark);
            color: var(--text-light);
        }
        
        .page-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-btn:hover:not(.active) {
            background: var(--bg-light);
        }
        
        /* ===== Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 1rem;
        }
        
        .modal-content {
            background: var(--bg-white);
            border-radius: var(--radius-xl);
            padding: 2rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }
        
        body.dark-mode .modal-content {
            background: var(--bg-dark);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 1.5rem;
        }
        
        /* ===== Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ===== */
        .alert {
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideUp 0.3s ease;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        
        .alert-info {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--info);
            color: var(--info);
        }
        
        /* ===== Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† ===== */
        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* ===== Ø§Ù„ØªØ¬Ø§ÙˆØ¨ ===== */
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem;
            }
            
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-search {
                margin: 0;
                width: 100%;
            }
            
            .apps-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .main-container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-modal">
            <div class="auth-header">
                <div class="logo">Exotisa</div>
                <p class="tagline">Ù…Ù†ØµØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</p>
            </div>
            
            <!-- ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„/ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button class="auth-tab" data-tab="register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>
            
            <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… -->
            <div id="authMessages"></div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <div class="auth-form" id="loginForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="example@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                        <button type="button" class="toggle-password" data-target="loginPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-block" id="loginBtn">
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                </button>
                
                <div class="divider">
                    <span>Ø£Ùˆ</span>
                </div>
                
                <button class="btn btn-secondary btn-block" id="googleLoginBtn">
                    <i class="fab fa-google"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
                </button>
            </div>
            
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
            <div class="auth-form hidden" id="registerForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" class="form-input" id="registerName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" class="form-input" id="registerEmail" placeholder="example@email.com" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="registerPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required minlength="6">
                        <button type="button" class="toggle-password" data-target="registerPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" class="form-input" id="registerConfirm" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required minlength="6">
                        <button type="button" class="toggle-password" data-target="registerConfirm">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-block" id="registerBtn">
                    <span>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</span>
                </button>
                
                <div class="divider">
                    <span>Ø£Ùˆ</span>
                </div>
                
                <button class="btn btn-secondary btn-block" id="googleRegisterBtn">
                    <i class="fab fa-google"></i>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¨Ù€ Google
                </button>
            </div>
        </div>
    </div>
    
    <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="app-container hidden" id="appContainer">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-brand">
                    <a href="#" class="nav-logo">Exotisa</a>
                </div>
                
                <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
                <div class="nav-search">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ·Ø¨ÙŠÙ‚Ø§Øª...">
                    <i class="fas fa-search search-icon"></i>
                </div>
                
                <!-- Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
                <div class="nav-actions">
                    <button class="btn btn-icon" id="themeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    <button class="btn btn-primary" id="uploadBtn">
                        <i class="fas fa-upload"></i>
                        Ø±ÙØ¹ ØªØ·Ø¨ÙŠÙ‚
                    </button>
                    
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">Ù…</div>
                        <div>
                            <div id="userName">Ù…Ø³ØªØ®Ø¯Ù…</div>
                            <div id="userRole" style="font-size: 0.8rem; color: var(--text-muted);"></div>
                        </div>
                        <button class="btn btn-danger btn-icon" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-container">
            <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
            <div id="appMessages"></div>
            
            <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·) -->
            <div id="adminDashboard" class="hidden">
                <div class="section-header">
                    <h1 class="section-title">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h1>
                    <button class="btn btn-success" id="addAppBtn">
                        <i class="fas fa-plus"></i>
                        Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚
                    </button>
                </div>
                
                <div class="dashboard-grid">
                    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
                    <div class="dashboard-card">
                        <h3 style="margin-bottom: 1rem;">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="statsApps">0</div>
                                <div class="stat-label">ØªØ·Ø¨ÙŠÙ‚</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="statsUsers">0</div>
                                <div class="stat-label">Ù…Ø³ØªØ®Ø¯Ù…</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="statsDownloads">0</div>
                                <div class="stat-label">ØªØ­Ù…ÙŠÙ„</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="statsRevenue">0</div>
                                <div class="stat-label">Ø±ÙŠØ§Ù„</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø³Ø±ÙŠØ¹Ø© -->
                    <div class="dashboard-card">
                        <h3 style="margin-bottom: 1rem;">Ø¥Ø¯Ø§Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</h3>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            <button class="btn btn-secondary" id="manageAppsBtn">
                                <i class="fas fa-box"></i>
                                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
                            </button>
                            <button class="btn btn-secondary" id="manageUsersBtn">
                                <i class="fas fa-users"></i>
                                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                            </button>
                            <button class="btn btn-secondary" id="manageCategoriesBtn">
                                <i class="fas fa-tags"></i>
                                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØ¦Ø§Øª
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª -->
            <div id="appsSection">
                <div class="section-header">
                    <h1 class="section-title">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
                    <div style="display: flex; gap: 1rem;">
                        <select class="form-input" id="categoryFilter" style="width: auto;">
                            <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>
                        </select>
                        <select class="form-input" id="sortFilter" style="width: auto;">
                            <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                            <option value="popular">Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
                            <option value="rating">Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…</option>
                        </select>
                    </div>
                </div>
                
                <!-- Ø´Ø¨ÙƒØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª -->
                <div class="apps-grid" id="appsGrid">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
                
                <!-- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª -->
                <div class="pagination" id="pagination">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="modal-overlay hidden" id="previewModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="previewTitle"></h2>
                <button class="modal-close" id="closePreview">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="previewContent">
                <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© -->
            </div>
        </div>
    </div>
    
    <!-- Ù†Ø§ÙØ°Ø© Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <div class="modal-overlay hidden" id="uploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ø±ÙØ¹ ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</h2>
                <button class="modal-close" id="closeUpload">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="uploadAppForm">
                <div class="form-group">
                    <label class="form-label">Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</label>
                    <input type="text" class="form-input" id="appName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-input" id="appDescription" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„ÙØ¦Ø©</label>
                    <select class="form-input" id="appCategory" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ø§Ø¨Ø· APK</label>
                    <input type="url" class="form-input" id="appApkUrl" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                    <input type="url" class="form-input" id="appIconUrl">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø­Ø¬Ù… (MB)</label>
                    <input type="number" class="form-input" id="appSize" min="0" step="0.1" value="10">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</label>
                    <input type="text" class="form-input" id="appVersion" value="1.0.0">
                </div>
                
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="button" class="btn btn-secondary" id="cancelUpload">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ============================================
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Exotisa - Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„...');
            
            // ØªÙ‡ÙŠØ¦Ø© Supabase
            initSupabase();
            
            // ØªÙ‡ÙŠØ¦Ø© Ù…Ø¹Ø§Ù„Ø¬ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            initEventListeners();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            checkAuthState();
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
            loadSettings();
        });
        
        // ============================================
        // ØªÙƒÙˆÙŠÙ† Supabase
        // ============================================
        const SUPABASE_URL = 'https://qjfpkwyglveukzfazmzo.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqZnBrd3lnbHZldWt6ZmF6bXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjY2MjMsImV4cCI6MjA4MzA0MjYyM30.L-bh48EGgn348UzJzBajJc1PR7-z1weW1ayzZz-tbvc';
        
        let supabase = null;
        
        function initSupabase() {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
                auth: {
                    autoRefreshToken: true,
                    persistSession: true,
                    detectSessionInUrl: true
                }
            });
            console.log('âœ… Supabase Ø¬Ø§Ù‡Ø²');
        }
        
        // ============================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„Ø©
        // ============================================
        let currentUser = null;
        let isAdmin = false;
        let currentPage = 1;
        let appsPerPage = 12;
        let currentCategory = '';
        let currentSort = 'newest';
        
        // ============================================
        // Ù…Ø¹Ø§Ù„Ø¬ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        // ============================================
        function initEventListeners() {
            // ØªØ¨Ø¯ÙŠÙ„ ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    switchAuthTab(tabId);
                });
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.dataset.target;
                    togglePasswordVisibility(targetId);
                });
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('loginBtn').addEventListener('click', handleLogin);
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleLogin();
            });
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
            document.getElementById('registerBtn').addEventListener('click', handleRegister);
            document.getElementById('registerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleRegister();
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google
            document.getElementById('googleLoginBtn').addEventListener('click', handleGoogleAuth);
            document.getElementById('googleRegisterBtn').addEventListener('click', handleGoogleAuth);
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†
            document.getElementById('themeToggle').addEventListener('click', toggleDarkMode);
            
            // Ø§Ù„Ø¨Ø­Ø«
            document.getElementById('searchInput').addEventListener('input', debounce(handleSearch, 500));
            
            // Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„ØªØ±ØªÙŠØ¨
            document.getElementById('categoryFilter').addEventListener('change', function() {
                currentCategory = this.value;
                loadApps();
            });
            
            document.getElementById('sortFilter').addEventListener('change', function() {
                currentSort = this.value;
                loadApps();
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
            document.getElementById('uploadBtn').addEventListener('click', showUploadModal);
            document.getElementById('addAppBtn').addEventListener('click', showUploadModal);
            document.getElementById('cancelUpload').addEventListener('click', hideUploadModal);
            document.getElementById('closeUpload').addEventListener('click', hideUploadModal);
            document.getElementById('uploadAppForm').addEventListener('submit', handleUploadApp);
            
            // Ø¥Ø¯Ø§Ø±Ø© Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.getElementById('manageAppsBtn').addEventListener('click', () => loadApps());
            document.getElementById('manageUsersBtn').addEventListener('click', loadUsers);
            document.getElementById('manageCategoriesBtn').addEventListener('click', loadCategories);
            
            // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            document.getElementById('closePreview').addEventListener('click', hidePreview);
            
            // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            });
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        // ============================================
        async function checkAuthState() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©:', error);
                    return;
                }
                
                if (session) {
                    currentUser = session.user;
                    await loadUserProfile();
                    showMainApp();
                } else {
                    showAuthScreen();
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:', error);
                showAuthScreen();
            }
        }
        
        async function loadUserProfile() {
            if (!currentUser) return;
            
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();
                
                if (error) {
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø´Ø®ØµÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
                    await createUserProfile();
                } else {
                    updateUserUI(profile);
                    isAdmin = profile.role === 'admin';
                    
                    if (isAdmin) {
                        showAdminDashboard();
                        loadAdminStats();
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', error);
            }
        }
        
        async function createUserProfile() {
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .upsert({
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.user_metadata?.full_name || currentUser.email.split('@')[0],
                        username: currentUser.user_metadata?.username || currentUser.email.split('@')[0],
                        role: currentUser.email === 'chinweamine11@gmail.com' ? 'admin' : 'user'
                    })
                    .select()
                    .single();
                
                if (error) throw error;
                
                updateUserUI(profile);
                isAdmin = profile.role === 'admin';
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ:', error);
            }
        }
        
        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showAuthMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            showLoading('loginBtn', 'Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...');
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                currentUser = data.user;
                await loadUserProfile();
                showMainApp();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                showAuthMessage('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            } finally {
                hideLoading('loginBtn', 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„');
            }
        }
        
        async function handleRegister() {
            const name = document.getElementById('registerName').value.trim();
            const email = document.getElementById('registerEmail').value.trim().toLowerCase();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirm').value;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
            if (!name || !email || !password || !confirmPassword) {
                showAuthMessage('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            if (password.length < 6) {
                showAuthMessage('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showAuthMessage('ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', 'error');
                return;
            }
            
            showLoading('registerBtn', 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨...');
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password,
                    options: {
                        data: {
                            full_name: name,
                            username: name.replace(/\s+/g, '').toLowerCase()
                        }
                    }
                });
                
                if (error) throw error;
                
                if (data.user) {
                    showAuthMessage('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'success');
                    switchAuthTab('login');
                    document.getElementById('loginEmail').value = email;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:', error);
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
                if (error.message.includes('User already registered')) {
                    errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹';
                }
                
                showAuthMessage(errorMessage, 'error');
            } finally {
                hideLoading('registerBtn', 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨');
            }
        }
        
        async function handleGoogleAuth() {
            try {
                const { error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: window.location.origin
                    }
                });
                
                if (error) throw error;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google:', error);
                showAuthMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù€ Google', 'error');
            }
        }
        
        async function handleLogout() {
            try {
                const { error } = await supabase.auth.signOut();
                
                if (error) throw error;
                
                currentUser = null;
                isAdmin = false;
                showAuthScreen();
                showAppMessage('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }
        
        // ============================================
        // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        // ============================================
        function showAuthScreen() {
            document.getElementById('authOverlay').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
        }
        
        function showMainApp() {
            document.getElementById('authOverlay').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            loadApps();
            loadCategoriesFilter();
        }
        
        function showAdminDashboard() {
            document.getElementById('adminDashboard').classList.remove('hidden');
        }
        
        function updateUserUI(profile) {
            const userName = document.getElementById('userName');
            const userRole = document.getElementById('userRole');
            const userAvatar = document.getElementById('userAvatar');
            
            if (profile) {
                userName.textContent = profile.full_name || profile.email;
                userRole.textContent = profile.role === 'admin' ? 'Ù…Ø³Ø¤ÙˆÙ„' : 'Ù…Ø³ØªØ®Ø¯Ù…';
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø­Ø±Ù Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù„Ù„ØµÙˆØ±Ø©
                const initials = (profile.full_name || profile.email)
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
                
                userAvatar.textContent = initials;
            }
        }
        
        function switchAuthTab(tabId) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.auth-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tabId);
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
            document.getElementById('loginForm').classList.toggle('hidden', tabId !== 'login');
            document.getElementById('registerForm').classList.toggle('hidden', tabId !== 'register');
            
            // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            clearAuthMessages();
        }
        
        function togglePasswordVisibility(targetId) {
            const input = document.getElementById(targetId);
            const icon = document.querySelector(`[data-target="${targetId}"] i`);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                input.type = 'password';
                icon.className = 'fas fa-eye';
            }
        }
        
        function toggleDarkMode() {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            const icon = document.querySelector('#themeToggle i');
            
            icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
            localStorage.setItem('darkMode', isDark);
        }
        
        function loadSettings() {
            const darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.body.classList.add('dark-mode');
                document.querySelector('#themeToggle i').className = 'fas fa-sun';
            }
        }
        
        // ============================================
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
        // ============================================
        async function loadApps() {
            try {
                showLoadingState();
                
                let query = supabase
                    .from('apps')
                    .select('*, profiles(full_name)', { count: 'exact' });
                
                // Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ÙØ¦Ø©
                if (currentCategory) {
                    query = query.eq('category', currentCategory);
                }
                
                // Ø§Ù„Ø¨Ø­Ø«
                const searchTerm = document.getElementById('searchInput').value.trim();
                if (searchTerm) {
                    query = query.or(`name.ilike.%${searchTerm}%,short_description.ilike.%${searchTerm}%,category.ilike.%${searchTerm}%`);
                }
                
                // Ø§Ù„ØªØ±ØªÙŠØ¨
                switch(currentSort) {
                    case 'popular':
                        query = query.order('download_count', { ascending: false });
                        break;
                    case 'rating':
                        query = query.order('average_rating', { ascending: false });
                        break;
                    default:
                        query = query.order('created_at', { ascending: false });
                }
                
                // Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ù„Ù„ØµÙØ­Ø§Øª
                const from = (currentPage - 1) * appsPerPage;
                const to = from + appsPerPage - 1;
                query = query.range(from, to);
                
                const { data: apps, error, count } = await query;
                
                if (error) throw error;
                
                displayApps(apps || []);
                updatePagination(count || 0);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª', 'error');
                document.getElementById('appsGrid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--danger); margin-bottom: 1rem;"></i>
                        <p style="color: var(--text-muted);">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</p>
                    </div>
                `;
            }
        }
        
        function displayApps(apps) {
            const appsGrid = document.getElementById('appsGrid');
            
            if (!apps || apps.length === 0) {
                appsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                        <h3 style="color: var(--text-muted); margin-bottom: 0.5rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª</h3>
                        <p style="color: var(--text-gray);">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ø¨Ø­Ø«Ùƒ</p>
                    </div>
                `;
                return;
            }
            
            appsGrid.innerHTML = apps.map(app => `
                <div class="app-card" data-app-id="${app.id}">
                    ${app.is_featured ? '<div class="app-badge">Ù…Ù…ÙŠØ²</div>' : ''}
                    
                    <div class="app-image">
                        <i class="fas fa-${getAppIcon(app.category)}"></i>
                    </div>
                    
                    <div class="app-content">
                        <div class="app-header">
                            <div>
                                <h3 class="app-title">${app.name}</h3>
                                <span class="app-category">${app.category}</span>
                            </div>
                            <div class="app-rating">
                                <i class="fas fa-star"></i>
                                <span>${app.average_rating || '4.0'}</span>
                            </div>
                        </div>
                        
                        <p class="app-description">${app.short_description}</p>
                        
                        <div class="app-meta">
                            <div>
                                <span class="app-size">${app.size_mb || 10} MB</span>
                                <span class="app-downloads">
                                    <i class="fas fa-download"></i>
                                    ${app.download_count || 0}
                                </span>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-icon" onclick="previewApp('${app.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-primary" onclick="downloadApp('${app.id}')">
                                    <i class="fas fa-download"></i>
                                </button>
                                ${isAdmin ? `
                                    <button class="btn btn-danger btn-icon" onclick="deleteApp('${app.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        async function loadCategoriesFilter() {
            try {
                const { data: categories, error } = await supabase
                    .from('categories')
                    .select('name')
                    .order('name');
                
                if (error) throw error;
                
                const filter = document.getElementById('categoryFilter');
                const uploadFilter = document.getElementById('appCategory');
                
                if (categories && categories.length > 0) {
                    const options = categories.map(cat => 
                        `<option value="${cat.name}">${cat.name}</option>`
                    ).join('');
                    
                    filter.innerHTML = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª</option>' + options;
                    uploadFilter.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>' + options;
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª:', error);
            }
        }
        
        function updatePagination(totalCount) {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(totalCount / appsPerPage);
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚
            html += `
                <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            // Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØµÙØ­Ø§Øª
            for (let i = 1; i <= totalPages; i++) {
                if (
                    i === 1 ||
                    i === totalPages ||
                    (i >= currentPage - 1 && i <= currentPage + 1)
                ) {
                    html += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    html += '<span style="padding: 0.5rem;">...</span>';
                }
            }
            
            // Ø²Ø± Ø§Ù„ØªØ§Ù„ÙŠ
            html += `
                <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            pagination.innerHTML = html;
        }
        
        function changePage(page) {
            if (page < 1) return;
            currentPage = page;
            loadApps();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showLoadingState() {
            const appsGrid = document.getElementById('appsGrid');
            appsGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
                    <div class="loading" style="margin: 0 auto; width: 50px; height: 50px; border-width: 3px;"></div>
                    <p style="margin-top: 1rem; color: var(--text-muted);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª...</p>
                </div>
            `;
        }
        
        // ============================================
        // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
        // ============================================
        async function previewApp(appId) {
            try {
                const { data: app, error } = await supabase
                    .from('apps')
                    .select('*, profiles(full_name)')
                    .eq('id', appId)
                    .single();
                
                if (error) throw error;
                
                const modal = document.getElementById('previewModal');
                const title = document.getElementById('previewTitle');
                const content = document.getElementById('previewContent');
                
                title.textContent = app.name;
                
                content.innerHTML = `
                    <div style="display: grid; gap: 2rem;">
                        <div style="display: flex; gap: 2rem; align-items: center;">
                            <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--primary-light), var(--primary)); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-${getAppIcon(app.category)}" style="font-size: 3rem; color: white;"></i>
                            </div>
                            <div>
                                <h3 style="margin-bottom: 0.5rem;">${app.name}</h3>
                                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                                    <span class="app-category">${app.category}</span>
                                    <div class="app-rating">
                                        <i class="fas fa-star"></i>
                                        <span>${app.average_rating || '4.0'}</span>
                                        <span style="color: var(--text-muted); font-size: 0.9rem;">(${app.total_ratings || 0} ØªÙ‚ÙŠÙŠÙ…)</span>
                                    </div>
                                </div>
                                <p style="color: var(--text-muted);">${app.short_description}</p>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom: 1rem;">Ø§Ù„ÙˆØµÙ Ø§Ù„ÙƒØ§Ù…Ù„</h4>
                            <p style="color: var(--text-gray); line-height: 1.8;">${app.full_description || app.short_description}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: var(--bg-light); padding: 1rem; border-radius: var(--radius-md);">
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Ø§Ù„Ù…Ø·ÙˆØ±</div>
                                <div>${app.profiles?.full_name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</div>
                            </div>
                            <div style="background: var(--bg-light); padding: 1rem; border-radius: var(--radius-md);">
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</div>
                                <div>${app.version || '1.0.0'}</div>
                            </div>
                            <div style="background: var(--bg-light); padding: 1rem; border-radius: var(--radius-md);">
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Ø§Ù„Ø­Ø¬Ù…</div>
                                <div>${app.size_mb || 10} MB</div>
                            </div>
                            <div style="background: var(--bg-light); padding: 1rem; border-radius: var(--radius-md);">
                                <div style="color: var(--text-muted); font-size: 0.9rem;">Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</div>
                                <div>${app.download_count || 0}</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button class="btn btn-secondary" onclick="hidePreview()">
                                Ø¥ØºÙ„Ø§Ù‚
                            </button>
                            <button class="btn btn-primary" onclick="downloadApp('${app.id}')">
                                <i class="fas fa-download"></i>
                                ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
                            </button>
                        </div>
                    </div>
                `;
                
                modal.classList.remove('hidden');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }
        
        function hidePreview() {
            document.getElementById('previewModal').classList.add('hidden');
        }
        
        // ============================================
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
        // ============================================
        async function downloadApp(appId) {
            if (!currentUser) {
                showAppMessage('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª', 'error');
                return;
            }
            
            try {
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
                const { error: downloadError } = await supabase
                    .from('downloads')
                    .insert([{
                        user_id: currentUser.id,
                        app_id: appId
                    }])
                    .select();
                
                if (downloadError && !downloadError.message.includes('duplicate')) {
                    throw downloadError;
                }
                
                // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                const { error: updateError } = await supabase
                    .from('apps')
                    .update({ download_count: supabase.raw('download_count + 1') })
                    .eq('id', appId);
                
                if (updateError) throw updateError;
                
                showAppMessage('Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...', 'success');
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                setTimeout(loadApps, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }
        
        // ============================================
        // Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª (Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·)
        // ============================================
        function showUploadModal() {
            if (!isAdmin) {
                showAppMessage('Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø© Ù…ØªØ§Ø­Ø© Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ ÙÙ‚Ø·', 'error');
                return;
            }
            
            document.getElementById('uploadModal').classList.remove('hidden');
        }
        
        function hideUploadModal() {
            document.getElementById('uploadModal').classList.add('hidden');
            document.getElementById('uploadAppForm').reset();
        }
        
        async function handleUploadApp(e) {
            e.preventDefault();
            
            if (!isAdmin) {
                showAppMessage('ØºÙŠØ± Ù…ØµØ±Ø­', 'error');
                return;
            }
            
            try {
                const appData = {
                    developer_id: currentUser.id,
                    name: document.getElementById('appName').value,
                    short_description: document.getElementById('appDescription').value,
                    category: document.getElementById('appCategory').value,
                    apk_url: document.getElementById('appApkUrl').value,
                    icon_url: document.getElementById('appIconUrl').value || null,
                    size_mb: parseFloat(document.getElementById('appSize').value) || 10,
                    version: document.getElementById('appVersion').value || '1.0.0',
                    package_name: `com.exotisa.${Date.now()}`,
                    download_count: 0,
                    average_rating: 0,
                    is_featured: false,
                    is_active: true
                };
                
                const { data, error } = await supabase
                    .from('apps')
                    .insert([appData])
                    .select();
                
                if (error) throw error;
                
                showAppMessage('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                hideUploadModal();
                loadApps();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }
        
        async function deleteApp(appId) {
            if (!isAdmin) return;
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) return;
            
            try {
                const { error } = await supabase
                    .from('apps')
                    .delete()
                    .eq('id', appId);
                
                if (error) throw error;
                
                showAppMessage('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                loadApps();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showAppMessage('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }
        
        // ============================================
        // Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„
        // ============================================
        async function loadAdminStats() {
            if (!isAdmin) return;
            
            try {
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
                const { count: appsCount } = await supabase
                    .from('apps')
                    .select('*', { count: 'exact', head: true });
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const { count: usersCount } = await supabase
                    .from('profiles')
                    .select('*', { count: 'exact', head: true });
                
                // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                const { data: downloadsData } = await supabase
                    .from('downloads')
                    .select('id');
                
                document.getElementById('statsApps').textContent = appsCount || 0;
                document.getElementById('statsUsers').textContent = usersCount || 0;
                document.getElementById('statsDownloads').textContent = downloadsData?.length || 0;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }
        
        async function loadUsers() {
            try {
                const { data: users, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                showPreviewModal('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', `
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--bg-light);">
                                    <th style="padding: 1rem; text-align: right;">Ø§Ù„Ø§Ø³Ù…</th>
                                    <th style="padding: 1rem; text-align: right;">Ø§Ù„Ø¨Ø±ÙŠØ¯</th>
                                    <th style="padding: 1rem; text-align: right;">Ø§Ù„Ø¯ÙˆØ±</th>
                                    <th style="padding: 1rem; text-align: right;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${users.map(user => `
                                    <tr style="border-bottom: 1px solid var(--border);">
                                        <td style="padding: 1rem;">${user.full_name}</td>
                                        <td style="padding: 1rem;">${user.email}</td>
                                        <td style="padding: 1rem;">
                                            <span class="app-category">${user.role}</span>
                                        </td>
                                        <td style="padding: 1rem; color: var(--text-muted);">
                                            ${new Date(user.created_at).toLocaleDateString('ar-SA')}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:', error);
            }
        }
        
        async function loadCategories() {
            try {
                const { data: categories, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                showPreviewModal('Ø§Ù„ÙØ¦Ø§Øª', `
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem;">
                        ${categories.map(cat => `
                            <div style="background: var(--bg-light); padding: 1.5rem; border-radius: var(--radius-lg);">
                                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                    <div style="width: 40px; height: 40px; background: ${cat.color || '#3b82f6'}; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-${cat.icon || 'mobile-alt'}" style="color: white;"></i>
                                    </div>
                                    <h4 style="margin: 0;">${cat.name}</h4>
                                </div>
                                <p style="color: var(--text-gray); font-size: 0.9rem; margin: 0;">
                                    ${cat.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                `);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª:', error);
            }
        }
        
        // ============================================
        // Ø§Ù„Ø¨Ø­Ø«
        // ============================================
        function handleSearch() {
            currentPage = 1;
            loadApps();
        }
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // ============================================
        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        // ============================================
        function getAppIcon(category) {
            const icons = {
                'Ø£Ø¯ÙˆØ§Øª': 'tools',
                'Ø£Ù„Ø¹Ø§Ø¨': 'gamepad',
                'Ø¥Ù†ØªØ§Ø¬ÙŠØ©': 'chart-line',
                'ØªØ±ÙÙŠÙ‡': 'film',
                'ØªØ¹Ù„ÙŠÙ…': 'graduation-cap',
                'Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ': 'users',
                'ØµØ­Ø©': 'heartbeat',
                'Ù…Ø§Ù„ÙŠØ©': 'money-bill-wave',
                'Ø§Ù„ØªØ³ÙˆÙ‚': 'shopping-cart',
                'Ø§Ù„Ø³ÙØ±': 'plane',
                'Ø§Ù„Ø·Ø¹Ø§Ù…': 'utensils',
                'Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§': 'camera'
            };
            return icons[category] || 'mobile-alt';
        }
        
        function showAuthMessage(message, type) {
            const messagesDiv = document.getElementById('authMessages');
            showMessage(messagesDiv, message, type);
        }
        
        function showAppMessage(message, type) {
            const messagesDiv = document.getElementById('appMessages');
            showMessage(messagesDiv, message, type);
        }
        
        function showMessage(container, message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            container.innerHTML = '';
            container.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }
        
        function clearAuthMessages() {
            document.getElementById('authMessages').innerHTML = '';
        }
        
        function showLoading(buttonId, text) {
            const button = document.getElementById(buttonId);
            button.innerHTML = `<div class="loading"></div> ${text}`;
            button.disabled = true;
        }
        
        function hideLoading(buttonId, text) {
            const button = document.getElementById(buttonId);
            button.innerHTML = text;
            button.disabled = false;
        }
        
        function showPreviewModal(title, content) {
            const modal = document.getElementById('previewModal');
            const titleEl = document.getElementById('previewTitle');
            const contentEl = document.getElementById('previewContent');
            
            titleEl.textContent = title;
            contentEl.innerHTML = content;
            modal.classList.remove('hidden');
        }
        
        // ============================================
        // Ù…Ø³ØªÙ…Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
        // ============================================
        supabase.auth.onAuthStateChange((event, session) => {
            console.log('ğŸ”‘ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©:', event);
            
            if (event === 'SIGNED_IN') {
                currentUser = session.user;
                loadUserProfile().then(() => {
                    showMainApp();
                    showAppMessage('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Exotisa!', 'success');
                });
            } else if (event === 'SIGNED_OUT') {
                currentUser = null;
                isAdmin = false;
                showAuthScreen();
            }
        });
        
        console.log('ğŸ‰ Exotisa - Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„!');
    </script>
</body>
</html>
