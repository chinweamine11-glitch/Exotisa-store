<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotisa App Store - Premium Android Apps</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸš€</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        :root {
            --bg-1:#1a1625;--bg-2:#251e35;--bg-3:#332a45;--card:#2d2438;--card-hover:#3a3048;
            --text:#fef3f7;--text-2:#e8d5e0;--text-3:#c9b3c0;
            --accent:#ff6b9d;--accent-2:#c44569;--gradient:linear-gradient(135deg,#ff6b9d 0%,#c44569 40%,#8e44ad 100%);
            --success:#2ecc71;--error:#e74c3c;--warning:#f39c12;--info:#3498db;
        }
        body {
            font-family:'Tajawal',sans-serif;background:var(--bg-1);color:var(--text);
            overflow-x:hidden;min-height:100vh;position:relative;
        }
        .hidden {display:none!important;}
        
        /* ANIMATED BACKGROUND */
        .bg-animation {
            position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;
            background:radial-gradient(circle at 20% 30%,rgba(255,107,157,0.08) 0%,transparent 50%),
                       radial-gradient(circle at 80% 70%,rgba(142,68,173,0.08) 0%,transparent 50%);
            animation:bgPulse 10s ease-in-out infinite;
        }
        @keyframes bgPulse {
            0%,100% {opacity:0.5;transform:scale(1);}
            50% {opacity:1;transform:scale(1.05);}
        }
        
        /* THREE.JS BACKGROUND */
        #threeCanvas {position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:0.4;}
        
        /* TOAST NOTIFICATIONS */
        .toast-container {position:fixed;top:20px;left:20px;z-index:9999;display:flex;flex-direction:column;gap:12px;}
        .toast {
            min-width:320px;padding:16px 20px;background:var(--card);border-radius:12px;
            box-shadow:0 8px 32px rgba(0,0,0,0.4);display:flex;align-items:center;gap:12px;
            border-right:4px solid var(--accent);animation:slideIn 0.4s cubic-bezier(0.68,-0.55,0.265,1.55);
        }
        .toast.success {border-right-color:var(--success);}
        .toast.error {border-right-color:var(--error);}
        @keyframes slideIn {
            from {transform:translateX(-120%);opacity:0;}
            to {transform:translateX(0);opacity:1;}
        }
        
        /* AUTH PAGE */
        #authPage {
            min-height:100vh;display:flex;align-items:center;justify-content:center;
            padding:20px;
        }
        .auth-container {
            background:rgba(45,36,56,0.7);backdrop-filter:blur(30px);
            border:1px solid rgba(255,107,157,0.15);border-radius:24px;
            padding:48px;width:100%;max-width:480px;
            box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 100px rgba(255,107,157,0.15);
            position:relative;overflow:hidden;
        }
        .auth-container::before {
            content:'';position:absolute;top:0;left:0;right:0;height:4px;
            background:var(--gradient);
        }
        .auth-container::after {
            content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
            background:radial-gradient(circle,rgba(255,107,157,0.1) 0%,transparent 70%);
            animation:rotate 20s linear infinite;pointer-events:none;
        }
        @keyframes rotate {
            from {transform:rotate(0deg);}
            to {transform:rotate(360deg);}
        }
        
        .logo-hero {text-align:center;margin-bottom:32px;position:relative;z-index:1;}
        .logo-icon {font-size:80px;filter:drop-shadow(0 0 30px rgba(255,107,157,0.6));}
        .logo-text {
            font-size:40px;font-weight:900;background:var(--gradient);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            letter-spacing:-1px;margin-top:8px;
        }
        .auth-subtitle {
            text-align:center;color:var(--text-2);font-size:18px;
            margin-bottom:32px;font-weight:500;
        }
        
        .form-group {margin-bottom:24px;position:relative;z-index:1;}
        .form-label {display:block;margin-bottom:8px;font-weight:600;color:var(--text-2);font-size:14px;}
        .input-wrapper {position:relative;}
        .form-input,.form-select {
            width:100%;padding:14px 18px;background:rgba(26,22,37,0.6);
            border:2px solid rgba(255,107,157,0.2);border-radius:12px;
            color:var(--text);font-family:'Tajawal';font-size:16px;
            transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        .form-input:focus,.form-select:focus {
            outline:none;border-color:var(--accent);
            background:rgba(26,22,37,0.9);
            box-shadow:0 0 0 4px rgba(255,107,157,0.1),0 0 30px rgba(255,107,157,0.2);
            transform:translateY(-2px);
        }
        .form-input.with-toggle {padding-left:48px;}
        
        .password-toggle {
            position:absolute;left:14px;top:50%;transform:translateY(-50%);
            background:none;border:none;color:var(--text-3);cursor:pointer;
            padding:6px;display:flex;align-items:center;transition:color 0.3s;
        }
        .password-toggle:hover {color:var(--accent);}
        
        .btn {
            padding:14px 28px;border:none;border-radius:12px;
            font-family:'Tajawal';font-weight:700;cursor:pointer;
            transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
            display:inline-flex;align-items:center;justify-content:center;gap:10px;
            font-size:16px;position:relative;overflow:hidden;
        }
        .btn::before {
            content:'';position:absolute;top:50%;left:50%;width:0;height:0;
            border-radius:50%;background:rgba(255,255,255,0.15);
            transform:translate(-50%,-50%);transition:width 0.6s,height 0.6s;
        }
        .btn:hover::before {width:400px;height:400px;}
        
        .btn-primary {
            background:var(--gradient);color:white;width:100%;
            box-shadow:0 8px 24px rgba(255,107,157,0.3);
        }
        .btn-primary:hover {
            transform:translateY(-3px);
            box-shadow:0 12px 32px rgba(255,107,157,0.4);
        }
        
        .btn-google {
            background:white;color:#333;width:100%;
            box-shadow:0 4px 12px rgba(0,0,0,0.1);
        }
        .btn-google:hover {
            transform:translateY(-3px);
            box-shadow:0 8px 20px rgba(0,0,0,0.15);
        }
        
        .btn-outline {
            background:transparent;color:var(--accent);
            border:2px solid var(--accent);padding:12px 24px;
        }
        .btn-outline:hover {
            background:var(--accent);color:white;
            transform:translateY(-3px);
            box-shadow:0 8px 20px rgba(255,107,157,0.3);
        }
        
        .divider {
            margin:24px 0;text-align:center;color:var(--text-3);
            font-size:14px;position:relative;
        }
        .divider::before,.divider::after {
            content:'';position:absolute;top:50%;width:42%;height:1px;
            background:linear-gradient(to right,transparent,rgba(255,107,157,0.3),transparent);
        }
        .divider::before {left:0;}
        .divider::after {right:0;}
        
        .auth-switch {text-align:center;margin-top:24px;color:var(--text-2);font-size:15px;}
        .auth-switch a {
            color:var(--accent);text-decoration:none;font-weight:700;
            transition:color 0.3s;
        }
        .auth-switch a:hover {color:#ff8cb3;text-decoration:underline;}
        
        /* MAIN APP */
        #mainApp {min-height:100vh;padding-bottom:60px;}
        header {
            position:sticky;top:0;z-index:1000;
            background:rgba(26,22,37,0.8);backdrop-filter:blur(20px);
            border-bottom:1px solid rgba(255,107,157,0.1);
            padding:16px 0;box-shadow:0 4px 20px rgba(0,0,0,0.3);
        }
        .nav {display:flex;align-items:center;justify-content:space-between;}
        .logo {
            display:flex;align-items:center;gap:12px;font-size:28px;font-weight:900;
            background:var(--gradient);-webkit-background-clip:text;
            -webkit-text-fill-color:transparent;cursor:pointer;
            transition:transform 0.3s;
        }
        .logo:hover {transform:scale(1.05);}
        
        .nav-menu {display:flex;gap:8px;list-style:none;}
        .nav-menu a {
            padding:10px 20px;color:var(--text-2);text-decoration:none;
            border-radius:10px;transition:all 0.3s;font-weight:600;
        }
        .nav-menu a:hover,.nav-menu a.active {
            background:rgba(255,107,157,0.15);color:var(--accent);
        }
        
        .nav-right {display:flex;gap:12px;align-items:center;}
        .user-badge {
            display:flex;align-items:center;gap:12px;padding:8px 16px;
            background:rgba(45,36,56,0.8);border:1px solid rgba(255,107,157,0.2);
            border-radius:24px;transition:all 0.3s;
        }
        .user-badge:hover {
            background:rgba(45,36,56,1);border-color:var(--accent);
            box-shadow:0 0 24px rgba(255,107,157,0.2);
        }
        .user-avatar {
            width:36px;height:36px;border-radius:50%;
            background:var(--gradient);display:flex;align-items:center;
            justify-content:center;font-weight:700;font-size:16px;color:white;
        }
        .user-details {display:flex;flex-direction:column;}
        .user-name {font-weight:700;font-size:14px;}
        .user-role {
            font-size:11px;color:var(--accent);font-weight:600;
            background:rgba(255,107,157,0.1);padding:2px 8px;
            border-radius:8px;display:inline-block;margin-top:2px;
        }
        
        .container {max-width:1320px;margin:0 auto;padding:0 24px;}
        
        /* HERO */
        .hero {padding:80px 0 60px;text-align:center;}
        .hero-title {
            font-size:clamp(36px,7vw,72px);font-weight:900;line-height:1.1;
            background:var(--gradient);-webkit-background-clip:text;
            -webkit-text-fill-color:transparent;margin-bottom:20px;
            filter:drop-shadow(0 0 40px rgba(255,107,157,0.3));
        }
        .hero-subtitle {font-size:22px;color:var(--text-2);margin-bottom:40px;font-weight:500;}
        .hero-cta {display:flex;gap:16px;justify-content:center;flex-wrap:wrap;}
        
        /* STATS */
        .stats {
            display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
            gap:24px;margin:60px 0;
        }
        .stat-box {
            background:rgba(45,36,56,0.5);backdrop-filter:blur(10px);
            border:1px solid rgba(255,107,157,0.15);border-radius:20px;
            padding:32px;text-align:center;position:relative;overflow:hidden;
            transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
        }
        .stat-box::before {
            content:'';position:absolute;top:0;left:0;right:0;height:3px;
            background:var(--gradient);transform:scaleX(0);transition:transform 0.4s;
        }
        .stat-box:hover::before {transform:scaleX(1);}
        .stat-box:hover {
            transform:translateY(-10px);
            box-shadow:0 20px 50px rgba(0,0,0,0.4),0 0 40px rgba(255,107,157,0.2);
            border-color:var(--accent);background:rgba(45,36,56,0.8);
        }
        .stat-emoji {font-size:48px;margin-bottom:16px;filter:drop-shadow(0 0 20px rgba(255,107,157,0.3));}
        .stat-value {
            font-size:42px;font-weight:900;background:var(--gradient);
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;
            margin-bottom:8px;
        }
        .stat-label {color:var(--text-2);font-weight:600;font-size:16px;}
        
        /* CATEGORIES */
        .categories {display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:40px 0;}
        .cat-chip {
            padding:10px 24px;background:rgba(45,36,56,0.6);
            border:2px solid rgba(255,107,157,0.2);border-radius:24px;
            cursor:pointer;transition:all 0.3s;display:flex;align-items:center;gap:8px;
            font-weight:600;font-size:15px;
        }
        .cat-chip:hover {
            background:rgba(45,36,56,0.9);border-color:var(--accent);
            transform:translateY(-4px);box-shadow:0 8px 20px rgba(255,107,157,0.2);
        }
        .cat-chip.active {
            background:var(--gradient);border-color:transparent;color:white;
            transform:translateY(-4px);box-shadow:0 8px 20px rgba(255,107,157,0.3);
        }
        
        /* APPS GRID */
        .apps-grid {
            display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
            gap:28px;margin-top:40px;
        }
        .app-card {
            background:rgba(45,36,56,0.6);backdrop-filter:blur(10px);
            border:1px solid rgba(255,107,157,0.15);border-radius:20px;
            overflow:hidden;cursor:pointer;position:relative;
            transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
        }
        .app-card::before {
            content:'';position:absolute;top:0;left:0;right:0;bottom:0;
            background:radial-gradient(circle at 50% 0%,rgba(255,107,157,0.15) 0%,transparent 70%);
            opacity:0;transition:opacity 0.4s;
        }
        .app-card:hover::before {opacity:1;}
        .app-card:hover {
            transform:translateY(-12px) scale(1.02);
            box-shadow:0 24px 60px rgba(0,0,0,0.5),0 0 50px rgba(255,107,157,0.25);
            border-color:var(--accent);
        }
        .app-icon {width:100%;aspect-ratio:1;object-fit:cover;border-bottom:1px solid rgba(255,107,157,0.1);}
        .app-body {padding:20px;}
        .app-name {font-size:20px;font-weight:700;margin-bottom:6px;color:var(--text);}
        .app-dev {font-size:14px;color:var(--text-3);margin-bottom:16px;}
        .app-footer {
            display:flex;justify-content:space-between;align-items:center;
            padding-top:16px;margin-top:16px;
            border-top:1px solid rgba(255,107,157,0.1);
        }
        .app-rating {display:flex;align-items:center;gap:6px;color:var(--warning);font-weight:700;}
        .app-downloads {display:flex;align-items:center;gap:6px;color:var(--text-2);font-size:14px;font-weight:600;}
        
        .section-heading {
            font-size:36px;font-weight:800;margin:60px 0 24px;
            background:var(--gradient);-webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
        }
        
        /* LOADING */
        .loading {display:flex;flex-direction:column;align-items:center;padding:80px 20px;}
        .spinner {
            width:56px;height:56px;border:5px solid rgba(255,107,157,0.2);
            border-top-color:var(--accent);border-radius:50%;
            animation:spin 0.8s linear infinite;
        }
        @keyframes spin {to {transform:rotate(360deg);}}
        .loading-text {margin-top:20px;color:var(--text-2);font-weight:600;font-size:16px;}
        
        /* MODAL */
        .modal-overlay {
            position:fixed;top:0;left:0;right:0;bottom:0;
            background:rgba(0,0,0,0.85);backdrop-filter:blur(10px);
            z-index:2000;display:flex;align-items:center;justify-content:center;
            opacity:0;pointer-events:none;transition:opacity 0.3s;
        }
        .modal-overlay.active {opacity:1;pointer-events:all;}
        .modal {
            background:var(--card);border:1px solid rgba(255,107,157,0.2);
            border-radius:24px;max-width:900px;width:95%;max-height:90vh;
            overflow-y:auto;box-shadow:0 24px 60px rgba(0,0,0,0.6);
            transform:scale(0.9);transition:transform 0.3s;
        }
        .modal-overlay.active .modal {transform:scale(1);}
        .modal-header {
            padding:24px 28px;border-bottom:1px solid rgba(255,107,157,0.1);
            display:flex;justify-content:space-between;align-items:center;
        }
        .modal-title {font-size:28px;font-weight:800;}
        .modal-close {
            background:none;border:none;color:var(--text-3);cursor:pointer;
            padding:8px;border-radius:50%;transition:all 0.3s;
        }
        .modal-close:hover {background:rgba(231,76,60,0.15);color:var(--error);}
        .modal-body {padding:28px;}
        
        /* TABLES */
        .table {width:100%;border-collapse:collapse;margin-top:20px;}
        .table th,.table td {padding:16px;text-align:right;border-bottom:1px solid rgba(255,107,157,0.1);}
        .table th {background:rgba(45,36,56,0.5);font-weight:700;color:var(--text-2);}
        .table tr:hover {background:rgba(45,36,56,0.3);}
        .table img {width:48px;height:48px;border-radius:10px;}
        
        .badge {
            display:inline-block;padding:6px 14px;border-radius:20px;
            font-size:12px;font-weight:700;
        }
        .badge.success {background:rgba(46,204,113,0.2);color:var(--success);}
        .badge.warning {background:rgba(243,156,18,0.2);color:var(--warning);}
        .badge.error {background:rgba(231,76,60,0.2);color:var(--error);}
        
        @media (max-width:768px) {
            .nav-menu {display:none;}
            .apps-grid {grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:16px;}
            .auth-container {padding:32px 24px;}
            .hero-title {font-size:36px;}
            .stats {grid-template-columns:1fr 1fr;gap:16px;}
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    <div class="toast-container" id="toastContainer"></div>
    <div id="threeCanvas"></div>
    
    <!-- AUTH PAGE -->
    <div id="authPage">
        <div class="auth-container">
            <div class="logo-hero">
                <div class="logo-icon">ğŸš€</div>
                <div class="logo-text">Exotisa</div>
            </div>
            
            <!-- LOGIN FORM -->
            <div id="loginView">
                <h2 class="auth-subtitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h2>
                <form onsubmit="return doLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" id="loginEmail" required 
                               placeholder="your@email.com" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input with-toggle" id="loginPassword" 
                                   required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
                            <button type="button" class="password-toggle" onclick="togglePass('loginPassword')">
                                <span class="material-icons">visibility_off</span>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">login</span>
                        <span>Ø¯Ø®ÙˆÙ„</span>
                    </button>
                </form>
                
                <div class="divider">Ø£Ùˆ</div>
                
                <button class="btn btn-google" onclick="doGoogleLogin()">
                    <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                    <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Google</span>
                </button>
                
                <div class="auth-switch">
                    Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showReg();return false;">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù† Ù…Ø¬Ø§Ù†Ø§Ù‹</a>
                </div>
            </div>
            
            <!-- REGISTER FORM -->
            <div id="registerView" class="hidden">
                <h2 class="auth-subtitle">Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ ÙˆØ§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ø§Ù„Ø¢Ù†</h2>
                <form onsubmit="return doRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                        <input type="text" class="form-input" id="regName" required 
                               placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„" autocomplete="name">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                        <input type="email" class="form-input" id="regEmail" required 
                               placeholder="your@email.com" autocomplete="email">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <div class="input-wrapper">
                            <input type="password" class="form-input with-toggle" id="regPassword" 
                                   required minlength="6" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" 
                                   autocomplete="new-password">
                            <button type="button" class="password-toggle" onclick="togglePass('regPassword')">
                                <span class="material-icons">visibility_off</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label>
                        <select class="form-select" id="regRole">
                            <option value="user">ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ø¯ÙŠ</option>
                            <option value="developer">ğŸ’» Ù…Ø·ÙˆØ± ØªØ·Ø¨ÙŠÙ‚Ø§Øª</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <span class="material-icons">person_add</span>
                        <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span>
                    </button>
                </form>
                
                <div class="auth-switch">
                    Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showLog();return false;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- MAIN APP -->
    <div id="mainApp" class="hidden">
        <header>
            <nav class="container nav">
                <div class="logo" onclick="loadPage('home')">
                    <span>ğŸš€</span>
                    <span>Exotisa</span>
                </div>
                
                <ul class="nav-menu">
                    <li><a href="#" onclick="loadPage('home');return false;" class="active" id="navHome">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                    <li><a href="#" onclick="loadPage('apps');return false;" id="navApps">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</a></li>
                    <li><a href="#" onclick="loadPage('categories');return false;" id="navCats">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</a></li>
                    <li class="hidden" id="navDevLi"><a href="#" onclick="loadPage('dashboard');return false;" id="navDev">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
                    <li class="hidden" id="navAdminLi"><a href="#" onclick="loadPage('admin');return false;" id="navAdmin">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a></li>
                </ul>
                
                <div class="nav-right">
                    <div class="user-badge">
                        <div class="user-avatar" id="userAv"></div>
                        <div class="user-details">
                            <div class="user-name" id="userName"></div>
                            <div class="user-role" id="userRole"></div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="doLogout()">
                        <span class="material-icons">logout</span>
                        <span>Ø®Ø±ÙˆØ¬</span>
                    </button>
                </div>
            </nav>
        </header>
        
        <main class="container" id="content">
            <div class="loading">
                <div class="spinner"></div>
                <div class="loading-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
            </div>
        </main>
    </div>
    
    <!-- APP DETAILS MODAL -->
    <div class="modal-overlay" id="appModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="appModalTitle"></h2>
                <button class="modal-close" onclick="closeModal('appModal')">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body" id="appModalBody"></div>
        </div>
    </div>
    
    <script>
        // ============================================================
        // CONFIGURATION
        // ============================================================
        const CFG = {
            supabaseUrl: 'https://qjfpkwyglveukzfazmzo.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqZnBrd3lnbHZldWt6ZmF6bXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjY2MjMsImV4cCI6MjA4MzA0MjYyM30.L-bh48EGgn348UzJzBajJc1PR7-z1weW1ayzZz-tbvc'
        };
        
        const sb = window.supabase.createClient(CFG.supabaseUrl, CFG.supabaseKey);
        let user = null;
        let userData = null;
        
        // ============================================================
        // UTILITIES
        // ============================================================
        
        function toast(msg, type = 'info') {
            const c = document.getElementById('toastContainer');
            const t = document.createElement('div');
            t.className = `toast ${type}`;
            const icons = {success: 'check_circle', error: 'error', info: 'info', warning: 'warning'};
            t.innerHTML = `<span class="material-icons">${icons[type]}</span><span>${msg}</span>`;
            c.appendChild(t);
            setTimeout(() => {
                t.style.opacity = '0';
                t.style.transform = 'translateX(-120%)';
                setTimeout(() => t.remove(), 400);
            }, 4000);
        }
        
        function fmt(n) {
            if (n >= 1000000) return (n / 1000000).toFixed(1) + 'M';
            if (n >= 1000) return (n / 1000).toFixed(1) + 'K';
            return n.toString();
        }
        
        function togglePass(id) {
            const inp = document.getElementById(id);
            const btn = inp.parentElement.querySelector('.password-toggle .material-icons');
            if (inp.type === 'password') {
                inp.type = 'text';
                btn.textContent = 'visibility';
            } else {
                inp.type = 'password';
                btn.textContent = 'visibility_off';
            }
        }
        
        function showLog() {
            document.getElementById('loginView').classList.remove('hidden');
            document.getElementById('registerView').classList.add('hidden');
        }
        
        function showReg() {
            document.getElementById('loginView').classList.add('hidden');
            document.getElementById('registerView').classList.remove('hidden');
        }
        
        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }
        
        // ============================================================
        // AUTHENTICATION
        // ============================================================
        
        async function doLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const orig = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = '<span class="material-icons">hourglass_empty</span><span>Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ø®ÙˆÙ„...</span>';
                
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value;
                
                const {data, error} = await sb.auth.signInWithPassword({email, password});
                
                if (error) throw error;
                
                toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'success');
                
            } catch (err) {
                console.error('Login error:', err);
                let msg = 'Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                if (err.message.includes('Invalid login')) msg = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                else if (err.message.includes('Email not confirmed')) msg = 'ÙŠØ±Ø¬Ù‰ ØªØ£ÙƒÙŠØ¯ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ';
                else msg = err.message;
                toast(msg, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = orig;
            }
            
            return false;
        }
        
        async function doRegister(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const orig = btn.innerHTML;
            
            try {
                btn.disabled = true;
                btn.innerHTML = '<span class="material-icons">hourglass_empty</span><span>Ø¬Ø§Ø±Ù Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...</span>';
                
                const email = document.getElementById('regEmail').value.trim();
                const password = document.getElementById('regPassword').value;
                const name = document.getElementById('regName').value.trim();
                const role = document.getElementById('regRole').value;
                
                const {data, error} = await sb.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: name,
                            role: role
                        }
                    }
                });
                
                if (error) throw error;
                
                toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨! ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ù„Ù„ØªØ£ÙƒÙŠØ¯ ğŸ“§', 'success');
                e.target.reset();
                setTimeout(() => showLog(), 2000);
                
            } catch (err) {
                console.error('Register error:', err);
                let msg = 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
                if (err.message.includes('already registered')) msg = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„';
                else if (err.message.includes('Password')) msg = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
                else msg = err.message;
                toast(msg, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = orig;
            }
            
            return false;
        }
        
        async function doGoogleLogin() {
            try {
                const {data, error} = await sb.auth.signInWithOAuth({
                    provider: 'google',
                    options: {redirectTo: window.location.origin}
                });
                
                if (error) throw error;
                
            } catch (err) {
                console.error('Google login error:', err);
                toast('Ø®Ø·Ø£ ÙÙŠ Google OAuth: ' + err.message, 'error');
            }
        }
        
        async function doLogout() {
            try {
                await sb.auth.signOut();
                toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'success');
            } catch (err) {
                toast('Ø®Ø·Ø£: ' + err.message, 'error');
            }
        }
        
        // ============================================================
        // AUTH STATE LISTENER
        // ============================================================
        
        sb.auth.onAuthStateChange(async (event, session) => {
            console.log('Auth event:', event);
            
            if (event === 'SIGNED_IN' && session) {
                user = session.user;
                
                let retries = 3;
                while (retries > 0) {
                    const {data, error} = await sb.from('users').select('*').eq('id', user.id).single();
                    if (data) {
                        userData = data;
                        break;
                    }
                    retries--;
                    await new Promise(r => setTimeout(r, 1000));
                }
                
                if (userData) {
                    document.getElementById('authPage').classList.add('hidden');
                    document.getElementById('mainApp').classList.remove('hidden');
                    
                    const initials = (userData.full_name || userData.email)
                        .split(' ').map(n => n[0]).slice(0,2).join('').toUpperCase();
                    
                    document.getElementById('userAv').textContent = initials;
                    document.getElementById('userName').textContent = userData.full_name || userData.email.split('@')[0];
                    
                    const roles = {admin:'ğŸ‘‘ Ù…Ø¯ÙŠØ±',developer:'ğŸ’» Ù…Ø·ÙˆØ±',user:'ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù…'};
                    document.getElementById('userRole').textContent = roles[userData.role] || 'ğŸ‘¤ Ù…Ø³ØªØ®Ø¯Ù…';
                    
                    if (userData.role === 'developer' || userData.role === 'admin') {
                        document.getElementById('navDevLi').classList.remove('hidden');
                    }
                    if (userData.role === 'admin') {
                        document.getElementById('navAdminLi').classList.remove('hidden');
                    }
                    
                    await loadPage('home');
                }
                
            } else if (event === 'SIGNED_OUT') {
                user = null;
                userData = null;
                document.getElementById('authPage').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('navDevLi').classList.add('hidden');
                document.getElementById('navAdminLi').classList.add('hidden');
                showLog();
            }
        });
        
        // ============================================================
        // PAGES
        // ============================================================
        
        async function loadPage(page) {
            const c = document.getElementById('content');
            c.innerHTML = '<div class="loading"><div class="spinner"></div><div class="loading-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div></div>';
            
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            const navId = 'nav' + page.charAt(0).toUpperCase() + page.slice(1);
            const navEl = document.getElementById(navId);
            if (navEl) navEl.classList.add('active');
            
            try {
                if (page === 'home') await renderHome(c);
                else if (page === 'apps') await renderApps(c);
                else if (page === 'categories') await renderCategories(c);
                else if (page === 'dashboard') await renderDashboard(c);
                else if (page === 'admin') await renderAdmin(c);
            } catch (err) {
                console.error('Page load error:', err);
                c.innerHTML = `<div class="loading"><p style="color:var(--error);">Ø®Ø·Ø£: ${err.message}</p></div>`;
                toast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©', 'error');
            }
        }
        
        async function renderHome(c) {
            const [stats, apps, cats] = await Promise.all([
                sb.from('apps').select('id', {count:'exact',head:true}),
                sb.from('apps_with_stats').select('*').eq('status','approved').order('downloads_count',{ascending:false}).limit(12),
                sb.from('categories').select('*').order('name')
            ]);
            
            const appsList = apps.data || [];
            const catsList = cats.data || [];
            
            c.innerHTML = `
                <section class="hero">
                    <h1 class="hero-title">Exotisa App Store</h1>
                    <p class="hero-subtitle">Ø§ÙƒØªØ´Ù Ø£ÙØ¶Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯</p>
                    <div class="hero-cta">
                        <button class="btn btn-primary" onclick="loadPage('apps')">
                            <span class="material-icons">apps</span>
                            <span>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</span>
                        </button>
                        ${userData.role === 'developer' || userData.role === 'admin' ? `
                            <button class="btn btn-outline" onclick="loadPage('dashboard')">
                                <span class="material-icons">dashboard</span>
                                <span>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
                            </button>
                        ` : ''}
                    </div>
                </section>
                
                <section class="stats">
                    <div class="stat-box">
                        <div class="stat-emoji">ğŸ“±</div>
                        <div class="stat-value">${fmt(stats.count || 0)}</div>
                        <div class="stat-label">ØªØ·Ø¨ÙŠÙ‚ Ù…ØªØ§Ø­</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-emoji">ğŸ—‚ï¸</div>
                        <div class="stat-value">${fmt(catsList.length)}</div>
                        <div class="stat-label">ØªØµÙ†ÙŠÙ</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-emoji">ğŸ”’</div>
                        <div class="stat-value">100%</div>
                        <div class="stat-label">Ø¢Ù…Ù† ÙˆÙ…Ø¬Ø§Ù†ÙŠ</div>
                    </div>
                </section>
                
                ${appsList.length > 0 ? `
                    <h2 class="section-heading">âœ¨ Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</h2>
                    <div class="apps-grid">
                        ${appsList.map(app => renderAppCard(app)).join('')}
                    </div>
                ` : '<p style="text-align:center;color:var(--text-3);padding:60px 20px;font-size:18px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>'}
            `;
        }
        
        async function renderApps(c) {
            const [apps, cats] = await Promise.all([
                sb.from('apps_with_stats').select('*').eq('status','approved').order('downloads_count',{ascending:false}),
                sb.from('categories').select('*').order('name')
            ]);
            
            const appsList = apps.data || [];
            const catsList = cats.data || [];
            
            c.innerHTML = `
                <h1 class="section-heading">ğŸ“± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</h1>
                
                <div class="categories">
                    <div class="cat-chip active" onclick="filterByCategory(null,event)">
                        <span>Ø§Ù„ÙƒÙ„</span>
                    </div>
                    ${catsList.map(cat => `
                        <div class="cat-chip" onclick="filterByCategory('${cat.id}',event)">
                            <span>${cat.icon}</span>
                            <span>${cat.name}</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="apps-grid" id="appsGrid">
                    ${appsList.map(app => renderAppCard(app)).join('')}
                </div>
            `;
        }
        
        async function renderCategories(c) {
            const {data} = await sb.from('categories').select('*').order('name');
            const cats = data || [];
            
            c.innerHTML = `
                <h1 class="section-heading">ğŸ—‚ï¸ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h1>
                <div class="apps-grid">
                    ${cats.map(cat => `
                        <div class="app-card" onclick="loadPage('apps');setTimeout(()=>filterByCategory('${cat.id}'),100)">
                            <div style="aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:80px;background:rgba(45,36,56,0.4);">
                                ${cat.icon}
                            </div>
                            <div class="app-body">
                                <div class="app-name">${cat.name}</div>
                                <div class="app-dev">${cat.description}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        async function renderDashboard(c) {
            if (!userData || (userData.role !== 'developer' && userData.role !== 'admin')) {
                c.innerHTML = '<p style="text-align:center;color:var(--error);padding:60px;">ØºÙŠØ± Ù…ØµØ±Ø­</p>';
                return;
            }
            
            const {data} = await sb.from('apps_with_stats').select('*').eq('developer_id',user.id).order('created_at',{ascending:false});
            const myApps = data || [];
            
            c.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:40px;">
                    <h1 class="section-heading" style="margin:0;">ğŸ’» Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø·ÙˆØ±</h1>
                    <button class="btn btn-primary" onclick="toast('Ø±ÙØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹!','info')">
                        <span class="material-icons">add</span>
                        <span>Ø±ÙØ¹ ØªØ·Ø¨ÙŠÙ‚</span>
                    </button>
                </div>
                
                <div style="background:rgba(45,36,56,0.5);border:1px solid rgba(255,107,157,0.15);border-radius:20px;padding:28px;">
                    <h2 style="font-size:24px;font-weight:700;margin-bottom:20px;">ØªØ·Ø¨ÙŠÙ‚Ø§ØªÙŠ</h2>
                    
                    ${myApps.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</th>
                                    <th>Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</th>
                                    <th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${myApps.map(app => `
                                    <tr>
                                        <td>
                                            <div style="display:flex;align-items:center;gap:12px;">
                                                <img src="${app.icon_url}" alt="${app.name}">
                                                <span style="font-weight:700;">${app.name}</span>
                                            </div>
                                        </td>
                                        <td>${app.version}</td>
                                        <td>
                                            <span class="badge ${app.status==='approved'?'success':app.status==='pending'?'warning':'error'}">
                                                ${app.status==='approved'?'Ù…ÙØ¹Ù‘Ù„':app.status==='pending'?'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©':'Ù…Ø±ÙÙˆØ¶'}
                                            </span>
                                        </td>
                                        <td>${fmt(app.downloads_count)}</td>
                                        <td>
                                            <div class="app-rating">
                                                <span class="material-icons">star</span>
                                                <span>${app.rating||0}</span>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align:center;color:var(--text-3);padding:40px;">Ù„Ù… ØªØ±ÙØ¹ Ø£ÙŠ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</p>'}
                </div>
            `;
        }
        
        async function renderAdmin(c) {
            if (!userData || userData.role !== 'admin') {
                c.innerHTML = '<p style="text-align:center;color:var(--error);padding:60px;">ØºÙŠØ± Ù…ØµØ±Ø­</p>';
                return;
            }
            
            const {data} = await sb.from('apps_with_developer').select('*').eq('status','pending').order('created_at',{ascending:false});
            const pending = data || [];
            
            c.innerHTML = `
                <h1 class="section-heading">ğŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h1>
                
                <div style="background:rgba(45,36,56,0.5);border:1px solid rgba(255,107,157,0.15);border-radius:20px;padding:28px;">
                    <h2 style="font-size:24px;font-weight:700;margin-bottom:20px;">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (${pending.length})</h2>
                    
                    ${pending.length > 0 ? `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</th>
                                    <th>Ø§Ù„Ù…Ø·ÙˆØ±</th>
                                    <th>Ø§Ù„Ø¥ØµØ¯Ø§Ø±</th>
                                    <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pending.map(app => `
                                    <tr>
                                        <td>
                                            <div style="display:flex;align-items:center;gap:12px;">
                                                <img src="${app.icon_url}" alt="${app.name}">
                                                <span style="font-weight:700;">${app.name}</span>
                                            </div>
                                        </td>
                                        <td>${app.developer_name}</td>
                                        <td>${app.version}</td>
                                        <td>
                                            <button class="btn btn-outline" onclick="approveApp('${app.id}')" 
                                                    style="padding:8px 16px;font-size:14px;">
                                                <span class="material-icons">check</span>
                                                <span>Ù‚Ø¨ÙˆÙ„</span>
                                            </button>
                                            <button class="btn btn-outline" onclick="rejectApp('${app.id}')" 
                                                    style="padding:8px 16px;font-size:14px;color:var(--error);border-color:var(--error);">
                                                <span class="material-icons">close</span>
                                                <span>Ø±ÙØ¶</span>
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    ` : '<p style="text-align:center;color:var(--text-3);padding:40px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</p>'}
                </div>
            `;
        }
        
        function renderAppCard(app) {
            return `
                <div class="app-card" data-category="${app.category_id||''}" onclick="showAppModal('${app.id}')">
                    <img src="${app.icon_url}" alt="${app.name}" class="app-icon" 
                         onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%232d2438%22 width=%22100%22 height=%22100%22/><text x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23ff6b9d%22 font-size=%2240%22>ğŸ“±</text></svg>'">
                    <div class="app-body">
                        <div class="app-name">${app.name}</div>
                        <div class="app-dev">${app.developer_name||'Ù…Ø·ÙˆØ±'}</div>
                        <div class="app-footer">
                            <div class="app-rating">
                                <span class="material-icons">star</span>
                                <span>${app.rating||0}</span>
                            </div>
                            <div class="app-downloads">
                                <span class="material-icons">download</span>
                                <span>${fmt(app.downloads_count)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function filterByCategory(catId, e) {
            const cards = document.querySelectorAll('.app-card');
            const chips = document.querySelectorAll('.cat-chip');
            
            chips.forEach(ch => ch.classList.remove('active'));
            e.target.closest('.cat-chip').classList.add('active');
            
            cards.forEach(card => {
                if (!catId || card.dataset.category === catId) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        async function showAppModal(appId) {
            const {data:app} = await sb.from('apps_with_developer').select('*').eq('id',appId).single();
            if (!app) return;
            
            document.getElementById('appModalTitle').textContent = app.name;
            document.getElementById('appModalBody').innerHTML = `
                <div style="display:grid;grid-template-columns:180px 1fr;gap:24px;margin-bottom:28px;">
                    <img src="${app.icon_url}" style="width:180px;height:180px;border-radius:20px;">
                    <div>
                        <div style="font-size:18px;color:var(--text-2);margin-bottom:12px;">
                            <strong>Ø§Ù„Ù…Ø·ÙˆØ±:</strong> ${app.developer_name}
                        </div>
                        <div style="font-size:16px;color:var(--text-2);margin-bottom:12px;">
                            <strong>Ø§Ù„Ø¥ØµØ¯Ø§Ø±:</strong> ${app.version}
                        </div>
                        <div style="font-size:16px;color:var(--text-2);margin-bottom:20px;">
                            <strong>Ø§Ù„ØªØµÙ†ÙŠÙ:</strong> ${app.category_icon||''} ${app.category_name||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
                        </div>
                        <div style="display:flex;gap:12px;">
                            <button class="btn btn-primary" onclick="downloadApp('${app.id}','${app.apk_url}')">
                                <span class="material-icons">download</span>
                                <span>ØªØ­Ù…ÙŠÙ„ APK</span>
                            </button>
                            <button class="btn btn-outline" onclick="toast('Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù‚Ø±ÙŠØ¨Ø§Ù‹!','info')">
                                <span class="material-icons">favorite</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom:28px;">
                    <h3 style="font-size:20px;font-weight:700;margin-bottom:12px;">ğŸ“ Ø§Ù„ÙˆØµÙ</h3>
                    <p style="color:var(--text-2);line-height:1.8;">${app.full_description}</p>
                </div>
                
                ${app.screenshots && app.screenshots.length > 0 ? `
                    <div style="margin-bottom:28px;">
                        <h3 style="font-size:20px;font-weight:700;margin-bottom:16px;">ğŸ“¸ Ù„Ù‚Ø·Ø§Øª Ø§Ù„Ø´Ø§Ø´Ø©</h3>
                        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;">
                            ${app.screenshots.map(url => `
                                <img src="${url}" style="width:100%;border-radius:12px;">
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <div>
                    <h3 style="font-size:20px;font-weight:700;margin-bottom:16px;">â­ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</h3>
                    <p style="color:var(--text-3);">Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù‚Ø±ÙŠØ¨Ø§Ù‹...</p>
                </div>
            `;
            
            document.getElementById('appModal').classList.add('active');
        }
        
        async function downloadApp(appId, apkUrl) {
            try {
                await sb.from('downloads').insert({
                    app_id: appId,
                    user_id: user.id,
                    device_fingerprint: navigator.userAgent
                });
                
                window.open(apkUrl, '_blank');
                toast('Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù…ÙŠÙ„! ğŸ“¥', 'success');
            } catch (err) {
                console.error('Download error:', err);
                toast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„', 'error');
            }
        }
        
        async function approveApp(appId) {
            try {
                await sb.from('apps').update({status:'approved'}).eq('id',appId);
                toast('ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!','success');
                await loadPage('admin');
            } catch (err) {
                toast('Ø®Ø·Ø£: '+err.message,'error');
            }
        }
        
        async function rejectApp(appId) {
            try {
                await sb.from('apps').update({status:'rejected'}).eq('id',appId);
                toast('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚','info');
                await loadPage('admin');
            } catch (err) {
                toast('Ø®Ø·Ø£: '+err.message,'error');
            }
        }
        
        // ============================================================
        // THREE.JS BACKGROUND
        // ============================================================
        
        function initThree() {
            const canvas = document.getElementById('threeCanvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({canvas, alpha:true, antialias:true});
            
            renderer.setSize(window.innerWidth, window.innerHeight);
            
            const geo = new THREE.TorusGeometry(1, 0.4, 16, 100);
            const mat = new THREE.MeshBasicMaterial({color:0xff6b9d, wireframe:true});
            
            const shapes = [];
            for (let i = 0; i < 40; i++) {
                const mesh = new THREE.Mesh(geo, mat);
                mesh.position.set(
                    Math.random() * 60 - 30,
                    Math.random() * 60 - 30,
                    Math.random() * 60 - 30
                );
                mesh.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, 0);
                mesh.scale.setScalar(Math.random() * 0.5 + 0.2);
                scene.add(mesh);
                shapes.push({mesh, speedX: Math.random() * 0.002, speedY: Math.random() * 0.003});
            }
            
            camera.position.z = 20;
            
            function animate() {
                requestAnimationFrame(animate);
                shapes.forEach(s => {
                    s.mesh.rotation.x += s.speedX;
                    s.mesh.rotation.y += s.speedY;
                });
                renderer.render(scene, camera);
            }
            animate();
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // ============================================================
        // INIT
        // ============================================================
        
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Exotisa App Store initialized');
            initThree();
            
            const {data:{session}} = await sb.auth.getSession();
            if (!session) {
                document.getElementById('authPage').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
            }
        });
    </script>
</body>
</html>
