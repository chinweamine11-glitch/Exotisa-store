<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exotisa Store - Ù…ØªØ¬Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª ÙˆØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø£Ø¯Ø§Ø¡ */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #17a2b8;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --gray-color: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --primary-gradient: linear-gradient(135deg, #4a6fa5 0%, #166088 100%);
            --glass-effect: rgba(255, 255, 255, 0.15);
        }

        [data-theme="dark"] {
            --primary-color: #5a8fd6;
            --secondary-color: #2c7bb6;
            --light-color: #1a1d28;
            --dark-color: #f0f0f0;
            --light-gray: #2d3748;
            --gray-color: #a0aec0;
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
            --glass-effect: rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: var(--light-color);
            color: var(--dark-color);
            transition: var(--transition);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ù„Ù„ØµÙˆØ± */
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .lazy-load {
            opacity: 0;
            transition: opacity 0.3s;
        }

        .lazy-load.loaded {
            opacity: 1;
        }

        /* Header Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø²Ø¬Ø§Ø¬ÙŠ */
        .header {
            background: var(--primary-gradient);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .app-card {
            background: var(--light-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .app-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…ÙŠ */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary-color);
            transform-origin: 0%;
            z-index: 1001;
            display: none;
        }

        .progress-bar.active {
            display: block;
            animation: progress 2s ease-in-out infinite;
        }

        @keyframes progress {
            0% { transform: scaleX(0); }
            50% { transform: scaleX(0.7); }
            100% { transform: scaleX(1); }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .content-loader {
            display: grid;
            place-items: center;
            min-height: 300px;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø­Ø« */
        .search-input-container {
            position: relative;
            flex: 1;
            max-width: 600px;
        }

        .search-input-container input {
            width: 100%;
            padding: 14px 50px 14px 20px;
            border-radius: 50px;
            border: 2px solid transparent;
            background: var(--glass-effect);
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-input-container input:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.25);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
        .app-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            overflow: hidden;
        }

        .app-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 12px 28px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(74, 111, 165, 0.3);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ */
        .categories {
            background: var(--light-gray);
            padding: 15px 0;
            position: sticky;
            top: 70px;
            z-index: 999;
        }

        .category-list {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
        }

        .category-list::-webkit-scrollbar {
            height: 6px;
        }

        .category-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .header .container {
                flex-direction: column;
                gap: 15px;
            }
            
            .search-input-container {
                max-width: 100%;
            }
            
            .category-list {
                gap: 10px;
            }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-badge.active {
            background: rgba(40, 167, 69, 0.15);
            color: var(--success-color);
        }

        .status-badge.inactive {
            background: rgba(220, 53, 69, 0.15);
            color: var(--danger-color);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø© */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--light-gray);
            padding: 25px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card i {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ */
        .form-group {
            margin-bottom: 25px;
        }

        .form-control {
            width: 100%;
            padding: 14px 20px;
            border-radius: var(--border-radius);
            border: 2px solid var(--light-gray);
            background: var(--light-color);
            color: var(--dark-color);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.1);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .alert {
            padding: 15px 25px;
            border-radius: var(--border-radius);
            margin: 20px 0;
            border-left: 5px solid;
        }

        .alert-success {
            background: rgba(40, 167, 69, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
        }

        .alert-error {
            background: rgba(220, 53, 69, 0.1);
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ */
        .infinite-scroll-trigger {
            height: 50px;
            display: grid;
            place-items: center;
            margin: 30px 0;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© */
        .cache-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-size: 14px;
            display: none;
            z-index: 1000;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
        .theme-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--glass-effect);
            border: none;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            display: grid;
            place-items: center;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: rotate(30deg);
        }
    </style>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… -->
    <div class="progress-bar" id="progressBar"></div>

    <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© -->
    <div class="cache-indicator" id="cacheIndicator">
        <i class="fas fa-bolt"></i> ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
    </div>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1><i class="fas fa-store"></i> Exotisa Store</h1>
                <small>Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</small>
            </div>
            
            <div class="search-input-container">
                <input type="text" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† ØªØ·Ø¨ÙŠÙ‚ØŒ ÙØ¦Ø©ØŒ Ø£Ùˆ Ù…Ø·ÙˆØ±...">
                <div id="searchResults" class="search-results"></div>
            </div>
            
            <div class="header-controls">
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-primary" id="authButton">
                    <i class="fas fa-user"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </div>
        </div>
    </header>

    <!-- Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="modal" id="loginModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <input type="email" class="form-control" id="loginEmail" 
                               placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-control" id="loginPassword" 
                               placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="dashboard" id="dashboard" style="display: none;">
        <div class="container">
            <div class="dashboard-header">
                <h2><i class="fas fa-cogs"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
                <button class="btn btn-secondary" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </div>
            
            <div class="dashboard-tabs">
                <button class="tab-btn active" data-tab="stats">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
                <button class="tab-btn" data-tab="apps">Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</button>
                <button class="tab-btn" data-tab="add">Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚</button>
                <button class="tab-btn" data-tab="categories">Ø§Ù„ÙØ¦Ø§Øª</button>
            </div>
            
            <div class="tab-content active" id="statsTab">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-mobile-alt"></i>
                        <h3 id="totalApps">0</h3>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-download"></i>
                        <h3 id="totalDownloads">0</h3>
                        <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="totalUsers">0</h3>
                        <p>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <h3 id="avgRating">0.0</h3>
                        <p>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</p>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="appsTab">
                <div id="appsManagement"></div>
            </div>
            
            <div class="tab-content" id="addTab">
                <form id="addAppForm">
                    <div class="form-group">
                        <input type="text" class="form-control" id="appName" 
                               placeholder="Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" required>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" id="appDescription" 
                                  placeholder="ÙˆØµÙ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚" rows="3" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-control" id="appVersion" 
                                   placeholder="Ø§Ù„Ø¥ØµØ¯Ø§Ø±" required>
                        </div>
                        <div class="form-group">
                            <input type="number" class="form-control" id="appSize" 
                                   placeholder="Ø§Ù„Ø­Ø¬Ù… (MB)" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <main class="main-content" id="mainContent">
        <div class="container">
            <!-- Ø§Ù„ÙØ¦Ø§Øª -->
            <section class="categories" id="categoriesSection">
                <div class="category-list" id="categoryList">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </section>

            <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø© -->
            <section class="featured-section">
                <h2><i class="fas fa-star"></i> Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©</h2>
                <div class="grid-container" id="featuredApps">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </section>

            <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª -->
            <section class="all-apps-section">
                <div class="section-header">
                    <h2><i class="fas fa-th"></i> Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª</h2>
                    <select class="form-control" id="sortSelect" style="width: auto;">
                        <option value="newest">Ø§Ù„Ø£Ø­Ø¯Ø«</option>
                        <option value="popular">Ø§Ù„Ø£ÙƒØ«Ø± Ø´Ø¹Ø¨ÙŠØ©</option>
                        <option value="rating">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</option>
                    </select>
                </div>
                <div class="grid-container" id="appsGrid">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
                <div class="infinite-scroll-trigger" id="loadMoreTrigger">
                    <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯...
                </div>
            </section>
        </div>
    </main>

    <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
    <footer class="footer">
        <div class="container">
            <p>Â© 2024 Exotisa Store. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</p>
            <p>Ù…ØªØ¬Ø± ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ØªÙƒØ§Ù…Ù„ Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª</p>
        </div>
    </footer>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // ==================== ØªÙƒÙˆÙŠÙ† Supabase ====================
        const SUPABASE_URL = 'https://qjfpkwyglveukzfazmzo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqZnBrd3lnbHZldWt6ZmF6bXpvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NjY2MjMsImV4cCI6MjA4MzA0MjYyM30.L-bh48EGgn348UzJzBajJc1PR7-z1weW1ayzZz-tbvc';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // ==================== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ====================
        let appState = {
            user: null,
            apps: [],
            categories: [],
            featuredApps: [],
            currentCategory: 'all',
            sortBy: 'newest',
            page: 1,
            isLoading: false,
            hasMore: true,
            cache: {
                apps: null,
                lastFetch: null
            }
        };

        // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ====================
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Exotisa Store...');
            
            try {
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙƒÙˆÙŠÙ†
                await loadConfig();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                await checkUserSession();
                
                // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                await Promise.all([
                    loadCategories(),
                    loadFeaturedApps(),
                    loadApps()
                ]);
                
                // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
                initEventListeners();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                updateUI();
                
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!');
                showSuccess('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Exotisa Store!');
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.');
            }
        });

        // ==================== ÙˆØ¸Ø§Ø¦Ù Supabase ====================

        async function loadConfig() {
            try {
                const { data, error } = await supabase
                    .from('config')
                    .select('*')
                    .single();
                
                if (error) throw error;
                
                if (data) {
                    localStorage.setItem('app_config', JSON.stringify(data));
                }
            } catch (error) {
                console.warn('âš ï¸  Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙƒÙˆÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        async function checkUserSession() {
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) throw error;
                
                if (session) {
                    appState.user = session.user;
                    console.log('ğŸ‘¤ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', appState.user.email);
                    
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    if (appState.user.email === 'chinweamine11@gmail.com') {
                        showDashboard();
                    }
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:', error);
            }
        }

        async function loadCategories() {
            try {
                const cacheKey = 'categories_cache';
                const cached = localStorage.getItem(cacheKey);
                
                if (cached) {
                    const { data, timestamp } = JSON.parse(cached);
                    if (Date.now() - timestamp < 3600000) { // Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©
                        appState.categories = data;
                        renderCategories();
                        showCacheIndicator();
                        return;
                    }
                }
                
                const { data, error } = await supabase
                    .from('categories')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                appState.categories = data || [];
                
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
                localStorage.setItem(cacheKey, JSON.stringify({
                    data: appState.categories,
                    timestamp: Date.now()
                }));
                
                renderCategories();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª:', error);
                appState.categories = [];
            }
        }

        async function loadFeaturedApps() {
            try {
                const { data, error } = await supabase
                    .from('apps')
                    .select('*')
                    .eq('is_featured', true)
                    .eq('is_active', true)
                    .order('created_at', { ascending: false })
                    .limit(4);
                
                if (error) throw error;
                
                appState.featuredApps = data || [];
                renderFeaturedApps();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù…ÙŠØ²Ø©:', error);
                appState.featuredApps = [];
            }
        }

        async function loadApps(loadMore = false) {
            if (appState.isLoading || (!loadMore && !appState.hasMore)) return;
            
            appState.isLoading = true;
            showProgressBar();
            
            try {
                let query = supabase
                    .from('apps')
                    .select('*, categories(name), reviews(rating)')
                    .eq('is_active', true);
                
                // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
                if (appState.currentCategory !== 'all') {
                    query = query.eq('category_id', appState.currentCategory);
                }
                
                // Ø§Ù„ØªØ±ØªÙŠØ¨
                switch (appState.sortBy) {
                    case 'popular':
                        query = query.order('downloads', { ascending: false });
                        break;
                    case 'rating':
                        query = query.order('average_rating', { ascending: false });
                        break;
                    default:
                        query = query.order('created_at', { ascending: false });
                }
                
                // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ
                const from = (appState.page - 1) * 12;
                const to = from + 11;
                
                query = query.range(from, to);
                
                const { data, error, count } = await query;
                
                if (error) throw error;
                
                if (data) {
                    if (loadMore) {
                        appState.apps = [...appState.apps, ...data];
                    } else {
                        appState.apps = data;
                    }
                    
                    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                    appState.hasMore = data.length === 12;
                    
                    // Ø²ÙŠØ§Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ù„Ù…Ø²ÙŠØ¯
                    if (appState.hasMore) {
                        appState.page++;
                    }
                    
                    renderApps();
                }
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª');
            } finally {
                appState.isLoading = false;
                hideProgressBar();
            }
        }

        async function searchApps(query) {
            if (!query.trim()) {
                loadApps();
                return;
            }
            
            showProgressBar();
            
            try {
                const { data, error } = await supabase
                    .from('apps')
                    .select('*, categories(name)')
                    .or(`name.ilike.%${query}%,description.ilike.%${query}%,developer.ilike.%${query}%`)
                    .eq('is_active', true)
                    .limit(20);
                
                if (error) throw error;
                
                appState.apps = data || [];
                renderApps();
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«');
            } finally {
                hideProgressBar();
            }
        }

        // ==================== ÙˆØ¸Ø§Ø¦Ù Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ====================

        async function loadDashboardStats() {
            try {
                // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
                const { count: totalApps } = await supabase
                    .from('apps')
                    .select('*', { count: 'exact', head: true });
                
                // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                const { data: downloadsData } = await supabase
                    .from('apps')
                    .select('downloads');
                const totalDownloads = downloadsData?.reduce((sum, app) => sum + (app.downloads || 0), 0) || 0;
                
                // Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                const { count: totalUsers } = await supabase
                    .from('users')
                    .select('*', { count: 'exact', head: true });
                
                // Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
                const { data: ratingData } = await supabase
                    .from('apps')
                    .select('average_rating');
                const avgRating = ratingData?.length 
                    ? (ratingData.reduce((sum, app) => sum + (app.average_rating || 0), 0) / ratingData.length).toFixed(1)
                    : '0.0';
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                document.getElementById('totalApps').textContent = totalApps || 0;
                document.getElementById('totalDownloads').textContent = totalDownloads.toLocaleString();
                document.getElementById('totalUsers').textContent = totalUsers || 0;
                document.getElementById('avgRating').textContent = avgRating;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        async function addNewApp(appData) {
            try {
                const { data, error } = await supabase
                    .from('apps')
                    .insert([{
                        name: appData.name,
                        description: appData.description,
                        version: appData.version,
                        size: appData.size,
                        category_id: appData.categoryId,
                        developer: appData.developer,
                        icon_url: appData.iconUrl,
                        download_url: appData.downloadUrl,
                        is_featured: appData.isFeatured || false,
                        is_active: true,
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();
                
                if (error) throw error;
                
                return data;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                throw error;
            }
        }

        async function updateApp(appId, updates) {
            try {
                const { data, error } = await supabase
                    .from('apps')
                    .update(updates)
                    .eq('id', appId)
                    .select()
                    .single();
                
                if (error) throw error;
                
                return data;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                throw error;
            }
        }

        async function deleteApp(appId) {
            try {
                const { error } = await supabase
                    .from('apps')
                    .delete()
                    .eq('id', appId);
                
                if (error) throw error;
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ·Ø¨ÙŠÙ‚:', error);
                throw error;
            }
        }

        // ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¹Ø±Ø¶ ====================

        function renderCategories() {
            const container = document.getElementById('categoryList');
            if (!container) return;
            
            container.innerHTML = '';
            
            // Ø²Ø± Ø§Ù„ÙƒÙ„
            const allButton = createCategoryButton('all', 'Ø§Ù„ÙƒÙ„', 'fas fa-th-large');
            allButton.classList.add('active');
            container.appendChild(allButton);
            
            // Ø§Ù„ÙØ¦Ø§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            appState.categories.forEach(category => {
                const button = createCategoryButton(category.id, category.name, category.icon);
                container.appendChild(button);
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø±
            container.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    container.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù„Ø²Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
                    btn.classList.add('active');
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª
                    appState.currentCategory = btn.dataset.categoryId;
                    appState.page = 1;
                    appState.hasMore = true;
                    loadApps();
                });
            });
        }

        function createCategoryButton(id, name, icon) {
            const button = document.createElement('button');
            button.className = 'category-btn';
            button.dataset.categoryId = id;
            button.innerHTML = `
                ${icon ? `<i class="${icon}"></i>` : ''}
                <span>${name}</span>
            `;
            return button;
        }

        function renderFeaturedApps() {
            const container = document.getElementById('featuredApps');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (appState.featuredApps.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-star fa-3x"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…Ù…ÙŠØ²Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                    </div>
                `;
                return;
            }
            
            appState.featuredApps.forEach(app => {
                const card = createAppCard(app, true);
                container.appendChild(card);
            });
        }

        function renderApps() {
            const container = document.getElementById('appsGrid');
            if (!container) return;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ØŒ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ø§ÙˆÙŠØ©
            if (appState.page === 1) {
                container.innerHTML = '';
            }
            
            if (appState.apps.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-box-open fa-3x"></i>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ù…ØªØ§Ø­Ø©</p>
                    </div>
                `;
                return;
            }
            
            appState.apps.forEach(app => {
                const card = createAppCard(app);
                container.appendChild(card);
            });
        }

        function createAppCard(app, isFeatured = false) {
            const card = document.createElement('div');
            card.className = `app-card ${isFeatured ? 'featured' : ''}`;
            card.dataset.appId = app.id;
            
            // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            const averageRating = app.average_rating || 
                (app.reviews?.length ? 
                 app.reviews.reduce((sum, r) => sum + r.rating, 0) / app.reviews.length : 0);
            
            card.innerHTML = `
                <div class="app-card-header">
                    <div class="app-icon">
                        ${app.icon_url ? 
                          `<img src="${app.icon_url}" alt="${app.name}" loading="lazy">` : 
                          `<i class="fas fa-mobile-alt"></i>`}
                    </div>
                    <div class="app-info">
                        <h3 class="app-title">${app.name}</h3>
                        <p class="app-developer">${app.developer}</p>
                        <div class="app-meta">
                            <span><i class="fas fa-code-branch"></i> ${app.version}</span>
                            <span><i class="fas fa-weight-hanging"></i> ${app.size}MB</span>
                            <span><i class="fas fa-download"></i> ${formatNumber(app.downloads || 0)}</span>
                        </div>
                    </div>
                </div>
                <div class="app-card-body">
                    <p class="app-description">${app.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ'}</p>
                    <div class="app-rating">
                        ${createStarsHTML(averageRating)}
                        <span class="rating-value">${averageRating.toFixed(1)}</span>
                    </div>
                </div>
                <div class="app-card-footer">
                    <button class="btn btn-primary download-btn" data-app-id="${app.id}">
                        <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„
                    </button>
                    <button class="btn btn-secondary preview-btn" data-app-id="${app.id}">
                        <i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                    </button>
                </div>
            `;
            
            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            card.querySelector('.download-btn').addEventListener('click', () => downloadApp(app.id));
            card.querySelector('.preview-btn').addEventListener('click', () => previewApp(app.id));
            
            return card;
        }

        function createStarsHTML(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= Math.floor(rating)) {
                    stars += '<i class="fas fa-star"></i>';
                } else if (i === Math.ceil(rating) && rating % 1 >= 0.5) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                } else {
                    stars += '<i class="far fa-star"></i>';
                }
            }
            return stars;
        }

        // ==================== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ====================

        function formatNumber(num) {
            return num.toLocaleString('ar-EG');
        }

        function showProgressBar() {
            document.getElementById('progressBar').classList.add('active');
        }

        function hideProgressBar() {
            document.getElementById('progressBar').classList.remove('active');
        }

        function showSuccess(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-success';
            alert.innerHTML = `
                <i class="fas fa-check-circle"></i>
                ${message}
            `;
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 3000);
        }

        function showError(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-error';
            alert.innerHTML = `
                <i class="fas fa-exclamation-circle"></i>
                ${message}
            `;
            document.body.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        function showCacheIndicator() {
            const indicator = document.getElementById('cacheIndicator');
            indicator.style.display = 'block';
            setTimeout(() => {
                indicator.style.display = 'none';
            }, 2000);
        }

        function showDashboard() {
            document.getElementById('dashboard').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            loadDashboardStats();
        }

        function hideDashboard() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
        }

        // ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ====================

        function initEventListeners() {
            // Ø§Ù„Ø¨Ø­Ø«
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    searchApps(e.target.value);
                }, 500);
            });
            
            // Ø§Ù„ÙØ±Ø²
            document.getElementById('sortSelect').addEventListener('change', (e) => {
                appState.sortBy = e.target.value;
                appState.page = 1;
                appState.hasMore = true;
                loadApps();
            });
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ
            const observer = new IntersectionObserver((entries) => {
                if (entries[0].isIntersecting && !appState.isLoading && appState.hasMore) {
                    loadApps(true);
                }
            }, { threshold: 0.5 });
            
            observer.observe(document.getElementById('loadMoreTrigger'));
            
            // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('authButton').addEventListener('click', () => {
                if (appState.user) {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø³Ø¬Ù„Ø§Ù‹ Ø¯Ø®ÙˆÙ„ØŒ Ø¥Ø¸Ù‡Ø§Ø± Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                    if (appState.user.email === 'chinweamine11@gmail.com') {
                        showDashboard();
                    } else {
                        logout();
                    }
                } else {
                    // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    document.getElementById('loginModal').style.display = 'flex';
                }
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email,
                        password
                    });
                    
                    if (error) throw error;
                    
                    appState.user = data.user;
                    document.getElementById('loginModal').style.display = 'none';
                    
                    if (appState.user.email === 'chinweamine11@gmail.com') {
                        showDashboard();
                        showSuccess('Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…!');
                    } else {
                        showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
                    }
                    
                    updateUI();
                    
                } catch (error) {
                    showError('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message);
                }
            });
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            document.getElementById('logoutBtn')?.addEventListener('click', async () => {
                await logout();
            });
            
            // Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯
            document.getElementById('addAppForm')?.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const appData = {
                    name: document.getElementById('appName').value,
                    description: document.getElementById('appDescription').value,
                    version: document.getElementById('appVersion').value,
                    size: parseFloat(document.getElementById('appSize').value),
                    categoryId: 'default',
                    developer: 'Exotisa Store',
                    iconUrl: 'https://cdn-icons-png.flaticon.com/512/2991/2991148.png',
                    downloadUrl: '#',
                    isFeatured: false
                };
                
                try {
                    const newApp = await addNewApp(appData);
                    showSuccess('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!');
                    e.target.reset();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    appState.apps.unshift(newApp);
                    renderApps();
                    
                } catch (error) {
                    showError('ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚: ' + error.message);
                }
            });
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab + 'Tab';
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙŠØ§Øª
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø­Ø¯Ø¯
                    document.getElementById(tabId).classList.add('active');
                    btn.classList.add('active');
                });
            });
            
            // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.querySelector('.close-btn')?.addEventListener('click', () => {
                document.getElementById('loginModal').style.display = 'none';
            });
            
            // Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§
            window.addEventListener('click', (e) => {
                const modal = document.getElementById('loginModal');
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        }

        async function logout() {
            try {
                await supabase.auth.signOut();
                appState.user = null;
                hideDashboard();
                updateUI();
                showSuccess('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                showError('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬: ' + error.message);
            }
        }

        async function downloadApp(appId) {
            try {
                // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„Ø§Øª
                const { data: app } = await supabase
                    .from('apps')
                    .select('downloads')
                    .eq('id', appId)
                    .single();
                
                if (app) {
                    await supabase
                        .from('apps')
                        .update({ downloads: (app.downloads || 0) + 1 })
                        .eq('id', appId);
                }
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                showProgressBar();
                setTimeout(() => {
                    hideProgressBar();
                    showSuccess('Ø¨Ø¯Ø£ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!');
                }, 1000);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„:', error);
                showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚');
            }
        }

        function previewApp(appId) {
            const app = appState.apps.find(a => a.id === appId);
            if (!app) return;
            
            alert(`Ù…Ø¹Ø§ÙŠÙ†Ø©: ${app.name}\n\n${app.description}`);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = document.querySelector('#themeToggle i');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            
            showSuccess(`ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ ${newTheme === 'dark' ? 'Ø§Ù„Ù„ÙŠÙ„ÙŠ' : 'Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ'}`);
        }

        function updateUI() {
            const authButton = document.getElementById('authButton');
            if (appState.user) {
                authButton.innerHTML = `
                    <i class="fas fa-user-check"></i> 
                    ${appState.user.email === 'chinweamine11@gmail.com' ? 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' : 'Ø­Ø³Ø§Ø¨ÙŠ'}
                `;
            } else {
                authButton.innerHTML = '<i class="fas fa-user"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
            }
            
            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const themeIcon = document.querySelector('#themeToggle i');
            themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // ==================== Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ====================
        supabase.auth.onAuthStateChange((event, session) => {
            appState.user = session?.user || null;
            updateUI();
            
            if (event === 'SIGNED_IN' && appState.user?.email === 'chinweamine11@gmail.com') {
                showDashboard();
            } else if (event === 'SIGNED_OUT') {
                hideDashboard();
            }
        });

        console.log('âœ¨ ØªÙ… ØªØ­Ù…ÙŠÙ„ Exotisa Store Ø¨Ù†Ø¬Ø§Ø­!');
    </script>
</body>
                    </html>
